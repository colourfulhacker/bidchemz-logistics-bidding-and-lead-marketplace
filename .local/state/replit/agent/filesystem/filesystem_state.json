{"file_contents":{"pages/_app.tsx":{"content":"import '../styles/globals.css'\nimport type { AppProps } from 'next/app'\nimport { AuthProvider } from '@/contexts/AuthContext'\n\nfunction MyApp({ Component, pageProps }: AppProps) {\n  return (\n    <AuthProvider>\n      <Component {...pageProps} />\n    </AuthProvider>\n  )\n}\n\nexport default MyApp\n","size_bytes":293},"styles/globals.css":{"content":"@import \"tailwindcss\";\n\nhtml,\nbody {\n  padding: 0;\n  margin: 0;\n  font-family: 'Inter', -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen,\n    Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;\n}\n\na {\n  color: inherit;\n  text-decoration: none;\n}\n\n* {\n  box-sizing: border-box;\n}\n","size_bytes":308},"README.md":{"content":"Welcome to the NextJS base template bootstrapped using the `create-next-app`. This template supports TypeScript, but you can use normal JavaScript as well.\n\n## Getting Started\n\nHit the run button to start the development server.\n\nYou can start editing the page by modifying `pages/index.tsx`. The page auto-updates as you edit the file.\n\n[API routes](https://nextjs.org/docs/api-routes/introduction) can be accessed on `/api/hello`. This endpoint can be edited in `pages/api/hello.ts`.\n\nThe `pages/api` directory is mapped to `/api/*`. Files in this directory are treated as [API routes](https://nextjs.org/docs/api-routes/introduction) instead of React pages.\n\n## Learn More\n\nTo learn more about Next.js, take a look at the following resources:\n\n- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.\n- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.\n\n## Productionizing your Next App\n\nTo make your next App run smoothly in production make sure to deploy your project with [Repl Deployments](https://docs.replit.com/hosting/deployments/about-deployments)!\n\nYou can also produce a production build by running `npm run build` and [changing the run command](https://docs.replit.com/programming-ide/configuring-repl#run) to `npm run start`.\n","size_bytes":1303},"next-env.d.ts":{"content":"/// <reference types=\"next\" />\n/// <reference types=\"next/image-types/global\" />\n\n// NOTE: This file should not be edited\n// see https://nextjs.org/docs/pages/api-reference/config/typescript for more information.\n","size_bytes":213},"styles/Home.module.css":{"content":".container {\n  padding: 0 2rem;\n}\n\n.main {\n  min-height: 100vh;\n  padding: 4rem 0;\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n}\n\n.footer {\n  display: flex;\n  flex: 1;\n  padding: 2rem 0;\n  border-top: 1px solid #eaeaea;\n  justify-content: center;\n  align-items: center;\n}\n\n.footer a {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-grow: 1;\n}\n\n.title a {\n  color: #0070f3;\n  text-decoration: none;\n}\n\n.title a:hover,\n.title a:focus,\n.title a:active {\n  text-decoration: underline;\n}\n\n.title {\n  margin: 0;\n  line-height: 1.15;\n  font-size: 4rem;\n}\n\n.title,\n.description {\n  text-align: center;\n}\n\n.description {\n  margin: 4rem 0;\n  line-height: 1.5;\n  font-size: 1.5rem;\n}\n\n.code {\n  background: #fafafa;\n  border-radius: 5px;\n  padding: 0.75rem;\n  font-size: 1.1rem;\n  font-family: Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono,\n    Bitstream Vera Sans Mono, Courier New, monospace;\n}\n\n.grid {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-wrap: wrap;\n  max-width: 800px;\n}\n\n.card {\n  margin: 1rem;\n  padding: 1.5rem;\n  text-align: left;\n  color: inherit;\n  text-decoration: none;\n  border: 1px solid #eaeaea;\n  border-radius: 10px;\n  transition: color 0.15s ease, border-color 0.15s ease;\n  max-width: 300px;\n}\n\n.card:hover,\n.card:focus,\n.card:active {\n  color: #0070f3;\n  border-color: #0070f3;\n}\n\n.card h2 {\n  margin: 0 0 1rem 0;\n  font-size: 1.5rem;\n}\n\n.card p {\n  margin: 0;\n  font-size: 1.25rem;\n  line-height: 1.5;\n}\n\n.logo {\n  height: 1em;\n  margin-left: 0.2rem;\n}\n\n@media (max-width: 600px) {\n  .grid {\n    width: 100%;\n    flex-direction: column;\n  }\n}\n","size_bytes":1698},"pages/index.tsx":{"content":"import { useEffect } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Layout } from '@/components/layout/Layout';\nimport Card from '@/components/ui/Card';\nimport Button from '@/components/ui/Button';\nimport Link from 'next/link';\nimport { useRouter } from 'next/router';\n\nexport default function Home() {\n  const { user, isLoading } = useAuth();\n  const router = useRouter();\n\n  useEffect(() => {\n    if (!isLoading && user) {\n      if (user.role === 'LOGISTICS_PARTNER') {\n        router.push('/partner/dashboard');\n      } else if (user.role === 'ADMIN') {\n        router.push('/admin/dashboard');\n      }\n    }\n  }, [user, isLoading, router]);\n\n  if (isLoading) {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">Loading...</div>\n      </Layout>\n    );\n  }\n\n  if (!user) {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">\n          <h1 className=\"text-4xl font-bold text-gray-900 mb-4\">\n            Welcome to BidChemz Logistics\n          </h1>\n          <p className=\"text-xl text-gray-600 mb-8\">\n            Reverse Bidding Platform for Chemical Logistics\n          </p>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto mt-12\">\n            <Card>\n              <h2 className=\"text-2xl font-semibold mb-4\">For Traders</h2>\n              <p className=\"text-gray-600 mb-6\">\n                Submit freight requests and receive competitive quotations from verified logistics partners\n              </p>\n              <Link href=\"/signup\">\n                <Button variant=\"primary\" className=\"w-full\">\n                  Get Started\n                </Button>\n              </Link>\n            </Card>\n\n            <Card>\n              <h2 className=\"text-2xl font-semibold mb-4\">For Logistics Partners</h2>\n              <p className=\"text-gray-600 mb-6\">\n                Receive high-quality leads and submit competitive offers to win freight business\n              </p>\n              <Link href=\"/signup\">\n                <Button variant=\"primary\" className=\"w-full\">\n                  Join as Partner\n                </Button>\n              </Link>\n            </Card>\n          </div>\n\n          <div className=\"mt-12\">\n            <h3 className=\"text-2xl font-semibold text-gray-900 mb-6\">How It Works</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 max-w-5xl mx-auto\">\n              <div className=\"text-center\">\n                <div className=\"bg-blue-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4\">\n                  <span className=\"text-2xl font-bold text-blue-600\">1</span>\n                </div>\n                <h4 className=\"font-semibold mb-2\">Submit Request</h4>\n                <p className=\"text-sm text-gray-600\">Trader submits freight requirement</p>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"bg-blue-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4\">\n                  <span className=\"text-2xl font-bold text-blue-600\">2</span>\n                </div>\n                <h4 className=\"font-semibold mb-2\">Match Partners</h4>\n                <p className=\"text-sm text-gray-600\">System matches eligible partners</p>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"bg-blue-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4\">\n                  <span className=\"text-2xl font-bold text-blue-600\">3</span>\n                </div>\n                <h4 className=\"font-semibold mb-2\">Receive Offers</h4>\n                <p className=\"text-sm text-gray-600\">Partners submit competitive quotes</p>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"bg-blue-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4\">\n                  <span className=\"text-2xl font-bold text-blue-600\">4</span>\n                </div>\n                <h4 className=\"font-semibold mb-2\">Select & Track</h4>\n                <p className=\"text-sm text-gray-600\">Choose best offer and track shipment</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </Layout>\n    );\n  }\n\n  return (\n    <Layout>\n      <div>\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-8\">\n          Welcome back, {user.companyName || user.email}!\n        </h1>\n\n        {user.role === 'TRADER' && (\n          <div>\n            <Card>\n              <h2 className=\"text-xl font-semibold mb-4\">Quick Actions</h2>\n              <div className=\"space-y-3\">\n                <Link href=\"/quotes/new\">\n                  <Button variant=\"primary\" className=\"w-full\">\n                    Create New Freight Request\n                  </Button>\n                </Link>\n                <Link href=\"/quotes\">\n                  <Button variant=\"secondary\" className=\"w-full\">\n                    View My Requests\n                  </Button>\n                </Link>\n              </div>\n            </Card>\n          </div>\n        )}\n      </div>\n    </Layout>\n  );\n}\n","size_bytes":5117},"pages/api/hello.ts":{"content":"// Next.js API route support: https://nextjs.org/docs/api-routes/introduction\nimport type { NextApiRequest, NextApiResponse } from 'next'\n\ntype Data = {\n  name: string\n}\n\nexport default function handler(\n  req: NextApiRequest,\n  res: NextApiResponse<Data>\n) {\n  res.status(200).json({ name: 'John Doe' })\n}\n","size_bytes":307},"next.config.ts":{"content":"import type { NextConfig } from \"next\";\n\nconst nextConfig: NextConfig = {\n  allowedDevOrigins: process.env.REPLIT_DOMAINS \n    ? process.env.REPLIT_DOMAINS.split(',') \n    : [],\n};\n\nmodule.exports = nextConfig;\n","size_bytes":211},"lib/matching-engine.ts":{"content":"import prisma from './prisma';\nimport { UserRole, SubscriptionTier, HazardClass } from '@prisma/client';\n\ninterface Quote {\n  id: string;\n  isHazardous: boolean;\n  hazardClass: HazardClass | null;\n  packagingType: string;\n  pickupState: string;\n  deliveryState: string;\n  preferredVehicleType: string[];\n  temperatureControlled: boolean;\n}\n\nexport async function findMatchingPartners(quoteId: string) {\n  const quote = await prisma.quote.findUnique({\n    where: { id: quoteId },\n  });\n\n  if (!quote) {\n    throw new Error('Quote not found');\n  }\n\n  const partners = await prisma.user.findMany({\n    where: {\n      role: UserRole.LOGISTICS_PARTNER,\n      isActive: true,\n      isVerified: true,\n    },\n    include: {\n      partnerCapability: true,\n      leadWallet: true,\n    },\n  });\n\n  const matchedPartners = partners.filter((partner) => {\n    const capability = partner.partnerCapability;\n\n    if (!capability) return false;\n\n    if (quote.isHazardous) {\n      if (!capability.dgClasses.includes(quote.hazardClass!)) {\n        return false;\n      }\n    }\n\n    const servesPickupState = capability.serviceStates.includes(quote.pickupState);\n    const servesDeliveryState = capability.serviceStates.includes(quote.deliveryState);\n\n    if (!servesPickupState || !servesDeliveryState) {\n      return false;\n    }\n\n    if (!capability.packagingCapabilities.includes(quote.packagingType as any)) {\n      return false;\n    }\n\n    if (quote.preferredVehicleType.length > 0) {\n      const hasMatchingVehicle = quote.preferredVehicleType.some((vt) =>\n        capability.fleetTypes.includes(vt as any)\n      );\n      if (!hasMatchingVehicle) {\n        return false;\n      }\n    }\n\n    if (quote.temperatureControlled && !capability.temperatureControlled) {\n      return false;\n    }\n\n    const wallet = partner.leadWallet;\n    if (!wallet || wallet.balance <= 0) {\n      return false;\n    }\n\n    return true;\n  });\n\n  const prioritizedPartners = matchedPartners.sort((a, b) => {\n    const tierPriority = {\n      [SubscriptionTier.PREMIUM]: 3,\n      [SubscriptionTier.STANDARD]: 2,\n      [SubscriptionTier.FREE]: 1,\n    };\n\n    const aTier = a.partnerCapability?.subscriptionTier || SubscriptionTier.FREE;\n    const bTier = b.partnerCapability?.subscriptionTier || SubscriptionTier.FREE;\n\n    return tierPriority[bTier] - tierPriority[aTier];\n  });\n\n  return prioritizedPartners.map((partner) => ({\n    partnerId: partner.id,\n    email: partner.email,\n    companyName: partner.companyName,\n    subscriptionTier: partner.partnerCapability?.subscriptionTier,\n  }));\n}\n\nexport async function notifyMatchedPartners(quoteId: string, partners: any[]) {\n  const { notifyPartnerAboutNewLead } = await import('./notifications');\n  \n  console.log(`Notifying ${partners.length} matched partners for quote ${quoteId}`);\n  \n  const notificationPromises = partners.map((partner) =>\n    notifyPartnerAboutNewLead(partner.partnerId, quoteId, {\n      email: partner.email,\n      companyName: partner.companyName,\n      tier: partner.subscriptionTier,\n    })\n  );\n\n  await Promise.allSettled(notificationPromises);\n  \n  console.log(`Successfully sent notifications to ${partners.length} partners`);\n}\n","size_bytes":3174},"lib/middleware.ts":{"content":"import { NextApiRequest, NextApiResponse } from 'next';\nimport { UserRole } from '@prisma/client';\nimport { verifyToken, extractTokenFromHeader, JWTPayload } from './auth';\n\nexport interface AuthenticatedRequest extends NextApiRequest {\n  user?: JWTPayload;\n}\n\nexport type AuthenticatedHandler = (\n  req: AuthenticatedRequest,\n  res: NextApiResponse\n) => Promise<void> | void;\n\nexport function withAuth(handler: AuthenticatedHandler, allowedRoles?: UserRole[]) {\n  return async (req: AuthenticatedRequest, res: NextApiResponse) => {\n    const token = extractTokenFromHeader(req.headers.authorization);\n\n    if (!token) {\n      return res.status(401).json({ error: 'Unauthorized: No token provided' });\n    }\n\n    const payload = verifyToken(token);\n\n    if (!payload) {\n      return res.status(401).json({ error: 'Unauthorized: Invalid token' });\n    }\n\n    if (allowedRoles && !allowedRoles.includes(payload.role)) {\n      return res.status(403).json({ error: 'Forbidden: Insufficient permissions' });\n    }\n\n    req.user = payload;\n    return handler(req, res);\n  };\n}\n\nexport function requireRole(...roles: UserRole[]) {\n  return (handler: AuthenticatedHandler) => withAuth(handler, roles);\n}\n","size_bytes":1196},"components/ui/Input.tsx":{"content":"import React, { useId } from 'react';\n\nexport interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  label?: string;\n  error?: string;\n  hint?: string;\n  icon?: React.ReactNode;\n}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ label, error, hint, icon, className = '', id: providedId, ...props }, ref) => {\n    const generatedId = useId();\n    const inputId = providedId || generatedId;\n    const errorId = `${inputId}-error`;\n    const hintId = `${inputId}-hint`;\n    \n    return (\n      <div className=\"w-full\">\n        {label && (\n          <label htmlFor={inputId} className=\"block text-sm font-medium text-secondary-700 mb-1\">\n            {label}\n            {props.required && <span className=\"text-danger-500 ml-1\">*</span>}\n          </label>\n        )}\n        <div className=\"relative\">\n          {icon && (\n            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-secondary-400\">\n              {icon}\n            </div>\n          )}\n          <input\n            ref={ref}\n            id={inputId}\n            aria-invalid={error ? 'true' : 'false'}\n            aria-describedby={error ? errorId : hint ? hintId : undefined}\n            className={`\n              w-full px-4 py-2 border rounded-md transition-all duration-200\n              ${icon ? 'pl-10' : ''}\n              ${error \n                ? 'border-danger-500 focus:border-danger-500 focus:ring-danger-500' \n                : 'border-secondary-300 focus:border-primary-500 focus:ring-primary-500'\n              }\n              focus:outline-none focus:ring-2 focus:ring-offset-0\n              disabled:bg-secondary-50 disabled:cursor-not-allowed\n              ${className}\n            `}\n            {...props}\n          />\n        </div>\n        {error && (\n          <p id={errorId} className=\"mt-1 text-sm text-danger-600\" role=\"alert\">\n            {error}\n          </p>\n        )}\n        {hint && !error && (\n          <p id={hintId} className=\"mt-1 text-sm text-secondary-500\">\n            {hint}\n          </p>\n        )}\n      </div>\n    );\n  }\n);\n\nInput.displayName = 'Input';\n\nexport default Input;\n","size_bytes":2172},"pages/api/shipments/[id]/track.ts":{"content":"import { NextApiResponse } from 'next';\nimport prisma from '@/lib/prisma';\nimport { withAuth, AuthenticatedRequest } from '@/lib/middleware';\nimport { UserRole, ShipmentStatus } from '@prisma/client';\n\nasync function handler(req: AuthenticatedRequest, res: NextApiResponse) {\n  const { id } = req.query;\n\n  if (typeof id !== 'string') {\n    return res.status(400).json({ error: 'Invalid shipment ID' });\n  }\n\n  if (req.method === 'GET') {\n    try {\n      const shipment = await prisma.shipment.findUnique({\n        where: { id },\n        include: {\n          quote: {\n            include: {\n              trader: {\n                select: {\n                  id: true,\n                  email: true,\n                  companyName: true,\n                },\n              },\n            },\n          },\n          offer: {\n            include: {\n              partner: {\n                select: {\n                  id: true,\n                  email: true,\n                  companyName: true,\n                },\n              },\n            },\n          },\n          documents: true,\n        },\n      });\n\n      if (!shipment) {\n        return res.status(404).json({ error: 'Shipment not found' });\n      }\n\n      const isTrader = req.user!.userId === shipment.quote.traderId;\n      const isPartner = req.user!.userId === shipment.offer.partnerId;\n      const isAdmin = req.user!.role === UserRole.ADMIN;\n\n      if (!isTrader && !isPartner && !isAdmin) {\n        return res.status(403).json({ error: 'Access denied' });\n      }\n\n      res.status(200).json({ shipment });\n    } catch (error) {\n      console.error('Error fetching shipment:', error);\n      res.status(500).json({ error: 'Failed to fetch shipment' });\n    }\n  } else if (req.method === 'POST') {\n    try {\n      if (req.user!.role !== UserRole.LOGISTICS_PARTNER && req.user!.role !== UserRole.ADMIN) {\n        return res.status(403).json({\n          error: 'Only logistics partners and admins can update shipment status',\n        });\n      }\n\n      const shipment = await prisma.shipment.findUnique({\n        where: { id },\n        include: {\n          offer: true,\n        },\n      });\n\n      if (!shipment) {\n        return res.status(404).json({ error: 'Shipment not found' });\n      }\n\n      if (req.user!.role === UserRole.LOGISTICS_PARTNER && shipment.offer.partnerId !== req.user!.userId) {\n        return res.status(403).json({ error: 'Access denied: not your shipment' });\n      }\n\n      const { status, location, notes } = req.body;\n\n      if (!status) {\n        return res.status(400).json({ error: 'Status is required' });\n      }\n\n      const statusUpdate = {\n        timestamp: new Date().toISOString(),\n        status,\n        location,\n        notes,\n        updatedBy: req.user!.userId,\n      };\n\n      const currentStatusUpdates = Array.isArray(shipment.statusUpdates)\n        ? shipment.statusUpdates\n        : [];\n\n      const updatedShipment = await prisma.shipment.update({\n        where: { id },\n        data: {\n          status: status as ShipmentStatus,\n          currentLocation: location,\n          statusUpdates: [...currentStatusUpdates, statusUpdate] as any,\n        },\n      });\n\n      await prisma.auditLog.create({\n        data: {\n          userId: req.user!.userId,\n          shipmentId: id,\n          action: 'UPDATE_STATUS',\n          entity: 'SHIPMENT',\n          entityId: id,\n          changes: { status, location },\n        },\n      });\n\n      res.status(200).json({\n        shipment: updatedShipment,\n        message: 'Shipment status updated successfully',\n      });\n    } catch (error) {\n      console.error('Error updating shipment:', error);\n      res.status(500).json({ error: 'Failed to update shipment' });\n    }\n  } else {\n    res.status(405).json({ error: 'Method not allowed' });\n  }\n}\n\nexport default withAuth(handler);\n","size_bytes":3833},"pages/api/quotes/index.ts":{"content":"import { NextApiResponse } from 'next';\nimport prisma from '@/lib/prisma';\nimport { withAuth, AuthenticatedRequest } from '@/lib/middleware';\nimport { QuoteStatus, UserRole } from '@prisma/client';\nimport { findMatchingPartners, notifyMatchedPartners } from '@/lib/matching-engine';\n\nasync function handler(req: AuthenticatedRequest, res: NextApiResponse) {\n  if (req.method === 'GET') {\n    try {\n      const { status, limit = 50, offset = 0 } = req.query;\n\n      const where: any = {};\n\n      if (req.user!.role === UserRole.TRADER) {\n        where.traderId = req.user!.userId;\n      }\n\n      if (status && typeof status === 'string') {\n        where.status = status as QuoteStatus;\n      }\n\n      const quotes = await prisma.quote.findMany({\n        where,\n        include: {\n          trader: {\n            select: {\n              id: true,\n              email: true,\n              companyName: true,\n            },\n          },\n          offers: {\n            select: {\n              id: true,\n              price: true,\n              status: true,\n              partnerId: true,\n            },\n          },\n        },\n        orderBy: {\n          createdAt: 'desc',\n        },\n        take: Number(limit),\n        skip: Number(offset),\n      });\n\n      const total = await prisma.quote.count({ where });\n\n      res.status(200).json({\n        quotes,\n        pagination: {\n          total,\n          limit: Number(limit),\n          offset: Number(offset),\n        },\n      });\n    } catch (error) {\n      console.error('Error fetching quotes:', error);\n      res.status(500).json({ error: 'Failed to fetch quotes' });\n    }\n  } else if (req.method === 'POST') {\n    try {\n      if (req.user!.role !== UserRole.TRADER) {\n        return res.status(403).json({\n          error: 'Only traders can create freight requests',\n        });\n      }\n\n      const quoteData = req.body;\n\n      if (!quoteData.cargoName || !quoteData.quantity || !quoteData.quantityUnit ||\n          !quoteData.cargoReadyDate || !quoteData.pickupAddress || !quoteData.pickupCity ||\n          !quoteData.pickupState || !quoteData.pickupPincode || !quoteData.deliveryAddress ||\n          !quoteData.deliveryCity || !quoteData.deliveryState || !quoteData.deliveryPincode ||\n          !quoteData.packagingType) {\n        return res.status(400).json({\n          error: 'Missing required fields. Please check all mandatory sections.',\n        });\n      }\n\n      if (quoteData.isHazardous && !quoteData.hazardClass) {\n        return res.status(400).json({\n          error: 'Hazard class is required for hazardous cargo',\n        });\n      }\n\n      const quoteNumber = `FRQ-${Date.now()}-${Math.random().toString(36).substr(2, 9).toUpperCase()}`;\n\n      const expiresAt = new Date();\n      expiresAt.setHours(expiresAt.getHours() + 48);\n\n      const quote = await prisma.quote.create({\n        data: {\n          quoteNumber,\n          traderId: req.user!.userId,\n          status: QuoteStatus.SUBMITTED,\n          cargoName: quoteData.cargoName,\n          casNumber: quoteData.casNumber || null,\n          quantity: quoteData.quantity,\n          quantityUnit: quoteData.quantityUnit,\n          isHazardous: quoteData.isHazardous,\n          hazardClass: quoteData.hazardClass || null,\n          unNumber: quoteData.unNumber || null,\n          cargoReadyDate: new Date(quoteData.cargoReadyDate),\n          estimatedDeliveryDate: quoteData.estimatedDeliveryDate\n            ? new Date(quoteData.estimatedDeliveryDate)\n            : null,\n          pickupAddress: quoteData.pickupAddress,\n          pickupCity: quoteData.pickupCity,\n          pickupState: quoteData.pickupState,\n          pickupPincode: quoteData.pickupPincode,\n          pickupCountry: quoteData.pickupCountry || 'India',\n          pickupContactName: quoteData.pickupContactName || null,\n          pickupContactPhone: quoteData.pickupContactPhone || null,\n          deliveryAddress: quoteData.deliveryAddress,\n          deliveryCity: quoteData.deliveryCity,\n          deliveryState: quoteData.deliveryState,\n          deliveryPincode: quoteData.deliveryPincode,\n          deliveryCountry: quoteData.deliveryCountry || 'India',\n          deliveryContactName: quoteData.deliveryContactName || null,\n          deliveryContactPhone: quoteData.deliveryContactPhone || null,\n          packagingType: quoteData.packagingType,\n          packagingDetails: quoteData.packagingDetails || null,\n          specialHandling: quoteData.specialHandling || null,\n          temperatureControlled: quoteData.temperatureControlled || false,\n          temperatureMin: quoteData.temperatureMin || null,\n          temperatureMax: quoteData.temperatureMax || null,\n          preferredVehicleType: quoteData.preferredVehicleType || [],\n          vehicleSpecifications: quoteData.vehicleSpecifications || null,\n          insuranceRequired: quoteData.insuranceRequired || false,\n          insuranceValue: quoteData.insuranceValue || null,\n          msdsRequired: quoteData.msdsRequired || false,\n          paymentTerms: quoteData.paymentTerms || null,\n          billingAddress: quoteData.billingAddress || null,\n          additionalNotes: quoteData.additionalNotes || null,\n          expiresAt,\n          submittedAt: new Date(),\n        },\n        include: {\n          trader: {\n            select: {\n              id: true,\n              email: true,\n              companyName: true,\n            },\n          },\n        },\n      });\n\n      await prisma.auditLog.create({\n        data: {\n          userId: req.user!.userId,\n          quoteId: quote.id,\n          action: 'CREATE',\n          entity: 'QUOTE',\n          entityId: quote.id,\n          changes: { quoteNumber: quote.quoteNumber },\n        },\n      });\n\n      try {\n        const matchedPartners = await findMatchingPartners(quote.id);\n        await notifyMatchedPartners(quote.id, matchedPartners);\n        \n        if (matchedPartners.length > 0) {\n          const { startQuoteTimer } = await import('@/lib/quote-timer');\n          const timerExpiresAt = await startQuoteTimer({\n            quoteId: quote.id,\n            timerDurationMinutes: 60,\n            enableWarnings: true,\n          });\n          \n          await prisma.quote.update({\n            where: { id: quote.id },\n            data: { \n              status: QuoteStatus.MATCHING,\n              expiresAt: timerExpiresAt,\n            },\n          });\n        }\n      } catch (matchError) {\n        console.error('Error matching partners:', matchError);\n      }\n\n      res.status(201).json({\n        quote,\n        message: 'Freight request created successfully',\n      });\n    } catch (error) {\n      console.error('Error creating quote:', error);\n      res.status(500).json({ error: 'Failed to create freight request' });\n    }\n  } else {\n    res.status(405).json({ error: 'Method not allowed' });\n  }\n}\n\nexport default withAuth(handler);\n","size_bytes":6872},"tailwind.config.js":{"content":"/** @type {import('tailwindcss').Config} */\nmodule.exports = {\n  content: [\n    \"./pages/**/*.{js,ts,jsx,tsx}\",\n    \"./components/**/*.{js,ts,jsx,tsx}\",\n  ],\n  theme: {\n    extend: {\n      colors: {\n        primary: {\n          50: '#eff6ff',\n          100: '#dbeafe',\n          200: '#bfdbfe',\n          300: '#93c5fd',\n          400: '#60a5fa',\n          500: '#3b82f6',\n          600: '#2563eb',\n          700: '#1d4ed8',\n          800: '#1e40af',\n          900: '#1e3a8a',\n          950: '#172554',\n        },\n        secondary: {\n          50: '#f8fafc',\n          100: '#f1f5f9',\n          200: '#e2e8f0',\n          300: '#cbd5e1',\n          400: '#94a3b8',\n          500: '#64748b',\n          600: '#475569',\n          700: '#334155',\n          800: '#1e293b',\n          900: '#0f172a',\n          950: '#020617',\n        },\n        success: {\n          50: '#f0fdf4',\n          100: '#dcfce7',\n          200: '#bbf7d0',\n          300: '#86efac',\n          400: '#4ade80',\n          500: '#22c55e',\n          600: '#16a34a',\n          700: '#15803d',\n          800: '#166534',\n          900: '#14532d',\n        },\n        warning: {\n          50: '#fefce8',\n          100: '#fef9c3',\n          200: '#fef08a',\n          300: '#fde047',\n          400: '#facc15',\n          500: '#eab308',\n          600: '#ca8a04',\n          700: '#a16207',\n          800: '#854d0e',\n          900: '#713f12',\n        },\n        danger: {\n          50: '#fef2f2',\n          100: '#fee2e2',\n          200: '#fecaca',\n          300: '#fca5a5',\n          400: '#f87171',\n          500: '#ef4444',\n          600: '#dc2626',\n          700: '#b91c1c',\n          800: '#991b1b',\n          900: '#7f1d1d',\n        },\n        neutral: {\n          50: '#fafafa',\n          100: '#f5f5f5',\n          200: '#e5e5e5',\n          300: '#d4d4d4',\n          400: '#a3a3a3',\n          500: '#737373',\n          600: '#525252',\n          700: '#404040',\n          800: '#262626',\n          900: '#171717',\n          950: '#0a0a0a',\n        },\n      },\n      fontFamily: {\n        sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],\n        mono: ['JetBrains Mono', 'Menlo', 'Monaco', 'Courier New', 'monospace'],\n      },\n      fontSize: {\n        'xs': ['0.75rem', { lineHeight: '1rem' }],\n        'sm': ['0.875rem', { lineHeight: '1.25rem' }],\n        'base': ['1rem', { lineHeight: '1.5rem' }],\n        'lg': ['1.125rem', { lineHeight: '1.75rem' }],\n        'xl': ['1.25rem', { lineHeight: '1.75rem' }],\n        '2xl': ['1.5rem', { lineHeight: '2rem' }],\n        '3xl': ['1.875rem', { lineHeight: '2.25rem' }],\n        '4xl': ['2.25rem', { lineHeight: '2.5rem' }],\n        '5xl': ['3rem', { lineHeight: '1' }],\n      },\n      spacing: {\n        '128': '32rem',\n        '144': '36rem',\n      },\n      borderRadius: {\n        'sm': '0.25rem',\n        'DEFAULT': '0.375rem',\n        'md': '0.5rem',\n        'lg': '0.75rem',\n        'xl': '1rem',\n        '2xl': '1.5rem',\n      },\n      boxShadow: {\n        'sm': '0 1px 2px 0 rgb(0 0 0 / 0.05)',\n        'DEFAULT': '0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)',\n        'md': '0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)',\n        'lg': '0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)',\n        'xl': '0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1)',\n        '2xl': '0 25px 50px -12px rgb(0 0 0 / 0.25)',\n        'inner': 'inset 0 2px 4px 0 rgb(0 0 0 / 0.05)',\n        'card': '0 2px 8px 0 rgb(0 0 0 / 0.08)',\n        'card-hover': '0 4px 16px 0 rgb(0 0 0 / 0.12)',\n      },\n      animation: {\n        'fade-in': 'fadeIn 0.2s ease-in-out',\n        'slide-in': 'slideIn 0.3s ease-out',\n        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',\n      },\n      keyframes: {\n        fadeIn: {\n          '0%': { opacity: '0' },\n          '100%': { opacity: '1' },\n        },\n        slideIn: {\n          '0%': { transform: 'translateY(-10px)', opacity: '0' },\n          '100%': { transform: 'translateY(0)', opacity: '1' },\n        },\n      },\n    },\n  },\n  plugins: [],\n}\n","size_bytes":4161},"pages/api/auth/login.ts":{"content":"import { NextApiRequest, NextApiResponse } from 'next';\nimport prisma from '@/lib/prisma';\nimport { verifyPassword, generateToken } from '@/lib/auth';\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  try {\n    const { email, password } = req.body;\n\n    if (!email || !password) {\n      return res.status(400).json({\n        error: 'Email and password are required',\n      });\n    }\n\n    const user = await prisma.user.findUnique({\n      where: { email },\n    });\n\n    if (!user) {\n      return res.status(401).json({\n        error: 'Invalid email or password',\n      });\n    }\n\n    if (!user.isActive) {\n      return res.status(403).json({\n        error: 'Account is deactivated. Please contact support.',\n      });\n    }\n\n    const isValidPassword = await verifyPassword(password, user.password);\n\n    if (!isValidPassword) {\n      return res.status(401).json({\n        error: 'Invalid email or password',\n      });\n    }\n\n    const token = generateToken({\n      userId: user.id,\n      email: user.email,\n      role: user.role,\n      companyName: user.companyName || undefined,\n    });\n\n    await prisma.auditLog.create({\n      data: {\n        userId: user.id,\n        action: 'LOGIN',\n        entity: 'USER',\n        entityId: user.id,\n      },\n    });\n\n    res.status(200).json({\n      user: {\n        id: user.id,\n        email: user.email,\n        role: user.role,\n        companyName: user.companyName,\n        isVerified: user.isVerified,\n      },\n      token,\n      message: 'Login successful',\n    });\n  } catch (error) {\n    console.error('Login error:', error);\n    res.status(500).json({ error: 'Internal server error' });\n  }\n}\n","size_bytes":1786},"pages/quotes/new.tsx":{"content":"import React, { useState } from 'react';\nimport { Layout } from '@/components/layout/Layout';\nimport { FormSection } from '@/components/forms/FormSection';\nimport { FormField } from '@/components/forms/FormField';\nimport { CheckboxGroup } from '@/components/forms/CheckboxGroup';\nimport Button from '@/components/ui/Button';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useRouter } from 'next/router';\nimport { PackagingType, VehicleType, HazardClass } from '@prisma/client';\n\nexport default function NewQuote() {\n  const { user, token } = useAuth();\n  const router = useRouter();\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const [formData, setFormData] = useState({\n    cargoName: '',\n    casNumber: '',\n    quantity: '',\n    quantityUnit: 'MT',\n    isHazardous: false,\n    hazardClass: '',\n    unNumber: '',\n    cargoReadyDate: '',\n    estimatedDeliveryDate: '',\n    pickupAddress: '',\n    pickupCity: '',\n    pickupState: '',\n    pickupPincode: '',\n    pickupCountry: 'India',\n    pickupContactName: '',\n    pickupContactPhone: '',\n    deliveryAddress: '',\n    deliveryCity: '',\n    deliveryState: '',\n    deliveryPincode: '',\n    deliveryCountry: 'India',\n    deliveryContactName: '',\n    deliveryContactPhone: '',\n    packagingType: '',\n    packagingDetails: '',\n    specialHandling: '',\n    temperatureControlled: false,\n    temperatureMin: '',\n    temperatureMax: '',\n    preferredVehicleType: [] as string[],\n    vehicleSpecifications: '',\n    insuranceRequired: false,\n    insuranceValue: '',\n    msdsRequired: false,\n    paymentTerms: '',\n    billingAddress: '',\n    additionalNotes: '',\n  });\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\n    const { name, value, type } = e.target;\n    const checked = (e.target as HTMLInputElement).checked;\n\n    setFormData(prev => ({\n      ...prev,\n      [name]: type === 'checkbox' ? checked : value,\n    }));\n\n    if (errors[name]) {\n      setErrors(prev => {\n        const newErrors = { ...prev };\n        delete newErrors[name];\n        return newErrors;\n      });\n    }\n  };\n\n  const handleCheckboxGroupChange = (name: string, values: string[]) => {\n    setFormData(prev => ({ ...prev, [name]: values }));\n  };\n\n  const validateForm = () => {\n    const newErrors: Record<string, string> = {};\n\n    if (!formData.cargoName) newErrors.cargoName = 'Cargo name is required';\n    if (!formData.quantity) newErrors.quantity = 'Quantity is required';\n    if (!formData.quantityUnit) newErrors.quantityUnit = 'Quantity unit is required';\n    if (!formData.cargoReadyDate) newErrors.cargoReadyDate = 'Cargo ready date is required';\n    if (!formData.pickupAddress) newErrors.pickupAddress = 'Pickup address is required';\n    if (!formData.pickupCity) newErrors.pickupCity = 'Pickup city is required';\n    if (!formData.pickupState) newErrors.pickupState = 'Pickup state is required';\n    if (!formData.pickupPincode) newErrors.pickupPincode = 'Pickup pincode is required';\n    if (!formData.deliveryAddress) newErrors.deliveryAddress = 'Delivery address is required';\n    if (!formData.deliveryCity) newErrors.deliveryCity = 'Delivery city is required';\n    if (!formData.deliveryState) newErrors.deliveryState = 'Delivery state is required';\n    if (!formData.deliveryPincode) newErrors.deliveryPincode = 'Delivery pincode is required';\n    if (!formData.packagingType) newErrors.packagingType = 'Packaging type is required';\n    if (formData.isHazardous && !formData.hazardClass) {\n      newErrors.hazardClass = 'Hazard class is required for hazardous cargo';\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!validateForm()) {\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      const response = await fetch('/api/quotes', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        body: JSON.stringify({\n          ...formData,\n          quantity: parseFloat(formData.quantity),\n          temperatureMin: formData.temperatureMin ? parseFloat(formData.temperatureMin) : null,\n          temperatureMax: formData.temperatureMax ? parseFloat(formData.temperatureMax) : null,\n          insuranceValue: formData.insuranceValue ? parseFloat(formData.insuranceValue) : null,\n        }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Failed to create quote');\n      }\n\n      router.push(`/quotes/${data.quote.id}`);\n    } catch (error) {\n      console.error('Error creating quote:', error);\n      alert(error instanceof Error ? error.message : 'Failed to create quote');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (!user) {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">\n          <p className=\"text-gray-600\">Please log in to create a freight request</p>\n        </div>\n      </Layout>\n    );\n  }\n\n  return (\n    <Layout>\n      <div className=\"max-w-4xl mx-auto\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-8\">New Freight Request</h1>\n\n        <form onSubmit={handleSubmit}>\n          <FormSection\n            title=\"1. Shipment Information\"\n            description=\"Basic details about your cargo\"\n          >\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                label=\"Cargo Name\"\n                name=\"cargoName\"\n                value={formData.cargoName}\n                onChange={handleChange}\n                error={errors.cargoName}\n                required\n                placeholder=\"e.g., Sulfuric Acid\"\n              />\n              <FormField\n                label=\"CAS Number\"\n                name=\"casNumber\"\n                value={formData.casNumber}\n                onChange={handleChange}\n                placeholder=\"e.g., 7664-93-9\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-3 gap-4\">\n              <FormField\n                label=\"Quantity\"\n                name=\"quantity\"\n                type=\"number\"\n                value={formData.quantity}\n                onChange={handleChange}\n                error={errors.quantity}\n                required\n                min=\"0\"\n                step=\"0.01\"\n              />\n              <FormField\n                label=\"Unit\"\n                name=\"quantityUnit\"\n                type=\"select\"\n                value={formData.quantityUnit}\n                onChange={handleChange}\n                options={[\n                  { label: 'MT (Metric Ton)', value: 'MT' },\n                  { label: 'KG (Kilogram)', value: 'KG' },\n                  { label: 'Litre', value: 'Litre' },\n                ]}\n                required\n              />\n              <div className=\"flex items-center pt-8\">\n                <input\n                  type=\"checkbox\"\n                  id=\"isHazardous\"\n                  name=\"isHazardous\"\n                  checked={formData.isHazardous}\n                  onChange={handleChange}\n                  className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                />\n                <label htmlFor=\"isHazardous\" className=\"ml-2 text-sm text-gray-700\">\n                  Hazardous Cargo\n                </label>\n              </div>\n            </div>\n\n            {formData.isHazardous && (\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  label=\"Hazard Class\"\n                  name=\"hazardClass\"\n                  type=\"select\"\n                  value={formData.hazardClass}\n                  onChange={handleChange}\n                  error={errors.hazardClass}\n                  options={Object.values(HazardClass).map(hc => ({\n                    label: hc.replace('_', ' '),\n                    value: hc,\n                  }))}\n                  required\n                />\n                <FormField\n                  label=\"UN Number\"\n                  name=\"unNumber\"\n                  value={formData.unNumber}\n                  onChange={handleChange}\n                  placeholder=\"e.g., UN1830\"\n                />\n              </div>\n            )}\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                label=\"Cargo Ready Date\"\n                name=\"cargoReadyDate\"\n                type=\"datetime-local\"\n                value={formData.cargoReadyDate}\n                onChange={handleChange}\n                error={errors.cargoReadyDate}\n                required\n              />\n              <FormField\n                label=\"Estimated Delivery Date\"\n                name=\"estimatedDeliveryDate\"\n                type=\"datetime-local\"\n                value={formData.estimatedDeliveryDate}\n                onChange={handleChange}\n              />\n            </div>\n          </FormSection>\n\n          <FormSection\n            title=\"2. Pickup Location\"\n            description=\"Where should the cargo be collected?\"\n          >\n            <FormField\n              label=\"Address\"\n              name=\"pickupAddress\"\n              type=\"textarea\"\n              value={formData.pickupAddress}\n              onChange={handleChange}\n              error={errors.pickupAddress}\n              required\n            />\n            <div className=\"grid grid-cols-3 gap-4\">\n              <FormField\n                label=\"City\"\n                name=\"pickupCity\"\n                value={formData.pickupCity}\n                onChange={handleChange}\n                error={errors.pickupCity}\n                required\n              />\n              <FormField\n                label=\"State\"\n                name=\"pickupState\"\n                value={formData.pickupState}\n                onChange={handleChange}\n                error={errors.pickupState}\n                required\n              />\n              <FormField\n                label=\"Pincode\"\n                name=\"pickupPincode\"\n                value={formData.pickupPincode}\n                onChange={handleChange}\n                error={errors.pickupPincode}\n                required\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                label=\"Contact Name\"\n                name=\"pickupContactName\"\n                value={formData.pickupContactName}\n                onChange={handleChange}\n              />\n              <FormField\n                label=\"Contact Phone\"\n                name=\"pickupContactPhone\"\n                type=\"text\"\n                value={formData.pickupContactPhone}\n                onChange={handleChange}\n              />\n            </div>\n          </FormSection>\n\n          <FormSection\n            title=\"3. Delivery Location\"\n            description=\"Where should the cargo be delivered?\"\n          >\n            <FormField\n              label=\"Address\"\n              name=\"deliveryAddress\"\n              type=\"textarea\"\n              value={formData.deliveryAddress}\n              onChange={handleChange}\n              error={errors.deliveryAddress}\n              required\n            />\n            <div className=\"grid grid-cols-3 gap-4\">\n              <FormField\n                label=\"City\"\n                name=\"deliveryCity\"\n                value={formData.deliveryCity}\n                onChange={handleChange}\n                error={errors.deliveryCity}\n                required\n              />\n              <FormField\n                label=\"State\"\n                name=\"deliveryState\"\n                value={formData.deliveryState}\n                onChange={handleChange}\n                error={errors.deliveryState}\n                required\n              />\n              <FormField\n                label=\"Pincode\"\n                name=\"deliveryPincode\"\n                value={formData.deliveryPincode}\n                onChange={handleChange}\n                error={errors.deliveryPincode}\n                required\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                label=\"Contact Name\"\n                name=\"deliveryContactName\"\n                value={formData.deliveryContactName}\n                onChange={handleChange}\n              />\n              <FormField\n                label=\"Contact Phone\"\n                name=\"deliveryContactPhone\"\n                type=\"text\"\n                value={formData.deliveryContactPhone}\n                onChange={handleChange}\n              />\n            </div>\n          </FormSection>\n\n          <FormSection\n            title=\"4. Handling Requirements\"\n            description=\"Packaging and special handling needs\"\n          >\n            <FormField\n              label=\"Packaging Type\"\n              name=\"packagingType\"\n              type=\"select\"\n              value={formData.packagingType}\n              onChange={handleChange}\n              error={errors.packagingType}\n              options={Object.values(PackagingType).map(pt => ({\n                label: pt.replace('_', ' '),\n                value: pt,\n              }))}\n              required\n            />\n            <FormField\n              label=\"Packaging Details\"\n              name=\"packagingDetails\"\n              type=\"textarea\"\n              value={formData.packagingDetails}\n              onChange={handleChange}\n              placeholder=\"Describe any specific packaging requirements\"\n            />\n            <FormField\n              label=\"Special Handling Instructions\"\n              name=\"specialHandling\"\n              type=\"textarea\"\n              value={formData.specialHandling}\n              onChange={handleChange}\n              placeholder=\"Any special handling requirements\"\n            />\n\n            <div className=\"flex items-center mb-4\">\n              <input\n                type=\"checkbox\"\n                id=\"temperatureControlled\"\n                name=\"temperatureControlled\"\n                checked={formData.temperatureControlled}\n                onChange={handleChange}\n                className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n              />\n              <label htmlFor=\"temperatureControlled\" className=\"ml-2 text-sm text-gray-700\">\n                Temperature Controlled\n              </label>\n            </div>\n\n            {formData.temperatureControlled && (\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  label=\"Min Temperature (C)\"\n                  name=\"temperatureMin\"\n                  type=\"number\"\n                  value={formData.temperatureMin}\n                  onChange={handleChange}\n                  step=\"0.1\"\n                />\n                <FormField\n                  label=\"Max Temperature (C)\"\n                  name=\"temperatureMax\"\n                  type=\"number\"\n                  value={formData.temperatureMax}\n                  onChange={handleChange}\n                  step=\"0.1\"\n                />\n              </div>\n            )}\n          </FormSection>\n\n          <FormSection\n            title=\"5. Vehicle Requirements\"\n            description=\"Preferred vehicle types for transportation\"\n          >\n            <CheckboxGroup\n              label=\"Preferred Vehicle Types\"\n              name=\"preferredVehicleType\"\n              value={formData.preferredVehicleType}\n              onChange={(values) => handleCheckboxGroupChange('preferredVehicleType', values)}\n              options={Object.values(VehicleType).map(vt => ({\n                label: vt.replace('_', ' '),\n                value: vt,\n              }))}\n            />\n            <FormField\n              label=\"Vehicle Specifications\"\n              name=\"vehicleSpecifications\"\n              type=\"textarea\"\n              value={formData.vehicleSpecifications}\n              onChange={handleChange}\n              placeholder=\"Any specific vehicle requirements or specifications\"\n            />\n          </FormSection>\n\n          <FormSection\n            title=\"6. Insurance & Compliance\"\n            description=\"Insurance and documentation requirements\"\n          >\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center\">\n                <input\n                  type=\"checkbox\"\n                  id=\"insuranceRequired\"\n                  name=\"insuranceRequired\"\n                  checked={formData.insuranceRequired}\n                  onChange={handleChange}\n                  className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                />\n                <label htmlFor=\"insuranceRequired\" className=\"ml-2 text-sm text-gray-700\">\n                  Insurance Required\n                </label>\n              </div>\n\n              {formData.insuranceRequired && (\n                <FormField\n                  label=\"Insurance Value (INR)\"\n                  name=\"insuranceValue\"\n                  type=\"number\"\n                  value={formData.insuranceValue}\n                  onChange={handleChange}\n                  min=\"0\"\n                  step=\"0.01\"\n                />\n              )}\n\n              <div className=\"flex items-center\">\n                <input\n                  type=\"checkbox\"\n                  id=\"msdsRequired\"\n                  name=\"msdsRequired\"\n                  checked={formData.msdsRequired}\n                  onChange={handleChange}\n                  className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                />\n                <label htmlFor=\"msdsRequired\" className=\"ml-2 text-sm text-gray-700\">\n                  MSDS/SDS Required\n                </label>\n              </div>\n            </div>\n          </FormSection>\n\n          <FormSection\n            title=\"7. Billing & Payment\"\n            description=\"Payment terms and billing information\"\n          >\n            <FormField\n              label=\"Payment Terms\"\n              name=\"paymentTerms\"\n              type=\"textarea\"\n              value={formData.paymentTerms}\n              onChange={handleChange}\n              placeholder=\"e.g., Net 30, Advance payment, etc.\"\n            />\n            <FormField\n              label=\"Billing Address\"\n              name=\"billingAddress\"\n              type=\"textarea\"\n              value={formData.billingAddress}\n              onChange={handleChange}\n              placeholder=\"If different from pickup/delivery address\"\n            />\n          </FormSection>\n\n          <FormSection\n            title=\"8. Additional Notes\"\n            description=\"Any other information you'd like to share\"\n          >\n            <FormField\n              label=\"Notes\"\n              name=\"additionalNotes\"\n              type=\"textarea\"\n              value={formData.additionalNotes}\n              onChange={handleChange}\n              placeholder=\"Any additional requirements or information\"\n            />\n          </FormSection>\n\n          <div className=\"flex justify-end space-x-4 mt-8\">\n            <Button\n              type=\"button\"\n              variant=\"secondary\"\n              onClick={() => router.back()}\n            >\n              Cancel\n            </Button>\n            <Button\n              type=\"submit\"\n              variant=\"primary\"\n              disabled={isSubmitting}\n            >\n              {isSubmitting ? 'Submitting...' : 'Submit Freight Request'}\n            </Button>\n          </div>\n        </form>\n      </div>\n    </Layout>\n  );\n}\n","size_bytes":19706},"prisma.config.ts":{"content":"// This file was generated by Prisma and assumes you have installed the following:\n// npm install --save-dev prisma dotenv\nimport \"dotenv/config\";\nimport { defineConfig, env } from \"prisma/config\";\n\nexport default defineConfig({\n  schema: \"prisma/schema.prisma\",\n  migrations: {\n    path: \"prisma/migrations\",\n  },\n  datasource: {\n    url: env(\"DATABASE_URL\"),\n  },\n});\n","size_bytes":370},"components/ui/Badge.tsx":{"content":"import React from 'react';\n\nexport interface BadgeProps {\n  children: React.ReactNode;\n  variant?: 'primary' | 'success' | 'warning' | 'danger' | 'neutral';\n  size?: 'sm' | 'md' | 'lg';\n  className?: string;\n  dot?: boolean;\n}\n\nconst Badge: React.FC<BadgeProps> = ({\n  children,\n  variant = 'neutral',\n  size = 'md',\n  className = '',\n  dot = false,\n}) => {\n  const baseStyles = 'inline-flex items-center font-medium rounded-full';\n  \n  const variantStyles = {\n    primary: 'bg-primary-100 text-primary-800 border border-primary-200',\n    success: 'bg-success-100 text-success-800 border border-success-200',\n    warning: 'bg-warning-100 text-warning-800 border border-warning-200',\n    danger: 'bg-danger-100 text-danger-800 border border-danger-200',\n    neutral: 'bg-neutral-100 text-neutral-800 border border-neutral-200',\n  };\n  \n  const sizeStyles = {\n    sm: 'px-2 py-0.5 text-xs',\n    md: 'px-2.5 py-1 text-sm',\n    lg: 'px-3 py-1.5 text-base',\n  };\n  \n  const dotColors = {\n    primary: 'bg-primary-600',\n    success: 'bg-success-600',\n    warning: 'bg-warning-600',\n    danger: 'bg-danger-600',\n    neutral: 'bg-neutral-600',\n  };\n  \n  return (\n    <span className={`${baseStyles} ${variantStyles[variant]} ${sizeStyles[size]} ${className}`}>\n      {dot && <span className={`w-2 h-2 rounded-full mr-1.5 ${dotColors[variant]}`}></span>}\n      {children}\n    </span>\n  );\n};\n\nexport default Badge;\n","size_bytes":1406},"components/ui/Textarea.tsx":{"content":"import React, { useId } from 'react';\n\nexport interface TextareaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {\n  label?: string;\n  error?: string;\n  hint?: string;\n}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ label, error, hint, className = '', id: providedId, ...props }, ref) => {\n    const generatedId = useId();\n    const textareaId = providedId || generatedId;\n    const errorId = `${textareaId}-error`;\n    const hintId = `${textareaId}-hint`;\n    \n    return (\n      <div className=\"w-full\">\n        {label && (\n          <label htmlFor={textareaId} className=\"block text-sm font-medium text-secondary-700 mb-1\">\n            {label}\n            {props.required && <span className=\"text-danger-500 ml-1\">*</span>}\n          </label>\n        )}\n        <textarea\n          ref={ref}\n          id={textareaId}\n          aria-invalid={error ? 'true' : 'false'}\n          aria-describedby={error ? errorId : hint ? hintId : undefined}\n          className={`\n            w-full px-4 py-2 border rounded-md transition-all duration-200\n            ${error \n              ? 'border-danger-500 focus:border-danger-500 focus:ring-danger-500' \n              : 'border-secondary-300 focus:border-primary-500 focus:ring-primary-500'\n            }\n            focus:outline-none focus:ring-2 focus:ring-offset-0\n            disabled:bg-secondary-50 disabled:cursor-not-allowed\n            resize-vertical min-h-[100px]\n            ${className}\n          `}\n          {...props}\n        />\n        {error && (\n          <p id={errorId} className=\"mt-1 text-sm text-danger-600\" role=\"alert\">\n            {error}\n          </p>\n        )}\n        {hint && !error && (\n          <p id={hintId} className=\"mt-1 text-sm text-secondary-500\">\n            {hint}\n          </p>\n        )}\n      </div>\n    );\n  }\n);\n\nTextarea.displayName = 'Textarea';\n\nexport default Textarea;\n","size_bytes":1914},"pages/_document.tsx":{"content":"import { Html, Head, Main, NextScript } from 'next/document';\n\nexport default function Document() {\n  return (\n    <Html lang=\"en\">\n      <Head>\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossOrigin=\"anonymous\" />\n        <link \n          href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap\" \n          rel=\"stylesheet\" \n        />\n      </Head>\n      <body>\n        <Main />\n        <NextScript />\n      </body>\n    </Html>\n  );\n}\n","size_bytes":594},"pages/login.tsx":{"content":"import React, { useState } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useRouter } from 'next/router';\nimport Button from '@/components/ui/Button';\nimport Input from '@/components/ui/Input';\nimport Card from '@/components/ui/Card';\nimport Link from 'next/link';\n\nexport default function Login() {\n  const { login } = useAuth();\n  const router = useRouter();\n  const [formData, setFormData] = useState({\n    email: '',\n    password: '',\n  });\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value,\n    });\n    setError('');\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setError('');\n\n    try {\n      await login(formData.email, formData.password);\n      router.push('/');\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Login failed');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-md w-full\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-blue-600 mb-2\">BidChemz Logistics</h1>\n          <h2 className=\"text-xl text-gray-900\">Sign in to your account</h2>\n        </div>\n\n        <Card>\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {error && (\n              <div className=\"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded\">\n                {error}\n              </div>\n            )}\n\n            <Input\n              label=\"Email Address\"\n              type=\"email\"\n              name=\"email\"\n              value={formData.email}\n              onChange={handleChange}\n              required\n              placeholder=\"you@example.com\"\n            />\n\n            <Input\n              label=\"Password\"\n              type=\"password\"\n              name=\"password\"\n              value={formData.password}\n              onChange={handleChange}\n              required\n              placeholder=\"Enter your password\"\n            />\n\n            <Button\n              type=\"submit\"\n              variant=\"primary\"\n              disabled={loading}\n              className=\"w-full\"\n            >\n              {loading ? 'Signing in...' : 'Sign In'}\n            </Button>\n\n            <div className=\"text-center text-sm\">\n              <span className=\"text-gray-600\">Don't have an account? </span>\n              <Link href=\"/signup\" className=\"text-blue-600 hover:text-blue-700 font-medium\">\n                Sign up\n              </Link>\n            </div>\n          </form>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":2859},"components/ui/Select.tsx":{"content":"import React, { useId } from 'react';\n\nexport interface SelectOption {\n  value: string;\n  label: string;\n}\n\nexport interface SelectProps extends React.SelectHTMLAttributes<HTMLSelectElement> {\n  label?: string;\n  error?: string;\n  hint?: string;\n  options: SelectOption[];\n}\n\nconst Select = React.forwardRef<HTMLSelectElement, SelectProps>(\n  ({ label, error, hint, options, className = '', id: providedId, ...props }, ref) => {\n    const generatedId = useId();\n    const selectId = providedId || generatedId;\n    const errorId = `${selectId}-error`;\n    const hintId = `${selectId}-hint`;\n    \n    return (\n      <div className=\"w-full\">\n        {label && (\n          <label htmlFor={selectId} className=\"block text-sm font-medium text-secondary-700 mb-1\">\n            {label}\n            {props.required && <span className=\"text-danger-500 ml-1\">*</span>}\n          </label>\n        )}\n        <select\n          ref={ref}\n          id={selectId}\n          aria-invalid={error ? 'true' : 'false'}\n          aria-describedby={error ? errorId : hint ? hintId : undefined}\n          className={`\n            w-full px-4 py-2 border rounded-md transition-all duration-200\n            ${error \n              ? 'border-danger-500 focus:border-danger-500 focus:ring-danger-500' \n              : 'border-secondary-300 focus:border-primary-500 focus:ring-primary-500'\n            }\n            focus:outline-none focus:ring-2 focus:ring-offset-0\n            disabled:bg-secondary-50 disabled:cursor-not-allowed\n            appearance-none bg-white\n            ${className}\n          `}\n          {...props}\n        >\n          {options.map((option) => (\n            <option key={option.value} value={option.value}>\n              {option.label}\n            </option>\n          ))}\n        </select>\n        {error && (\n          <p id={errorId} className=\"mt-1 text-sm text-danger-600\" role=\"alert\">\n            {error}\n          </p>\n        )}\n        {hint && !error && (\n          <p id={hintId} className=\"mt-1 text-sm text-secondary-500\">\n            {hint}\n          </p>\n        )}\n      </div>\n    );\n  }\n);\n\nSelect.displayName = 'Select';\n\nexport default Select;\n","size_bytes":2164},"components/ui/Table.tsx":{"content":"import React from 'react';\n\nexport interface Column<T> {\n  key: string;\n  header: string;\n  render?: (value: any, row: T) => React.ReactNode;\n  sortable?: boolean;\n  width?: string;\n}\n\nexport interface TableProps<T> {\n  data: T[];\n  columns: Column<T>[];\n  onRowClick?: (row: T) => void;\n  hoverable?: boolean;\n  striped?: boolean;\n  compact?: boolean;\n  emptyMessage?: string;\n}\n\nfunction Table<T extends Record<string, any>>({\n  data,\n  columns,\n  onRowClick,\n  hoverable = true,\n  striped = false,\n  compact = false,\n  emptyMessage = 'No data available',\n}: TableProps<T>) {\n  const rowPadding = compact ? 'px-4 py-2' : 'px-6 py-4';\n  \n  return (\n    <div className=\"overflow-x-auto border border-secondary-200 rounded-lg\">\n      <table className=\"min-w-full divide-y divide-secondary-200\">\n        <thead className=\"bg-secondary-50\">\n          <tr>\n            {columns.map((column) => (\n              <th\n                key={column.key}\n                scope=\"col\"\n                className={`${rowPadding} text-left text-xs font-semibold text-secondary-700 uppercase tracking-wider ${column.width || ''}`}\n              >\n                {column.header}\n              </th>\n            ))}\n          </tr>\n        </thead>\n        <tbody className=\"bg-white divide-y divide-secondary-200\">\n          {data.length === 0 ? (\n            <tr>\n              <td colSpan={columns.length} className=\"px-6 py-12 text-center text-secondary-500\">\n                {emptyMessage}\n              </td>\n            </tr>\n          ) : (\n            data.map((row, rowIndex) => (\n              <tr\n                key={rowIndex}\n                onClick={() => onRowClick?.(row)}\n                className={`\n                  ${striped && rowIndex % 2 === 1 ? 'bg-secondary-50' : 'bg-white'}\n                  ${hoverable ? 'hover:bg-primary-50 transition-colors duration-150' : ''}\n                  ${onRowClick ? 'cursor-pointer' : ''}\n                `}\n              >\n                {columns.map((column) => (\n                  <td key={column.key} className={`${rowPadding} text-sm text-secondary-900 ${column.width || ''}`}>\n                    {column.render \n                      ? column.render(row[column.key], row) \n                      : row[column.key]\n                    }\n                  </td>\n                ))}\n              </tr>\n            ))\n          )}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n\nexport default Table;\n","size_bytes":2450},"components/layout/Layout.tsx":{"content":"import React, { ReactNode } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport Link from 'next/link';\nimport { useRouter } from 'next/router';\n\ninterface LayoutProps {\n  children: ReactNode;\n}\n\nexport function Layout({ children }: LayoutProps) {\n  const { user, logout } = useAuth();\n  const router = useRouter();\n\n  const handleLogout = () => {\n    logout();\n    router.push('/login');\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <nav className=\"bg-white shadow-sm border-b border-gray-200\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between h-16\">\n            <div className=\"flex items-center space-x-8\">\n              <Link href=\"/\" className=\"text-xl font-bold text-blue-600\">\n                BidChemz Logistics\n              </Link>\n              \n              {user && user.role === 'TRADER' && (\n                <div className=\"hidden md:flex items-center space-x-6\">\n                  <Link \n                    href=\"/trader/dashboard\" \n                    className={`text-sm ${router.pathname === '/trader/dashboard' ? 'text-blue-600 font-semibold' : 'text-gray-700 hover:text-gray-900'}`}\n                  >\n                    Dashboard\n                  </Link>\n                  <Link \n                    href=\"/quotes\" \n                    className={`text-sm ${router.pathname.includes('/quotes') ? 'text-blue-600 font-semibold' : 'text-gray-700 hover:text-gray-900'}`}\n                  >\n                    My Requests\n                  </Link>\n                  <Link \n                    href=\"/quotes/new\" \n                    className=\"text-sm bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700\"\n                  >\n                    + New Request\n                  </Link>\n                </div>\n              )}\n              \n              {user && user.role === 'LOGISTICS_PARTNER' && (\n                <div className=\"hidden md:flex items-center space-x-6\">\n                  <Link \n                    href=\"/partner/dashboard\" \n                    className={`text-sm ${router.pathname === '/partner/dashboard' ? 'text-blue-600 font-semibold' : 'text-gray-700 hover:text-gray-900'}`}\n                  >\n                    Dashboard\n                  </Link>\n                  <Link \n                    href=\"/partner/leads\" \n                    className={`text-sm ${router.pathname === '/partner/leads' ? 'text-blue-600 font-semibold' : 'text-gray-700 hover:text-gray-900'}`}\n                  >\n                    Active Leads\n                  </Link>\n                  <Link \n                    href=\"/partner/wallet\" \n                    className={`text-sm ${router.pathname === '/partner/wallet' ? 'text-blue-600 font-semibold' : 'text-gray-700 hover:text-gray-900'}`}\n                  >\n                    Wallet\n                  </Link>\n                  <Link \n                    href=\"/partner/capabilities\" \n                    className={`text-sm ${router.pathname === '/partner/capabilities' ? 'text-blue-600 font-semibold' : 'text-gray-700 hover:text-gray-900'}`}\n                  >\n                    Capabilities\n                  </Link>\n                </div>\n              )}\n            </div>\n            \n            <div className=\"flex items-center space-x-4\">\n              {user ? (\n                <>\n                  <span className=\"text-sm text-gray-700\">\n                    {user.companyName || user.email}\n                  </span>\n                  <span className=\"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded\">\n                    {user.role === 'LOGISTICS_PARTNER' ? 'Partner' : user.role === 'TRADER' ? 'Trader' : 'Admin'}\n                  </span>\n                  <button\n                    onClick={handleLogout}\n                    className=\"text-sm text-gray-700 hover:text-gray-900\"\n                  >\n                    Logout\n                  </button>\n                </>\n              ) : (\n                <>\n                  <Link href=\"/login\" className=\"text-sm text-gray-700 hover:text-gray-900\">\n                    Login\n                  </Link>\n                  <Link href=\"/signup\" className=\"text-sm text-white bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded\">\n                    Sign Up\n                  </Link>\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n      </nav>\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {children}\n      </main>\n    </div>\n  );\n}\n","size_bytes":4578},"pages/api/auth/signup.ts":{"content":"import { NextApiRequest, NextApiResponse } from 'next';\nimport { UserRole } from '@prisma/client';\nimport prisma from '@/lib/prisma';\nimport { hashPassword, generateToken } from '@/lib/auth';\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  try {\n    const {\n      email,\n      password,\n      phone,\n      role,\n      companyName,\n      gstin,\n    } = req.body;\n\n    if (!email || !password || !role) {\n      return res.status(400).json({\n        error: 'Email, password, and role are required',\n      });\n    }\n\n    if (!Object.values(UserRole).includes(role)) {\n      return res.status(400).json({\n        error: 'Invalid role. Must be TRADER, LOGISTICS_PARTNER, or ADMIN',\n      });\n    }\n\n    const existingUser = await prisma.user.findUnique({\n      where: { email },\n    });\n\n    if (existingUser) {\n      return res.status(409).json({\n        error: 'User with this email already exists',\n      });\n    }\n\n    const hashedPassword = await hashPassword(password);\n\n    const user = await prisma.user.create({\n      data: {\n        email,\n        password: hashedPassword,\n        phone,\n        role,\n        companyName,\n        gstin,\n        isVerified: false,\n        isActive: true,\n      },\n      select: {\n        id: true,\n        email: true,\n        role: true,\n        companyName: true,\n        isVerified: true,\n        createdAt: true,\n      },\n    });\n\n    if (role === UserRole.LOGISTICS_PARTNER) {\n      await prisma.partnerCapability.create({\n        data: {\n          userId: user.id,\n          serviceTypes: [],\n          dgClasses: [],\n          productCategories: [],\n          serviceCities: [],\n          serviceStates: [],\n          serviceCountries: [],\n          fleetTypes: [],\n          packagingCapabilities: [],\n          certifications: [],\n          warehouseLocations: [],\n        },\n      });\n\n      await prisma.leadWallet.create({\n        data: {\n          userId: user.id,\n          balance: 0,\n        },\n      });\n    }\n\n    const token = generateToken({\n      userId: user.id,\n      email: user.email,\n      role: user.role,\n      companyName: user.companyName || undefined,\n    });\n\n    res.status(201).json({\n      user,\n      token,\n      message: 'User registered successfully',\n    });\n  } catch (error) {\n    console.error('Signup error:', error);\n    res.status(500).json({ error: 'Internal server error' });\n  }\n}\n","size_bytes":2515},"components/ui/Modal.tsx":{"content":"import React, { useEffect, useRef, useId } from 'react';\n\nexport interface ModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  title?: string;\n  children: React.ReactNode;\n  footer?: React.ReactNode;\n  size?: 'sm' | 'md' | 'lg' | 'xl' | 'full';\n}\n\nconst Modal: React.FC<ModalProps> = ({\n  isOpen,\n  onClose,\n  title,\n  children,\n  footer,\n  size = 'md',\n}) => {\n  const titleId = useId();\n  const modalRef = useRef<HTMLDivElement>(null);\n  const previousActiveElement = useRef<HTMLElement | null>(null);\n  \n  useEffect(() => {\n    if (isOpen) {\n      previousActiveElement.current = document.activeElement as HTMLElement;\n      document.body.style.overflow = 'hidden';\n      \n      setTimeout(() => {\n        const focusableElements = modalRef.current?.querySelectorAll<HTMLElement>(\n          'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n        );\n        if (focusableElements && focusableElements.length > 0) {\n          focusableElements[0].focus();\n        } else {\n          modalRef.current?.focus();\n        }\n      }, 0);\n    } else {\n      document.body.style.overflow = 'unset';\n      \n      if (previousActiveElement.current) {\n        previousActiveElement.current.focus();\n      }\n    }\n    \n    return () => {\n      document.body.style.overflow = 'unset';\n    };\n  }, [isOpen]);\n  \n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape' && isOpen) {\n        onClose();\n      }\n    };\n    \n    const handleTab = (e: KeyboardEvent) => {\n      if (!isOpen || e.key !== 'Tab' || !modalRef.current) return;\n      \n      const focusableElements = Array.from(\n        modalRef.current.querySelectorAll<HTMLElement>(\n          'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n        )\n      );\n      \n      if (focusableElements.length === 0) return;\n      \n      const firstElement = focusableElements[0];\n      const lastElement = focusableElements[focusableElements.length - 1];\n      \n      if (e.shiftKey) {\n        if (document.activeElement === firstElement) {\n          e.preventDefault();\n          lastElement.focus();\n        }\n      } else {\n        if (document.activeElement === lastElement) {\n          e.preventDefault();\n          firstElement.focus();\n        }\n      }\n    };\n    \n    document.addEventListener('keydown', handleEscape);\n    document.addEventListener('keydown', handleTab);\n    return () => {\n      document.removeEventListener('keydown', handleEscape);\n      document.removeEventListener('keydown', handleTab);\n    };\n  }, [isOpen, onClose]);\n  \n  if (!isOpen) return null;\n  \n  const sizeStyles = {\n    sm: 'max-w-md',\n    md: 'max-w-lg',\n    lg: 'max-w-2xl',\n    xl: 'max-w-4xl',\n    full: 'max-w-7xl',\n  };\n  \n  return (\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n      <div className=\"flex min-h-screen items-center justify-center p-4\">\n        <div\n          className=\"fixed inset-0 bg-black bg-opacity-50 transition-opacity\"\n          onClick={onClose}\n          aria-hidden=\"true\"\n        />\n        \n        <div \n          ref={modalRef}\n          role=\"dialog\"\n          aria-modal=\"true\"\n          aria-labelledby={title ? titleId : undefined}\n          tabIndex={-1}\n          className={`relative bg-white rounded-lg shadow-xl w-full ${sizeStyles[size]} animate-slide-in`}\n        >\n          {title && (\n            <div className=\"border-b border-secondary-200 px-6 py-4 flex items-center justify-between\">\n              <h3 id={titleId} className=\"text-lg font-semibold text-secondary-900\">\n                {title}\n              </h3>\n              <button\n                onClick={onClose}\n                aria-label=\"Close modal\"\n                className=\"text-secondary-400 hover:text-secondary-600 transition-colors\"\n              >\n                <svg className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                </svg>\n              </button>\n            </div>\n          )}\n          \n          <div className=\"px-6 py-4 max-h-[calc(100vh-200px)] overflow-y-auto\">\n            {children}\n          </div>\n          \n          {footer && (\n            <div className=\"border-t border-secondary-200 px-6 py-4 flex items-center justify-end gap-3\">\n              {footer}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Modal;\n","size_bytes":4502},"pages/partner/dashboard.tsx":{"content":"import React, { useEffect, useState } from 'react';\nimport { Layout } from '@/components/layout/Layout';\nimport { useAuth } from '@/contexts/AuthContext';\nimport Card from '@/components/ui/Card';\nimport Button from '@/components/ui/Button';\nimport Link from 'next/link';\nimport { useRouter } from 'next/router';\n\nexport default function PartnerDashboard() {\n  const { user, token } = useAuth();\n  const router = useRouter();\n  const [stats, setStats] = useState({\n    activeOffers: 0,\n    totalLeads: 0,\n    walletBalance: 0,\n  });\n  const [quotes, setQuotes] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (!user || user.role !== 'LOGISTICS_PARTNER') {\n      router.push('/');\n      return;\n    }\n\n    fetchDashboardData();\n  }, [user, token]);\n\n  const fetchDashboardData = async () => {\n    try {\n      const [offersRes, walletRes] = await Promise.all([\n        fetch('/api/offers', {\n          headers: { 'Authorization': `Bearer ${token}` },\n        }),\n        fetch('/api/wallet', {\n          headers: { 'Authorization': `Bearer ${token}` },\n        }),\n      ]);\n\n      const offersData = await offersRes.json();\n      const walletData = await walletRes.json();\n\n      setStats({\n        activeOffers: offersData.offers?.filter((o: any) => o.status === 'PENDING').length || 0,\n        totalLeads: offersData.offers?.length || 0,\n        walletBalance: walletData.wallet?.balance || 0,\n      });\n    } catch (error) {\n      console.error('Error fetching dashboard data:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">Loading...</div>\n      </Layout>\n    );\n  }\n\n  return (\n    <Layout>\n      <div>\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-8\">Partner Dashboard</h1>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n          <Card>\n            <h3 className=\"text-sm font-medium text-gray-500 mb-2\">Active Offers</h3>\n            <p className=\"text-3xl font-bold text-blue-600\">{stats.activeOffers}</p>\n          </Card>\n\n          <Card>\n            <h3 className=\"text-sm font-medium text-gray-500 mb-2\">Total Leads</h3>\n            <p className=\"text-3xl font-bold text-blue-600\">{stats.totalLeads}</p>\n          </Card>\n\n          <Card>\n            <h3 className=\"text-sm font-medium text-gray-500 mb-2\">Wallet Balance</h3>\n            <p className=\"text-3xl font-bold text-green-600\">{stats.walletBalance.toFixed(2)}</p>\n            <Link href=\"/partner/wallet\">\n              <Button variant=\"secondary\" className=\"mt-4 w-full\">\n                Recharge Wallet\n              </Button>\n            </Link>\n          </Card>\n        </div>\n\n        <Card>\n          <div className=\"flex justify-between items-center mb-6\">\n            <h2 className=\"text-xl font-semibold\">Available Freight Requests</h2>\n            <Link href=\"/partner/capabilities\">\n              <Button variant=\"secondary\">Manage Capabilities</Button>\n            </Link>\n          </div>\n\n          <div className=\"space-y-4\">\n            <p className=\"text-gray-600 text-center py-8\">\n              Freight requests matching your capabilities will appear here\n            </p>\n          </div>\n        </Card>\n      </div>\n    </Layout>\n  );\n}\n","size_bytes":3320},"pages/quotes/index.tsx":{"content":"import React, { useEffect, useState } from 'react';\nimport { Layout } from '@/components/layout/Layout';\nimport { useAuth } from '@/contexts/AuthContext';\nimport Card from '@/components/ui/Card';\nimport Button from '@/components/ui/Button';\nimport Badge from '@/components/ui/Badge';\nimport Link from 'next/link';\nimport { useRouter } from 'next/router';\n\nexport default function QuotesList() {\n  const { user, token } = useAuth();\n  const router = useRouter();\n  const [quotes, setQuotes] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (!user) {\n      router.push('/login');\n      return;\n    }\n\n    fetchQuotes();\n  }, [user, token]);\n\n  const fetchQuotes = async () => {\n    try {\n      const response = await fetch('/api/quotes', {\n        headers: { 'Authorization': `Bearer ${token}` },\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        setQuotes(data.quotes || []);\n      }\n    } catch (error) {\n      console.error('Error fetching quotes:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    const colors: Record<string, 'primary' | 'success' | 'warning' | 'danger' | 'neutral'> = {\n      DRAFT: 'neutral',\n      SUBMITTED: 'primary',\n      MATCHING: 'warning',\n      OFFERS_AVAILABLE: 'success',\n      SELECTED: 'success',\n      CANCELLED: 'danger',\n      EXPIRED: 'danger',\n    };\n    return colors[status] || 'neutral';\n  };\n\n  if (loading) {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">Loading...</div>\n      </Layout>\n    );\n  }\n\n  return (\n    <Layout>\n      <div>\n        <div className=\"flex justify-between items-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900\">My Freight Requests</h1>\n          <Link href=\"/quotes/new\">\n            <Button variant=\"primary\">Create New Request</Button>\n          </Link>\n        </div>\n\n        {quotes.length === 0 ? (\n          <Card>\n            <div className=\"text-center py-12\">\n              <p className=\"text-gray-600 mb-4\">You haven't created any freight requests yet</p>\n              <Link href=\"/quotes/new\">\n                <Button variant=\"primary\">Create Your First Request</Button>\n              </Link>\n            </div>\n          </Card>\n        ) : (\n          <div className=\"space-y-4\">\n            {quotes.map((quote: any) => (\n              <Card key={quote.id} className=\"hover:shadow-lg transition-shadow\">\n                <div className=\"flex justify-between items-start\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-3 mb-2\">\n                      <h3 className=\"text-lg font-semibold text-gray-900\">\n                        {quote.quoteNumber}\n                      </h3>\n                      <Badge variant={getStatusColor(quote.status)}>\n                        {quote.status.replace('_', ' ')}\n                      </Badge>\n                      {quote.offers && quote.offers.length > 0 && (\n                        <span className=\"text-sm text-gray-600\">\n                          {quote.offers.length} offer{quote.offers.length !== 1 ? 's' : ''}\n                        </span>\n                      )}\n                    </div>\n\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600 mb-3\">\n                      <div>\n                        <span className=\"font-medium\">Cargo:</span> {quote.cargoName}\n                      </div>\n                      <div>\n                        <span className=\"font-medium\">Quantity:</span> {quote.quantity} {quote.quantityUnit}\n                      </div>\n                      <div>\n                        <span className=\"font-medium\">From:</span> {quote.pickupCity}, {quote.pickupState}\n                      </div>\n                      <div>\n                        <span className=\"font-medium\">To:</span> {quote.deliveryCity}, {quote.deliveryState}\n                      </div>\n                    </div>\n\n                    <div className=\"text-xs text-gray-500\">\n                      Ready: {new Date(quote.cargoReadyDate).toLocaleDateString()}\n                    </div>\n                  </div>\n\n                  <Link href={`/quotes/${quote.id}`}>\n                    <Button variant=\"secondary\" size=\"sm\">\n                      View Details\n                    </Button>\n                  </Link>\n                </div>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n    </Layout>\n  );\n}\n","size_bytes":4566},"replit.md":{"content":"# Bidchemz Logistics Bidding & Lead Marketplace\n\n## Project Overview\nA B2B reverse-bidding platform for chemical logistics that connects traders with logistics partners through a competitive quotation system.\n\n## Business Model\n- Traders submit freight requirements\n- System matches eligible logistics partners based on capabilities\n- Partners submit competitive quotations\n- Trader selects best offer\n- Selected partner is charged a lead fee\n- Revenue generated through lead monetization\n\n## User Roles\n1. **Trader** (Buyer/Seller): Requests logistics support and selects offers\n2. **Logistics Partner**: Receives freight leads and submits quotations\n3. **Admin**: Manages pricing, capabilities, credits, and system configuration\n4. **Marketplace System**: Communicates via APIs and webhooks only\n\n## Design System\n- **Aesthetic**: Clean, industrial, data-centric\n- **Color Palette**: Blue-driven primary colors (trust & reliability), neutral greys for hierarchy\n- **Typography**: Modern, sans-serif, optimized for dense operational data\n- **Layout**: Mobile-first responsive, collapsible sections, minimal cognitive load\n- **Components**: Consistent spacing, strict alignment, predictable interaction states\n- **Feedback**: Contextual inline errors, subtle non-intrusive success messages\n- **Overall**: Precision, speed, and professionalism for B2B chemical logistics\n\n## Technical Stack\n- **Frontend**: Next.js 15 + React 19 + TypeScript\n- **Styling**: Tailwind CSS\n- **Database**: PostgreSQL (to be configured)\n- **Authentication**: To be implemented\n- **API**: RESTful with webhook support\n\n## Core Features\n1. 9-Section Freight Request Form\n2. Partner Matching Engine\n3. Quote Submission System\n4. Offer Comparison Interface\n5. Lead Monetization & Wallet System\n6. Partner Capabilities Management\n7. Admin Panel\n8. API & Webhook Integration\n9. Document Management (MSDS/SDS)\n10. Shipment Tracking\n\n## Recent Changes\n- 2025-11-20: Complete logistics bidding platform implementation\n  - PostgreSQL database setup with Prisma ORM (7.0)\n  - Complete authentication system with JWT, RBAC, SSR-safe client context\n  - Comprehensive UI component library\n  - 9-section freight request form with validation\n  - Partner matching engine with capability-based filtering\n  - Partner portal with dashboard and capabilities management\n  - Trader quote listing and offer comparison interface\n  - Lead wallet system with atomic transactions\n  - Shipment tracking system with role-based access\n  - Admin panel dashboard\n  - RESTful API endpoints with authentication middleware\n  - Webhook system with HMAC signatures\n  - Pricing engine and audit logging\n  - **NEW**: Multi-channel notification system (Email, SMS, WhatsApp, Portal)\n  - **NEW**: Secure document encryption/decryption for MSDS/SDS files\n  - **NEW**: Quote submission countdown timer (30-60 minutes configurable)\n  - **NEW**: Partner lead alert system with multi-channel notifications\n  - **NEW**: Low balance wallet alert system\n  - **NEW**: Automated timer warnings and quote expiry management\n\n## Core Features Implemented\n User registration and authentication (Traders, Partners, Admin)\n 9-section freight request form with all 7 mandatory fields\n Automatic partner matching based on capabilities\n Partner quote submission system\n Offer comparison and selection interface\n Lead wallet and credit management\n Shipment tracking\n Admin panel for system management\n Comprehensive audit logging\n Webhook notifications\n Multi-channel alert system (Email, SMS, WhatsApp, Portal)\n Secure encrypted document storage for safety files\n Countdown timer for quote submissions (60 min default)\n Automated partner lead notifications\n Low balance wallet alerts\n\n## API Endpoints\n**Authentication**\n- POST /api/auth/signup - User registration\n- POST /api/auth/login - User login\n- GET /api/auth/me - Get current user\n\n**Quotes (Freight Requests)**\n- GET /api/quotes - List freight requests\n- POST /api/quotes - Create freight request (triggers matching & timer)\n- GET /api/quotes/[id] - Get quote details with offers\n- GET /api/quotes/[id]/timer - Get remaining time for quote submission\n- POST /api/quotes/[id]/timer - Extend quote timer (admin only)\n\n**Offers**\n- GET /api/offers - List partner offers\n- POST /api/offers - Submit offer (partners)\n- POST /api/offers/[id]/select - Select winning offer\n\n**Wallet**\n- GET /api/wallet - Get wallet balance\n- POST /api/wallet - Recharge wallet\n- GET /api/wallet/settings - Get wallet alert settings\n- PUT /api/wallet/settings - Update wallet alert settings\n\n**Partner Management**\n- GET /api/partner/capabilities - Get partner capabilities\n- PUT /api/partner/capabilities - Update capabilities\n\n**Documents (Encrypted)**\n- POST /api/documents/upload - Upload encrypted MSDS/SDS document\n- GET /api/documents/[id]/download - Download and decrypt document\n\n**Shipment Tracking**\n- GET /api/shipments/[id]/track - Track shipment\n- POST /api/shipments/[id]/track - Update shipment status\n\n## Deployment Notes\n- Database: PostgreSQL (Neon) - configured via DATABASE_URL\n- Port: 5000 (configured for Replit)\n- Environment: Production-ready except for JWT_SECRET (should be set via environment variable)\n\n## 7 Mandatory Fields Verification \nAll required fields are implemented in the Quote model:\n1.  Pickup Location (exact): pickupAddress, pickupCity, pickupState, pickupPincode, pickupCountry\n2.  Delivery Location (exact): deliveryAddress, deliveryCity, deliveryState, deliveryPincode, deliveryCountry\n3.  Cargo Name (CAS number): cargoName + casNumber\n4.  Quantity (MT/Kg/Litres): quantity + quantityUnit\n5.  Packing: packagingType (BAGS, DRUMS, TANKER, ISO_TANK, FLEXITANK, IBC, PALLETS, BULK)\n6.  Hazardous Material (Yes/No): isHazardous + hazardClass\n7.  Cargo Ready Date: cargoReadyDate\n\n## Notification System Features\n- Multi-channel delivery: Email, SMS, WhatsApp, Portal\n- Partner lead alerts with quote details\n- Low balance wallet warnings\n- Quote deadline reminders (10 minutes before expiry)\n- Configurable priority levels (LOW, MEDIUM, HIGH, URGENT)\n- Comprehensive audit logging for all notifications\n\n## Document Security Features\n- AES-256-GCM encryption for all uploaded documents\n- Secure key generation and storage per document\n- Role-based access control for document downloads\n- Encrypted files stored separately from metadata\n- Audit trail for all uploads and downloads\n- Support for MSDS/SDS and other safety documents\n\n## Timer System Features\n- Configurable countdown timer (default: 60 minutes)\n- Automatic quote expiry when time runs out\n- Warning notifications at 10 minutes remaining\n- Admin-only timer extension capability\n- Real-time remaining time API endpoint\n- Automatic status updates for expired offers\n\n## UI/UX Features (Complete)\n **Partner Portal**:\n- Partner leads page with real-time countdown timers\n- Submit offer form with wallet balance validation\n- Wallet management with recharge functionality and alert settings\n- Capabilities management page\n- Dashboard with statistics and active leads\n\n **Trader Portal**:\n- Trader dashboard with quote statistics and recent requests\n- Comprehensive freight request form (9 sections)\n- Quote detail page with tabbed interface (Details, Offers, Documents)\n- Offer comparison page with sorting and filtering\n- Document upload interface with encryption indicators\n\n **Shared Components**:\n- Real-time countdown timer with color-coded warnings\n- Multi-channel notification center\n- Encrypted document upload/download interface\n- Responsive navigation with role-based menus\n- Consistent design system (blue-driven, industrial aesthetic)\n\n **Key UX Improvements**:\n- Mobile-first responsive design\n- Loading states and animations\n- Empty states with helpful guidance\n- Inline validation and error messages\n- Visual indicators for hazardous materials\n- Real-time balance warnings\n- Tab-based navigation for complex pages\n\n## Next Steps\n- Connect real email/SMS/WhatsApp service providers (Twilio, SendGrid)\n- Add admin panel for timer and pricing configuration\n- Implement bulk wallet recharge packages with payment gateway\n- Add user management and analytics dashboards\n- Production deployment and scaling configuration\n","size_bytes":8263},"components/ui/Alert.tsx":{"content":"import React from 'react';\n\nexport interface AlertProps {\n  type?: 'info' | 'success' | 'warning' | 'danger';\n  title?: string;\n  children: React.ReactNode;\n  onClose?: () => void;\n  className?: string;\n}\n\nconst Alert: React.FC<AlertProps> = ({\n  type = 'info',\n  title,\n  children,\n  onClose,\n  className = '',\n}) => {\n  const typeStyles = {\n    info: {\n      container: 'bg-primary-50 border-primary-200',\n      icon: 'text-primary-600',\n      title: 'text-primary-900',\n      text: 'text-primary-800',\n    },\n    success: {\n      container: 'bg-success-50 border-success-200',\n      icon: 'text-success-600',\n      title: 'text-success-900',\n      text: 'text-success-800',\n    },\n    warning: {\n      container: 'bg-warning-50 border-warning-200',\n      icon: 'text-warning-600',\n      title: 'text-warning-900',\n      text: 'text-warning-800',\n    },\n    danger: {\n      container: 'bg-danger-50 border-danger-200',\n      icon: 'text-danger-600',\n      title: 'text-danger-900',\n      text: 'text-danger-800',\n    },\n  };\n  \n  const icons = {\n    info: (\n      <svg className=\"h-5 w-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n        <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\n      </svg>\n    ),\n    success: (\n      <svg className=\"h-5 w-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n        <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n      </svg>\n    ),\n    warning: (\n      <svg className=\"h-5 w-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n        <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n      </svg>\n    ),\n    danger: (\n      <svg className=\"h-5 w-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n        <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\n      </svg>\n    ),\n  };\n  \n  return (\n    <div className={`border rounded-md p-4 ${typeStyles[type].container} ${className}`}>\n      <div className=\"flex\">\n        <div className={`flex-shrink-0 ${typeStyles[type].icon}`}>\n          {icons[type]}\n        </div>\n        <div className=\"ml-3 flex-1\">\n          {title && (\n            <h3 className={`text-sm font-medium ${typeStyles[type].title}`}>\n              {title}\n            </h3>\n          )}\n          <div className={`text-sm ${title ? 'mt-2' : ''} ${typeStyles[type].text}`}>\n            {children}\n          </div>\n        </div>\n        {onClose && (\n          <div className=\"ml-auto pl-3\">\n            <button\n              onClick={onClose}\n              className={`inline-flex rounded-md p-1.5 hover:bg-black hover:bg-opacity-10 focus:outline-none ${typeStyles[type].icon}`}\n            >\n              <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path fillRule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\n              </svg>\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Alert;\n","size_bytes":3704},"pages/partner/capabilities.tsx":{"content":"import React, { useEffect, useState } from 'react';\nimport { Layout } from '@/components/layout/Layout';\nimport { useAuth } from '@/contexts/AuthContext';\nimport Card from '@/components/ui/Card';\nimport Button from '@/components/ui/Button';\nimport { FormField } from '@/components/forms/FormField';\nimport { CheckboxGroup } from '@/components/forms/CheckboxGroup';\nimport { useRouter } from 'next/router';\nimport { HazardClass, VehicleType, PackagingType, SubscriptionTier } from '@prisma/client';\n\nexport default function PartnerCapabilities() {\n  const { user, token } = useAuth();\n  const router = useRouter();\n  const [saving, setSaving] = useState(false);\n  const [capabilities, setCapabilities] = useState({\n    dgClasses: [] as string[],\n    serviceStates: [] as string[],\n    fleetTypes: [] as string[],\n    packagingCapabilities: [] as string[],\n    temperatureControlled: false,\n    subscriptionTier: 'FREE' as SubscriptionTier,\n  });\n\n  useEffect(() => {\n    if (!user || user.role !== 'LOGISTICS_PARTNER') {\n      router.push('/');\n      return;\n    }\n\n    fetchCapabilities();\n  }, [user, token]);\n\n  const fetchCapabilities = async () => {\n    try {\n      const response = await fetch('/api/partner/capabilities', {\n        headers: { 'Authorization': `Bearer ${token}` },\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        if (data.capabilities) {\n          setCapabilities(data.capabilities);\n        }\n      }\n    } catch (error) {\n      console.error('Error fetching capabilities:', error);\n    }\n  };\n\n  const handleCheckboxChange = (field: string, values: string[]) => {\n    setCapabilities(prev => ({ ...prev, [field]: values }));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setSaving(true);\n\n    try {\n      const response = await fetch('/api/partner/capabilities', {\n        method: 'PUT',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(capabilities),\n      });\n\n      if (response.ok) {\n        alert('Capabilities updated successfully!');\n      } else {\n        alert('Failed to update capabilities');\n      }\n    } catch (error) {\n      console.error('Error saving capabilities:', error);\n      alert('Failed to update capabilities');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const indianStates = [\n    'Andhra Pradesh', 'Arunachal Pradesh', 'Assam', 'Bihar', 'Chhattisgarh',\n    'Goa', 'Gujarat', 'Haryana', 'Himachal Pradesh', 'Jharkhand',\n    'Karnataka', 'Kerala', 'Madhya Pradesh', 'Maharashtra', 'Manipur',\n    'Meghalaya', 'Mizoram', 'Nagaland', 'Odisha', 'Punjab',\n    'Rajasthan', 'Sikkim', 'Tamil Nadu', 'Telangana', 'Tripura',\n    'Uttar Pradesh', 'Uttarakhand', 'West Bengal',\n  ];\n\n  return (\n    <Layout>\n      <div className=\"max-w-4xl mx-auto\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-8\">Partner Capabilities</h1>\n\n        <form onSubmit={handleSubmit}>\n          <Card className=\"mb-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">Service Capabilities</h2>\n\n            <CheckboxGroup\n              label=\"Hazard Classes Handled\"\n              name=\"dgClasses\"\n              value={capabilities.dgClasses}\n              onChange={(values) => handleCheckboxChange('dgClasses', values)}\n              options={Object.values(HazardClass).map(hc => ({\n                label: hc.replace('_', ' '),\n                value: hc,\n              }))}\n            />\n\n            <CheckboxGroup\n              label=\"States Served\"\n              name=\"serviceStates\"\n              value={capabilities.serviceStates}\n              onChange={(values) => handleCheckboxChange('serviceStates', values)}\n              options={indianStates.map(state => ({\n                label: state,\n                value: state,\n              }))}\n              required\n            />\n\n            <CheckboxGroup\n              label=\"Fleet Types Available\"\n              name=\"fleetTypes\"\n              value={capabilities.fleetTypes}\n              onChange={(values) => handleCheckboxChange('fleetTypes', values)}\n              options={Object.values(VehicleType).map(vt => ({\n                label: vt.replace('_', ' '),\n                value: vt,\n              }))}\n              required\n            />\n\n            <CheckboxGroup\n              label=\"Packaging Types Handled\"\n              name=\"packagingCapabilities\"\n              value={capabilities.packagingCapabilities}\n              onChange={(values) => handleCheckboxChange('packagingCapabilities', values)}\n              options={Object.values(PackagingType).map(pt => ({\n                label: pt.replace('_', ' '),\n                value: pt,\n              }))}\n              required\n            />\n\n            <div className=\"flex items-center mt-4\">\n              <input\n                type=\"checkbox\"\n                id=\"temperatureControlled\"\n                checked={capabilities.temperatureControlled}\n                onChange={(e) =>\n                  setCapabilities(prev => ({\n                    ...prev,\n                    temperatureControlled: e.target.checked,\n                  }))\n                }\n                className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n              />\n              <label htmlFor=\"temperatureControlled\" className=\"ml-2 text-sm text-gray-700\">\n                Temperature Controlled Transportation Available\n              </label>\n            </div>\n          </Card>\n\n          <div className=\"flex justify-end\">\n            <Button type=\"submit\" variant=\"primary\" disabled={saving}>\n              {saving ? 'Saving...' : 'Save Capabilities'}\n            </Button>\n          </div>\n        </form>\n      </div>\n    </Layout>\n  );\n}\n","size_bytes":5819},"pages/signup.tsx":{"content":"import React, { useState } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useRouter } from 'next/router';\nimport Button from '@/components/ui/Button';\nimport Input from '@/components/ui/Input';\nimport Select from '@/components/ui/Select';\nimport Card from '@/components/ui/Card';\nimport Link from 'next/link';\nimport { UserRole } from '@prisma/client';\n\nexport default function Signup() {\n  const { signup } = useAuth();\n  const router = useRouter();\n  const [formData, setFormData] = useState({\n    email: '',\n    password: '',\n    confirmPassword: '',\n    phone: '',\n    role: '' as UserRole | '',\n    companyName: '',\n    gstin: '',\n  });\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value,\n    });\n    setError('');\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setError('');\n\n    if (formData.password !== formData.confirmPassword) {\n      setError('Passwords do not match');\n      setLoading(false);\n      return;\n    }\n\n    if (!formData.role) {\n      setError('Please select a role');\n      setLoading(false);\n      return;\n    }\n\n    try {\n      const { confirmPassword, ...signupData } = formData;\n      await signup(signupData as any);\n      router.push('/');\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Signup failed');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-md w-full\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-blue-600 mb-2\">BidChemz Logistics</h1>\n          <h2 className=\"text-xl text-gray-900\">Create your account</h2>\n        </div>\n\n        <Card>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            {error && (\n              <div className=\"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded\">\n                {error}\n              </div>\n            )}\n\n            <Select\n              label=\"I am a\"\n              name=\"role\"\n              value={formData.role}\n              onChange={handleChange}\n              options={[\n                { label: 'Select your role', value: '' },\n                { label: 'Chemical Trader', value: UserRole.TRADER },\n                { label: 'Logistics Partner', value: UserRole.LOGISTICS_PARTNER },\n              ]}\n              required\n            />\n\n            <Input\n              label=\"Email Address\"\n              type=\"email\"\n              name=\"email\"\n              value={formData.email}\n              onChange={handleChange}\n              required\n              placeholder=\"you@example.com\"\n            />\n\n            <Input\n              label=\"Company Name\"\n              type=\"text\"\n              name=\"companyName\"\n              value={formData.companyName}\n              onChange={handleChange}\n              placeholder=\"Your Company Ltd.\"\n            />\n\n            <Input\n              label=\"Phone Number\"\n              type=\"tel\"\n              name=\"phone\"\n              value={formData.phone}\n              onChange={handleChange}\n              placeholder=\"+91 XXXXX XXXXX\"\n            />\n\n            <Input\n              label=\"GSTIN (Optional)\"\n              type=\"text\"\n              name=\"gstin\"\n              value={formData.gstin}\n              onChange={handleChange}\n              placeholder=\"22AAAAA0000A1Z5\"\n            />\n\n            <Input\n              label=\"Password\"\n              type=\"password\"\n              name=\"password\"\n              value={formData.password}\n              onChange={handleChange}\n              required\n              placeholder=\"Create a strong password\"\n            />\n\n            <Input\n              label=\"Confirm Password\"\n              type=\"password\"\n              name=\"confirmPassword\"\n              value={formData.confirmPassword}\n              onChange={handleChange}\n              required\n              placeholder=\"Re-enter your password\"\n            />\n\n            <Button\n              type=\"submit\"\n              variant=\"primary\"\n              disabled={loading}\n              className=\"w-full\"\n            >\n              {loading ? 'Creating account...' : 'Sign Up'}\n            </Button>\n\n            <div className=\"text-center text-sm\">\n              <span className=\"text-gray-600\">Already have an account? </span>\n              <Link href=\"/login\" className=\"text-blue-600 hover:text-blue-700 font-medium\">\n                Sign in\n              </Link>\n            </div>\n          </form>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4871},"components/forms/FormField.tsx":{"content":"import React from 'react';\nimport Input from '../ui/Input';\nimport Textarea from '../ui/Textarea';\nimport Select from '../ui/Select';\n\ninterface FormFieldProps {\n  label: string;\n  name: string;\n  type?: 'text' | 'email' | 'password' | 'number' | 'date' | 'datetime-local' | 'textarea' | 'select';\n  value: any;\n  onChange: (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => void;\n  error?: string;\n  required?: boolean;\n  placeholder?: string;\n  options?: { label: string; value: string | number }[];\n  disabled?: boolean;\n  helperText?: string;\n  min?: string | number;\n  max?: string | number;\n  step?: string | number;\n}\n\nexport function FormField({\n  label,\n  name,\n  type = 'text',\n  value,\n  onChange,\n  error,\n  required = false,\n  placeholder,\n  options,\n  disabled = false,\n  helperText,\n  min,\n  max,\n  step,\n}: FormFieldProps) {\n  const renderInput = () => {\n    if (type === 'textarea') {\n      return (\n        <Textarea\n          id={name}\n          name={name}\n          value={value}\n          onChange={onChange}\n          placeholder={placeholder}\n          disabled={disabled}\n          className={error ? 'border-red-500' : ''}\n        />\n      );\n    }\n\n    if (type === 'select' && options) {\n      const selectOptions = [\n        { label: `Select ${label}`, value: '' },\n        ...options.map(opt => ({ label: opt.label, value: String(opt.value) }))\n      ];\n      return (\n        <Select\n          id={name}\n          name={name}\n          value={value}\n          onChange={onChange}\n          disabled={disabled}\n          options={selectOptions}\n          className={error ? 'border-red-500' : ''}\n        />\n      );\n    }\n\n    return (\n      <Input\n        id={name}\n        name={name}\n        type={type}\n        value={value}\n        onChange={onChange}\n        placeholder={placeholder}\n        disabled={disabled}\n        className={error ? 'border-red-500' : ''}\n        min={min}\n        max={max}\n        step={step}\n      />\n    );\n  };\n\n  return (\n    <div className=\"mb-4\">\n      <label htmlFor={name} className=\"block text-sm font-medium text-gray-700 mb-1\">\n        {label}\n        {required && <span className=\"text-red-500 ml-1\">*</span>}\n      </label>\n      {renderInput()}\n      {helperText && !error && (\n        <p className=\"mt-1 text-sm text-gray-500\">{helperText}</p>\n      )}\n      {error && (\n        <p className=\"mt-1 text-sm text-red-600\">{error}</p>\n      )}\n    </div>\n  );\n}\n","size_bytes":2472},"components/ui/index.ts":{"content":"export { default as Button } from './Button';\nexport type { ButtonProps } from './Button';\n\nexport { default as Input } from './Input';\nexport type { InputProps } from './Input';\n\nexport { default as Card } from './Card';\nexport type { CardProps } from './Card';\n\nexport { default as Badge } from './Badge';\nexport type { BadgeProps } from './Badge';\n\nexport { default as Table } from './Table';\nexport type { TableProps, Column } from './Table';\n\nexport { default as Select } from './Select';\nexport type { SelectProps, SelectOption } from './Select';\n\nexport { default as Textarea } from './Textarea';\nexport type { TextareaProps } from './Textarea';\n\nexport { default as Loading } from './Loading';\nexport type { LoadingProps } from './Loading';\n\nexport { default as Alert } from './Alert';\nexport type { AlertProps } from './Alert';\n\nexport { default as Modal } from './Modal';\nexport type { ModalProps } from './Modal';\n","size_bytes":925},"pages/api/offers/[id]/select.ts":{"content":"import { NextApiResponse } from 'next';\nimport prisma from '@/lib/prisma';\nimport { withAuth, AuthenticatedRequest } from '@/lib/middleware';\nimport { UserRole, OfferStatus, QuoteStatus, LeadType, TransactionType } from '@prisma/client';\n\nasync function handler(req: AuthenticatedRequest, res: NextApiResponse) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  const { id } = req.query;\n\n  if (typeof id !== 'string') {\n    return res.status(400).json({ error: 'Invalid offer ID' });\n  }\n\n  try {\n    if (req.user!.role !== UserRole.TRADER) {\n      return res.status(403).json({\n        error: 'Only traders can select offers',\n      });\n    }\n\n    const offer = await prisma.offer.findUnique({\n      where: { id },\n      include: {\n        quote: true,\n        partner: {\n          include: {\n            leadWallet: true,\n            partnerCapability: true,\n          },\n        },\n      },\n    });\n\n    if (!offer) {\n      return res.status(404).json({ error: 'Offer not found' });\n    }\n\n    if (offer.quote.traderId !== req.user!.userId) {\n      return res.status(403).json({ error: 'Access denied' });\n    }\n\n    if (offer.status !== OfferStatus.PENDING) {\n      return res.status(400).json({ error: 'Offer is not available for selection' });\n    }\n\n    const wallet = offer.partner.leadWallet;\n\n    if (!wallet) {\n      return res.status(400).json({\n        error: 'Partner does not have a lead wallet',\n      });\n    }\n\n    const leadCost = calculateLeadCost(offer);\n\n    if (wallet.balance < leadCost) {\n      return res.status(400).json({\n        error: 'Partner has insufficient lead wallet balance',\n      });\n    }\n\n    const result = await prisma.$transaction(async (tx) => {\n      const currentWallet = await tx.leadWallet.findUnique({\n        where: { id: wallet.id },\n      });\n\n      if (!currentWallet || currentWallet.balance < leadCost) {\n        throw new Error('Insufficient wallet balance');\n      }\n\n      await tx.offer.update({\n        where: { id: offer.id },\n        data: {\n          status: OfferStatus.ACCEPTED,\n          isSelected: true,\n          selectedAt: new Date(),\n        },\n      });\n\n      await tx.offer.updateMany({\n        where: {\n          quoteId: offer.quoteId,\n          id: { not: offer.id },\n          status: OfferStatus.PENDING,\n        },\n        data: {\n          status: OfferStatus.REJECTED,\n        },\n      });\n\n      await tx.quote.update({\n        where: { id: offer.quoteId },\n        data: {\n          status: QuoteStatus.SELECTED,\n        },\n      });\n\n      await tx.leadWallet.update({\n        where: { id: wallet.id },\n        data: {\n          balance: currentWallet.balance - leadCost,\n        },\n      });\n\n      const leadTransaction = await tx.leadTransaction.create({\n        data: {\n          walletId: wallet.id,\n          offerId: offer.id,\n          transactionType: TransactionType.DEBIT,\n          amount: leadCost,\n          description: `Lead charge for quote ${offer.quote.quoteNumber}`,\n          leadId: `LEAD-${Date.now()}`,\n          leadType: offer.partner.partnerCapability?.subscriptionTier === 'PREMIUM'\n            ? LeadType.EXCLUSIVE\n            : LeadType.SHARED,\n          leadCost,\n          creditsDeducted: leadCost,\n          hazardCategory: offer.quote.hazardClass,\n          quantity: offer.quote.quantity,\n        },\n      });\n\n      const shipmentNumber = `SHP-${Date.now()}-${Math.random().toString(36).substr(2, 9).toUpperCase()}`;\n\n      const shipment = await tx.shipment.create({\n        data: {\n          shipmentNumber,\n          quoteId: offer.quoteId,\n          offerId: offer.id,\n          statusUpdates: [],\n          trackingEvents: [],\n        },\n      });\n\n      return { offer, leadTransaction, shipment };\n    });\n\n    await prisma.auditLog.create({\n      data: {\n        userId: req.user!.userId,\n        quoteId: offer.quoteId,\n        action: 'SELECT_OFFER',\n        entity: 'OFFER',\n        entityId: offer.id,\n        changes: {\n          offerId: offer.id,\n          partnerId: offer.partnerId,\n          leadCost,\n        },\n      },\n    });\n\n    res.status(200).json({\n      message: 'Offer selected successfully',\n      shipment: result.shipment,\n    });\n  } catch (error) {\n    console.error('Error selecting offer:', error);\n    res.status(500).json({ error: 'Failed to select offer' });\n  }\n}\n\nfunction calculateLeadCost(offer: any): number {\n  let baseCost = 500;\n\n  if (offer.quote.isHazardous) {\n    baseCost *= 1.5;\n  }\n\n  if (offer.quote.quantity > 20) {\n    baseCost *= 1.3;\n  }\n\n  if (offer.partner.partnerCapability?.subscriptionTier === 'PREMIUM') {\n    baseCost *= 2;\n  }\n\n  return Math.round(baseCost);\n}\n\nexport default withAuth(handler);\n","size_bytes":4742},"components/ui/Button.tsx":{"content":"import React from 'react';\n\nexport interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: 'primary' | 'secondary' | 'danger' | 'ghost' | 'outline';\n  size?: 'sm' | 'md' | 'lg';\n  isLoading?: boolean;\n  fullWidth?: boolean;\n}\n\nconst Button: React.FC<ButtonProps> = ({\n  children,\n  variant = 'primary',\n  size = 'md',\n  isLoading = false,\n  fullWidth = false,\n  className = '',\n  disabled,\n  ...props\n}) => {\n  const baseStyles = 'inline-flex items-center justify-center font-medium rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed';\n  \n  const variantStyles = {\n    primary: 'bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500 active:bg-primary-800',\n    secondary: 'bg-secondary-100 text-secondary-900 hover:bg-secondary-200 focus:ring-secondary-500 active:bg-secondary-300',\n    danger: 'bg-danger-600 text-white hover:bg-danger-700 focus:ring-danger-500 active:bg-danger-800',\n    ghost: 'bg-transparent text-primary-600 hover:bg-primary-50 focus:ring-primary-500',\n    outline: 'bg-transparent border-2 border-primary-600 text-primary-600 hover:bg-primary-50 focus:ring-primary-500',\n  };\n  \n  const sizeStyles = {\n    sm: 'px-3 py-1.5 text-sm',\n    md: 'px-4 py-2 text-base',\n    lg: 'px-6 py-3 text-lg',\n  };\n  \n  const widthStyle = fullWidth ? 'w-full' : '';\n  \n  return (\n    <button\n      className={`${baseStyles} ${variantStyles[variant]} ${sizeStyles[size]} ${widthStyle} ${className}`}\n      disabled={disabled || isLoading}\n      {...props}\n    >\n      {isLoading && (\n        <svg className=\"animate-spin -ml-1 mr-2 h-4 w-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n          <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n          <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n        </svg>\n      )}\n      {children}\n    </button>\n  );\n};\n\nexport default Button;\n","size_bytes":2134},"components/forms/FormSection.tsx":{"content":"import React, { ReactNode } from 'react';\nimport Card from '../ui/Card';\n\ninterface FormSectionProps {\n  title: string;\n  description?: string;\n  children: ReactNode;\n  collapsible?: boolean;\n  defaultExpanded?: boolean;\n}\n\nexport function FormSection({\n  title,\n  description,\n  children,\n  collapsible = false,\n  defaultExpanded = true,\n}: FormSectionProps) {\n  const [isExpanded, setIsExpanded] = React.useState(defaultExpanded);\n\n  return (\n    <Card className=\"mb-6\">\n      <div\n        className={`border-b border-gray-200 pb-4 mb-4 ${collapsible ? 'cursor-pointer' : ''}`}\n        onClick={() => collapsible && setIsExpanded(!isExpanded)}\n      >\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h3 className=\"text-lg font-semibold text-gray-900\">{title}</h3>\n            {description && (\n              <p className=\"mt-1 text-sm text-gray-600\">{description}</p>\n            )}\n          </div>\n          {collapsible && (\n            <svg\n              className={`w-5 h-5 text-gray-500 transform transition-transform ${\n                isExpanded ? 'rotate-180' : ''\n              }`}\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n            </svg>\n          )}\n        </div>\n      </div>\n      {isExpanded && <div className=\"space-y-4\">{children}</div>}\n    </Card>\n  );\n}\n","size_bytes":1493},"components/ui/Card.tsx":{"content":"import React from 'react';\n\nexport interface CardProps {\n  children: React.ReactNode;\n  title?: string;\n  subtitle?: string;\n  headerAction?: React.ReactNode;\n  className?: string;\n  padding?: 'none' | 'sm' | 'md' | 'lg';\n  hoverable?: boolean;\n}\n\nconst Card: React.FC<CardProps> = ({\n  children,\n  title,\n  subtitle,\n  headerAction,\n  className = '',\n  padding = 'md',\n  hoverable = false,\n}) => {\n  const paddingStyles = {\n    none: '',\n    sm: 'p-4',\n    md: 'p-6',\n    lg: 'p-8',\n  };\n\n  const hoverStyles = hoverable \n    ? 'transition-shadow duration-200 hover:shadow-card-hover cursor-pointer' \n    : '';\n\n  return (\n    <div className={`bg-white rounded-lg border border-secondary-200 shadow-card ${hoverStyles} ${className}`}>\n      {(title || subtitle || headerAction) && (\n        <div className={`border-b border-secondary-200 ${paddingStyles[padding]}`}>\n          <div className=\"flex items-start justify-between\">\n            <div>\n              {title && <h3 className=\"text-lg font-semibold text-secondary-900\">{title}</h3>}\n              {subtitle && <p className=\"text-sm text-secondary-600 mt-1\">{subtitle}</p>}\n            </div>\n            {headerAction && <div>{headerAction}</div>}\n          </div>\n        </div>\n      )}\n      <div className={title || subtitle || headerAction ? paddingStyles[padding] : paddingStyles[padding]}>\n        {children}\n      </div>\n    </div>\n  );\n};\n\nexport default Card;\n","size_bytes":1429},"contexts/AuthContext.tsx":{"content":"import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { UserRole } from '@prisma/client';\n\ninterface User {\n  id: string;\n  email: string;\n  role: UserRole;\n  companyName?: string | null;\n  isVerified: boolean;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  token: string | null;\n  login: (email: string, password: string) => Promise<void>;\n  signup: (data: SignupData) => Promise<void>;\n  logout: () => void;\n  isLoading: boolean;\n  error: string | null;\n}\n\ninterface SignupData {\n  email: string;\n  password: string;\n  phone?: string;\n  role: UserRole;\n  companyName?: string;\n  gstin?: string;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [token, setToken] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') {\n      setIsLoading(false);\n      return;\n    }\n    \n    const storedToken = localStorage.getItem('token');\n    if (storedToken) {\n      setToken(storedToken);\n      fetchUser(storedToken);\n    } else {\n      setIsLoading(false);\n    }\n  }, []);\n\n  const fetchUser = async (authToken: string) => {\n    try {\n      const response = await fetch('/api/auth/me', {\n        headers: {\n          'Authorization': `Bearer ${authToken}`,\n        },\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        setUser(data.user);\n      } else {\n        if (typeof window !== 'undefined') {\n          localStorage.removeItem('token');\n        }\n        setToken(null);\n      }\n    } catch (err) {\n      console.error('Failed to fetch user:', err);\n      if (typeof window !== 'undefined') {\n        localStorage.removeItem('token');\n      }\n      setToken(null);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const login = async (email: string, password: string) => {\n    setError(null);\n    try {\n      const response = await fetch('/api/auth/login', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email, password }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Login failed');\n      }\n\n      setUser(data.user);\n      setToken(data.token);\n      if (typeof window !== 'undefined') {\n        localStorage.setItem('token', data.token);\n      }\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Login failed';\n      setError(errorMessage);\n      throw err;\n    }\n  };\n\n  const signup = async (signupData: SignupData) => {\n    setError(null);\n    try {\n      const response = await fetch('/api/auth/signup', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(signupData),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Signup failed');\n      }\n\n      setUser(data.user);\n      setToken(data.token);\n      if (typeof window !== 'undefined') {\n        localStorage.setItem('token', data.token);\n      }\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Signup failed';\n      setError(errorMessage);\n      throw err;\n    }\n  };\n\n  const logout = () => {\n    setUser(null);\n    setToken(null);\n    if (typeof window !== 'undefined') {\n      localStorage.removeItem('token');\n    }\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, token, login, signup, logout, isLoading, error }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n","size_bytes":3987},"components/ui/Loading.tsx":{"content":"import React from 'react';\n\nexport interface LoadingProps {\n  size?: 'sm' | 'md' | 'lg' | 'xl';\n  text?: string;\n  fullScreen?: boolean;\n}\n\nconst Loading: React.FC<LoadingProps> = ({ \n  size = 'md', \n  text,\n  fullScreen = false \n}) => {\n  const sizeStyles = {\n    sm: 'h-4 w-4',\n    md: 'h-8 w-8',\n    lg: 'h-12 w-12',\n    xl: 'h-16 w-16',\n  };\n  \n  const spinner = (\n    <div className=\"flex flex-col items-center justify-center gap-3\">\n      <svg \n        className={`animate-spin text-primary-600 ${sizeStyles[size]}`}\n        xmlns=\"http://www.w3.org/2000/svg\" \n        fill=\"none\" \n        viewBox=\"0 0 24 24\"\n      >\n        <circle \n          className=\"opacity-25\" \n          cx=\"12\" \n          cy=\"12\" \n          r=\"10\" \n          stroke=\"currentColor\" \n          strokeWidth=\"4\"\n        />\n        <path \n          className=\"opacity-75\" \n          fill=\"currentColor\" \n          d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n        />\n      </svg>\n      {text && <p className=\"text-secondary-600 text-sm font-medium\">{text}</p>}\n    </div>\n  );\n  \n  if (fullScreen) {\n    return (\n      <div className=\"fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50\">\n        {spinner}\n      </div>\n    );\n  }\n  \n  return spinner;\n};\n\nexport default Loading;\n","size_bytes":1354},"pages/design-system.tsx":{"content":"import React, { useState } from 'react';\nimport type { NextPage } from 'next';\nimport Head from 'next/head';\nimport {\n  Button,\n  Input,\n  Card,\n  Badge,\n  Table,\n  Select,\n  Textarea,\n  Loading,\n  Alert,\n  Modal,\n} from '../components/ui';\nimport type { Column } from '../components/ui';\n\nconst DesignSystemPage: NextPage = () => {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n\n  const sampleData = [\n    { id: 1, name: 'Chemical Transport A', status: 'Active', price: 5000, rating: 4.5 },\n    { id: 2, name: 'Chemical Transport B', status: 'Pending', price: 4500, rating: 4.2 },\n    { id: 3, name: 'Chemical Transport C', status: 'Completed', price: 6000, rating: 4.8 },\n  ];\n\n  const columns: Column<typeof sampleData[0]>[] = [\n    { key: 'id', header: 'ID', width: 'w-20' },\n    { key: 'name', header: 'Name' },\n    {\n      key: 'status',\n      header: 'Status',\n      render: (value) => {\n        const variants = {\n          Active: 'success',\n          Pending: 'warning',\n          Completed: 'primary',\n        } as const;\n        return <Badge variant={variants[value as keyof typeof variants]}>{value}</Badge>;\n      },\n    },\n    { key: 'price', header: 'Price', render: (value) => `${value.toLocaleString()}` },\n    { key: 'rating', header: 'Rating', render: (value) => `${value} ` },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-secondary-50\">\n      <Head>\n        <title>Design System - Bidchemz Logistics</title>\n      </Head>\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n        <div className=\"mb-12\">\n          <h1 className=\"text-4xl font-bold text-secondary-900 mb-2\">\n            Bidchemz Design System\n          </h1>\n          <p className=\"text-lg text-secondary-600\">\n            Clean, industrial, data-centric B2B components\n          </p>\n        </div>\n\n        <div className=\"space-y-12\">\n          <section>\n            <h2 className=\"text-2xl font-semibold text-secondary-900 mb-6\">Colors</h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n              <div>\n                <h3 className=\"text-sm font-medium text-secondary-700 mb-2\">Primary</h3>\n                <div className=\"space-y-1\">\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-primary-50 text-secondary-900\">50</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-primary-100 text-secondary-900\">100</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-primary-200 text-secondary-900\">200</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-primary-300 text-secondary-900\">300</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-primary-400 text-secondary-900\">400</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-primary-500 text-white\">500</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-primary-600 text-white\">600</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-primary-700 text-white\">700</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-primary-800 text-white\">800</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-primary-900 text-white\">900</div>\n                </div>\n              </div>\n              \n              <div>\n                <h3 className=\"text-sm font-medium text-secondary-700 mb-2\">Secondary</h3>\n                <div className=\"space-y-1\">\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-secondary-50 text-secondary-900\">50</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-secondary-100 text-secondary-900\">100</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-secondary-200 text-secondary-900\">200</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-secondary-300 text-secondary-900\">300</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-secondary-400 text-white\">400</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-secondary-500 text-white\">500</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-secondary-600 text-white\">600</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-secondary-700 text-white\">700</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-secondary-800 text-white\">800</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-secondary-900 text-white\">900</div>\n                </div>\n              </div>\n              \n              <div>\n                <h3 className=\"text-sm font-medium text-secondary-700 mb-2\">Success</h3>\n                <div className=\"space-y-1\">\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-success-50 text-secondary-900\">50</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-success-100 text-secondary-900\">100</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-success-200 text-secondary-900\">200</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-success-300 text-secondary-900\">300</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-success-400 text-secondary-900\">400</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-success-500 text-white\">500</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-success-600 text-white\">600</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-success-700 text-white\">700</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-success-800 text-white\">800</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-success-900 text-white\">900</div>\n                </div>\n              </div>\n              \n              <div>\n                <h3 className=\"text-sm font-medium text-secondary-700 mb-2\">Warning</h3>\n                <div className=\"space-y-1\">\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-warning-50 text-secondary-900\">50</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-warning-100 text-secondary-900\">100</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-warning-200 text-secondary-900\">200</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-warning-300 text-secondary-900\">300</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-warning-400 text-secondary-900\">400</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-warning-500 text-white\">500</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-warning-600 text-white\">600</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-warning-700 text-white\">700</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-warning-800 text-white\">800</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-warning-900 text-white\">900</div>\n                </div>\n              </div>\n              \n              <div>\n                <h3 className=\"text-sm font-medium text-secondary-700 mb-2\">Danger</h3>\n                <div className=\"space-y-1\">\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-danger-50 text-secondary-900\">50</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-danger-100 text-secondary-900\">100</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-danger-200 text-secondary-900\">200</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-danger-300 text-secondary-900\">300</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-danger-400 text-secondary-900\">400</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-danger-500 text-white\">500</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-danger-600 text-white\">600</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-danger-700 text-white\">700</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-danger-800 text-white\">800</div>\n                  <div className=\"h-10 rounded flex items-center justify-center text-xs font-medium bg-danger-900 text-white\">900</div>\n                </div>\n              </div>\n            </div>\n          </section>\n\n          <section>\n            <h2 className=\"text-2xl font-semibold text-secondary-900 mb-6\">Buttons</h2>\n            <Card>\n              <div className=\"space-y-4\">\n                <div className=\"flex flex-wrap gap-3\">\n                  <Button variant=\"primary\">Primary Button</Button>\n                  <Button variant=\"secondary\">Secondary Button</Button>\n                  <Button variant=\"danger\">Danger Button</Button>\n                  <Button variant=\"ghost\">Ghost Button</Button>\n                  <Button variant=\"outline\">Outline Button</Button>\n                </div>\n                <div className=\"flex flex-wrap gap-3\">\n                  <Button variant=\"primary\" size=\"sm\">Small</Button>\n                  <Button variant=\"primary\" size=\"md\">Medium</Button>\n                  <Button variant=\"primary\" size=\"lg\">Large</Button>\n                </div>\n                <div className=\"flex flex-wrap gap-3\">\n                  <Button variant=\"primary\" isLoading>Loading</Button>\n                  <Button variant=\"primary\" disabled>Disabled</Button>\n                </div>\n              </div>\n            </Card>\n          </section>\n\n          <section>\n            <h2 className=\"text-2xl font-semibold text-secondary-900 mb-6\">Form Inputs</h2>\n            <Card>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <Input label=\"Email Address\" type=\"email\" placeholder=\"Enter your email\" required />\n                <Input label=\"Phone Number\" type=\"tel\" placeholder=\"+91 98765 43210\" />\n                <Input label=\"With Error\" error=\"This field is required\" />\n                <Input label=\"With Hint\" hint=\"Enter your full legal name\" />\n                <Select\n                  label=\"Select Option\"\n                  options={[\n                    { value: '', label: 'Choose...' },\n                    { value: '1', label: 'Option 1' },\n                    { value: '2', label: 'Option 2' },\n                  ]}\n                />\n                <div className=\"md:col-span-2\">\n                  <Textarea label=\"Description\" placeholder=\"Enter detailed description\" />\n                </div>\n              </div>\n            </Card>\n          </section>\n\n          <section>\n            <h2 className=\"text-2xl font-semibold text-secondary-900 mb-6\">Badges</h2>\n            <Card>\n              <div className=\"flex flex-wrap gap-3\">\n                <Badge variant=\"primary\">Primary</Badge>\n                <Badge variant=\"success\">Success</Badge>\n                <Badge variant=\"warning\">Warning</Badge>\n                <Badge variant=\"danger\">Danger</Badge>\n                <Badge variant=\"neutral\">Neutral</Badge>\n              </div>\n              <div className=\"flex flex-wrap gap-3 mt-4\">\n                <Badge variant=\"success\" dot>With Dot</Badge>\n                <Badge variant=\"primary\" size=\"sm\">Small</Badge>\n                <Badge variant=\"primary\" size=\"md\">Medium</Badge>\n                <Badge variant=\"primary\" size=\"lg\">Large</Badge>\n              </div>\n            </Card>\n          </section>\n\n          <section>\n            <h2 className=\"text-2xl font-semibold text-secondary-900 mb-6\">Alerts</h2>\n            <div className=\"space-y-4\">\n              <Alert type=\"info\" title=\"Information\">\n                This is an informational message with helpful details.\n              </Alert>\n              <Alert type=\"success\" title=\"Success\">\n                Your operation completed successfully!\n              </Alert>\n              <Alert type=\"warning\" title=\"Warning\">\n                Please review this important warning message.\n              </Alert>\n              <Alert type=\"danger\" title=\"Error\">\n                An error occurred while processing your request.\n              </Alert>\n            </div>\n          </section>\n\n          <section>\n            <h2 className=\"text-2xl font-semibold text-secondary-900 mb-6\">Tables</h2>\n            <Card padding=\"none\">\n              <Table data={sampleData} columns={columns} hoverable striped />\n            </Card>\n          </section>\n\n          <section>\n            <h2 className=\"text-2xl font-semibold text-secondary-900 mb-6\">Cards</h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <Card title=\"Card Title\" subtitle=\"Card subtitle goes here\">\n                <p className=\"text-secondary-600\">\n                  This is a basic card with title and subtitle.\n                </p>\n              </Card>\n              <Card\n                title=\"With Action\"\n                headerAction={<Button variant=\"ghost\" size=\"sm\">Action</Button>}\n                hoverable\n              >\n                <p className=\"text-secondary-600\">\n                  This card has a header action button and is hoverable.\n                </p>\n              </Card>\n            </div>\n          </section>\n\n          <section>\n            <h2 className=\"text-2xl font-semibold text-secondary-900 mb-6\">Loading States</h2>\n            <Card>\n              <div className=\"flex items-center gap-8\">\n                <Loading size=\"sm\" />\n                <Loading size=\"md\" />\n                <Loading size=\"lg\" text=\"Loading...\" />\n              </div>\n            </Card>\n          </section>\n\n          <section>\n            <h2 className=\"text-2xl font-semibold text-secondary-900 mb-6\">Modal</h2>\n            <Card>\n              <Button onClick={() => setIsModalOpen(true)}>Open Modal</Button>\n              <Modal\n                isOpen={isModalOpen}\n                onClose={() => setIsModalOpen(false)}\n                title=\"Modal Title\"\n                footer={\n                  <>\n                    <Button variant=\"ghost\" onClick={() => setIsModalOpen(false)}>\n                      Cancel\n                    </Button>\n                    <Button variant=\"primary\" onClick={() => setIsModalOpen(false)}>\n                      Confirm\n                    </Button>\n                  </>\n                }\n              >\n                <p className=\"text-secondary-600\">\n                  This is a modal dialog with a title and footer actions.\n                </p>\n              </Modal>\n            </Card>\n          </section>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default DesignSystemPage;\n","size_bytes":16475},"pages/quotes/[id].tsx":{"content":"import React, { useEffect, useState } from 'react';\nimport { Layout } from '@/components/layout/Layout';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Card, CardHeader, CardBody, CardTitle } from '@/components/ui/Card';\nimport Button from '@/components/ui/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport { CountdownTimer } from '@/components/CountdownTimer';\nimport { DocumentUpload } from '@/components/DocumentUpload';\nimport { useRouter } from 'next/router';\n\nexport default function QuoteDetails() {\n  const { user, token } = useAuth();\n  const router = useRouter();\n  const { id } = router.query;\n  const [quote, setQuote] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [activeTab, setActiveTab] = useState<'details' | 'offers' | 'documents'>('details');\n\n  useEffect(() => {\n    if (!user || !id) return;\n    fetchQuote();\n  }, [user, token, id]);\n\n  const fetchQuote = async () => {\n    try {\n      const response = await fetch(`/api/quotes/${id}`, {\n        headers: { 'Authorization': `Bearer ${token}` },\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        setQuote(data.quote);\n      } else {\n        router.push('/quotes');\n      }\n    } catch (error) {\n      console.error('Error fetching quote:', error);\n      router.push('/quotes');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">\n          <div className=\"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n        </div>\n      </Layout>\n    );\n  }\n\n  if (!quote) {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">\n          <p className=\"text-gray-600\">Quote not found</p>\n        </div>\n      </Layout>\n    );\n  }\n\n  const isTrader = user?.role === 'TRADER';\n  const offersCount = quote.offers?.length || 0;\n\n  return (\n    <Layout>\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <div>\n            <Button variant=\"secondary\" onClick={() => router.back()}>\n               Back\n            </Button>\n          </div>\n          {quote.expiresAt && quote.status === 'MATCHING' && (\n            <CountdownTimer expiresAt={quote.expiresAt} showSeconds={true} />\n          )}\n        </div>\n\n        <Card className=\"mb-6\">\n          <CardBody>\n            <div className=\"flex items-start justify-between mb-4\">\n              <div>\n                <h1 className=\"text-3xl font-bold text-gray-900\">{quote.cargoName}</h1>\n                <p className=\"text-gray-600 mt-1\">{quote.quoteNumber}</p>\n              </div>\n              <Badge variant={\n                quote.status === 'SELECTED' ? 'success' :\n                quote.status === 'OFFERS_AVAILABLE' ? 'primary' :\n                quote.status === 'MATCHING' ? 'warning' :\n                'secondary'\n              }>\n                {quote.status.replace('_', ' ')}\n              </Badge>\n            </div>\n\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6\">\n              <div>\n                <p className=\"text-sm text-gray-500\">Quantity</p>\n                <p className=\"text-lg font-semibold text-gray-900\">\n                  {quote.quantity} {quote.quantityUnit}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-sm text-gray-500\">Packaging</p>\n                <p className=\"text-lg font-semibold text-gray-900\">{quote.packagingType}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-gray-500\">Ready Date</p>\n                <p className=\"text-lg font-semibold text-gray-900\">\n                  {new Date(quote.cargoReadyDate).toLocaleDateString()}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-sm text-gray-500\">Offers Received</p>\n                <p className=\"text-lg font-semibold text-green-600\">{offersCount}</p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center space-x-4 mt-6 pt-6 border-t\">\n              <div className=\"flex items-center text-gray-600\">\n                <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\n                </svg>\n                <span>{quote.pickupCity}, {quote.pickupState}</span>\n              </div>\n              <span className=\"text-gray-400\"></span>\n              <div className=\"flex items-center text-gray-600\">\n                <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\n                </svg>\n                <span>{quote.deliveryCity}, {quote.deliveryState}</span>\n              </div>\n              {quote.isHazardous && (\n                <Badge variant=\"danger\"> Hazardous: {quote.hazardClass}</Badge>\n              )}\n            </div>\n          </CardBody>\n        </Card>\n\n        <div className=\"border-b border-gray-200 mb-6\">\n          <nav className=\"-mb-px flex space-x-8\">\n            <button\n              onClick={() => setActiveTab('details')}\n              className={`${\n                activeTab === 'details'\n                  ? 'border-blue-500 text-blue-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              } whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`}\n            >\n              Details\n            </button>\n            <button\n              onClick={() => setActiveTab('offers')}\n              className={`${\n                activeTab === 'offers'\n                  ? 'border-blue-500 text-blue-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              } whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center space-x-2`}\n            >\n              <span>Offers</span>\n              {offersCount > 0 && (\n                <span className=\"bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full text-xs font-semibold\">\n                  {offersCount}\n                </span>\n              )}\n            </button>\n            <button\n              onClick={() => setActiveTab('documents')}\n              className={`${\n                activeTab === 'documents'\n                  ? 'border-blue-500 text-blue-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              } whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`}\n            >\n              Documents\n            </button>\n          </nav>\n        </div>\n\n        {activeTab === 'details' && (\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Shipment Information</CardTitle>\n              </CardHeader>\n              <CardBody>\n                <dl className=\"space-y-3\">\n                  <div>\n                    <dt className=\"text-sm font-medium text-gray-500\">Cargo Name</dt>\n                    <dd className=\"mt-1 text-sm text-gray-900\">{quote.cargoName}</dd>\n                  </div>\n                  {quote.casNumber && (\n                    <div>\n                      <dt className=\"text-sm font-medium text-gray-500\">CAS Number</dt>\n                      <dd className=\"mt-1 text-sm text-gray-900\">{quote.casNumber}</dd>\n                    </div>\n                  )}\n                  <div>\n                    <dt className=\"text-sm font-medium text-gray-500\">Quantity</dt>\n                    <dd className=\"mt-1 text-sm text-gray-900\">{quote.quantity} {quote.quantityUnit}</dd>\n                  </div>\n                  <div>\n                    <dt className=\"text-sm font-medium text-gray-500\">Packaging Type</dt>\n                    <dd className=\"mt-1 text-sm text-gray-900\">{quote.packagingType}</dd>\n                  </div>\n                  {quote.temperatureControlled && (\n                    <div>\n                      <dt className=\"text-sm font-medium text-gray-500\">Temperature Range</dt>\n                      <dd className=\"mt-1 text-sm text-gray-900\">\n                        {quote.temperatureMin}C to {quote.temperatureMax}C\n                      </dd>\n                    </div>\n                  )}\n                </dl>\n              </CardBody>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Locations</CardTitle>\n              </CardHeader>\n              <CardBody>\n                <div className=\"space-y-4\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-500 mb-2\">Pickup Location</p>\n                    <p className=\"text-sm text-gray-900\">{quote.pickupAddress}</p>\n                    <p className=\"text-sm text-gray-600\">\n                      {quote.pickupCity}, {quote.pickupState} {quote.pickupPincode}\n                    </p>\n                    {quote.pickupContactPhone && (\n                      <p className=\"text-sm text-gray-600 mt-1\">\n                        Contact: {quote.pickupContactName} - {quote.pickupContactPhone}\n                      </p>\n                    )}\n                  </div>\n                  <div className=\"border-t pt-4\">\n                    <p className=\"text-sm font-medium text-gray-500 mb-2\">Delivery Location</p>\n                    <p className=\"text-sm text-gray-900\">{quote.deliveryAddress}</p>\n                    <p className=\"text-sm text-gray-600\">\n                      {quote.deliveryCity}, {quote.deliveryState} {quote.deliveryPincode}\n                    </p>\n                    {quote.deliveryContactPhone && (\n                      <p className=\"text-sm text-gray-600 mt-1\">\n                        Contact: {quote.deliveryContactName} - {quote.deliveryContactPhone}\n                      </p>\n                    )}\n                  </div>\n                </div>\n              </CardBody>\n            </Card>\n          </div>\n        )}\n\n        {activeTab === 'offers' && (\n          <div>\n            {offersCount === 0 ? (\n              <Card>\n                <CardBody className=\"text-center py-12\">\n                  <svg className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                  </svg>\n                  <p className=\"text-gray-600 mb-2\">No offers received yet</p>\n                  <p className=\"text-sm text-gray-500\">Matched partners are reviewing your request</p>\n                </CardBody>\n              </Card>\n            ) : isTrader ? (\n              <Button\n                variant=\"primary\"\n                onClick={() => router.push(`/trader/offers?quoteId=${id}`)}\n                className=\"mb-4\"\n              >\n                Compare All {offersCount} Offers \n              </Button>\n            ) : null}\n            \n            {offersCount > 0 && (\n              <div className=\"grid gap-4\">\n                {quote.offers?.slice(0, 3).map((offer: any) => (\n                  <Card key={offer.id}>\n                    <CardBody>\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"font-semibold text-gray-900\">{offer.partner?.companyName}</p>\n                          <p className=\"text-2xl font-bold text-blue-600 mt-2\">{offer.price.toLocaleString()}</p>\n                          <p className=\"text-sm text-gray-600\">{offer.transitDays} days transit</p>\n                        </div>\n                        {isTrader && offer.status === 'PENDING' && (\n                          <Button\n                            variant=\"primary\"\n                            onClick={() => router.push(`/trader/offers?quoteId=${id}`)}\n                          >\n                            View Details\n                          </Button>\n                        )}\n                      </div>\n                    </CardBody>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </div>\n        )}\n\n        {activeTab === 'documents' && (\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            {isTrader && (\n              <DocumentUpload\n                quoteId={id as string}\n                token={token!}\n                onUploadComplete={() => fetchQuote()}\n              />\n            )}\n            <Card>\n              <CardHeader>\n                <CardTitle>Uploaded Documents</CardTitle>\n              </CardHeader>\n              <CardBody>\n                {quote.documents && quote.documents.length > 0 ? (\n                  <div className=\"space-y-2\">\n                    {quote.documents.map((doc: any) => (\n                      <div key={doc.id} className=\"flex items-center justify-between p-3 border rounded hover:bg-gray-50\">\n                        <div>\n                          <p className=\"font-medium text-gray-900\">{doc.fileName}</p>\n                          <p className=\"text-xs text-gray-500\">\n                            {doc.documentType}  {(doc.fileSize / 1024).toFixed(2)} KB\n                          </p>\n                        </div>\n                        <Button variant=\"secondary\" size=\"sm\">\n                          Download \n                        </Button>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-6 text-gray-500\">\n                    No documents uploaded yet\n                  </div>\n                )}\n              </CardBody>\n            </Card>\n          </div>\n        )}\n      </div>\n    </Layout>\n  );\n}\n","size_bytes":14250},"pages/api/quotes/[id].ts":{"content":"import { NextApiRequest, NextApiResponse } from 'next';\nimport prisma from '@/lib/prisma';\nimport { withAuth, AuthenticatedRequest } from '@/lib/middleware';\nimport { UserRole } from '@prisma/client';\n\nasync function handler(req: AuthenticatedRequest, res: NextApiResponse) {\n  const { id } = req.query;\n\n  if (typeof id !== 'string') {\n    return res.status(400).json({ error: 'Invalid quote ID' });\n  }\n\n  if (req.method === 'GET') {\n    try {\n      const quote = await prisma.quote.findUnique({\n        where: { id },\n        include: {\n          trader: {\n            select: {\n              id: true,\n              email: true,\n              companyName: true,\n            },\n          },\n          offers: {\n            include: {\n              partner: {\n                select: {\n                  id: true,\n                  email: true,\n                  companyName: true,\n                },\n              },\n            },\n            orderBy: {\n              price: 'asc',\n            },\n          },\n          shipment: true,\n          documents: true,\n        },\n      });\n\n      if (!quote) {\n        return res.status(404).json({ error: 'Quote not found' });\n      }\n\n      if (req.user!.role === UserRole.TRADER && quote.traderId !== req.user!.userId) {\n        return res.status(403).json({ error: 'Access denied' });\n      }\n\n      res.status(200).json({ quote });\n    } catch (error) {\n      console.error('Error fetching quote:', error);\n      res.status(500).json({ error: 'Failed to fetch quote' });\n    }\n  } else if (req.method === 'PATCH') {\n    try {\n      const quote = await prisma.quote.findUnique({\n        where: { id },\n      });\n\n      if (!quote) {\n        return res.status(404).json({ error: 'Quote not found' });\n      }\n\n      if (quote.traderId !== req.user!.userId && req.user!.role !== UserRole.ADMIN) {\n        return res.status(403).json({ error: 'Access denied' });\n      }\n\n      const updatedQuote = await prisma.quote.update({\n        where: { id },\n        data: req.body,\n      });\n\n      await prisma.auditLog.create({\n        data: {\n          userId: req.user!.userId,\n          quoteId: id,\n          action: 'UPDATE',\n          entity: 'QUOTE',\n          entityId: id,\n          changes: req.body,\n        },\n      });\n\n      res.status(200).json({ quote: updatedQuote });\n    } catch (error) {\n      console.error('Error updating quote:', error);\n      res.status(500).json({ error: 'Failed to update quote' });\n    }\n  } else {\n    res.status(405).json({ error: 'Method not allowed' });\n  }\n}\n\nexport default withAuth(handler);\n","size_bytes":2586},"lib/webhook.ts":{"content":"import prisma from './prisma';\nimport { WebhookEvent } from '@prisma/client';\nimport crypto from 'crypto';\n\nconst WEBHOOK_SECRET = process.env.WEBHOOK_SECRET || 'bidchemz-webhook-secret';\n\ninterface WebhookPayload {\n  event: WebhookEvent;\n  data: any;\n  timestamp: string;\n}\n\nexport async function sendWebhook(\n  url: string,\n  event: WebhookEvent,\n  data: any\n): Promise<void> {\n  const payload: WebhookPayload = {\n    event,\n    data,\n    timestamp: new Date().toISOString(),\n  };\n\n  const hmacSignature = generateHMACSignature(payload);\n\n  try {\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-Webhook-Signature': hmacSignature,\n      },\n      body: JSON.stringify(payload),\n    });\n\n    await prisma.webhookLog.create({\n      data: {\n        event,\n        payload: payload as any,\n        url,\n        hmacSignature,\n        status: response.status,\n        responseBody: await response.text(),\n        attempts: 1,\n        lastAttempt: new Date(),\n      },\n    });\n\n    if (!response.ok) {\n      console.error(`Webhook failed: ${response.status} ${response.statusText}`);\n    }\n  } catch (error) {\n    console.error('Error sending webhook:', error);\n\n    await prisma.webhookLog.create({\n      data: {\n        event,\n        payload: payload as any,\n        url,\n        hmacSignature,\n        status: null,\n        responseBody: error instanceof Error ? error.message : 'Unknown error',\n        attempts: 1,\n        lastAttempt: new Date(),\n      },\n    });\n  }\n}\n\nfunction generateHMACSignature(payload: any): string {\n  const hmac = crypto.createHmac('sha256', WEBHOOK_SECRET);\n  hmac.update(JSON.stringify(payload));\n  return hmac.digest('hex');\n}\n\nexport function verifyWebhookSignature(payload: any, signature: string): boolean {\n  const expectedSignature = generateHMACSignature(payload);\n  return crypto.timingSafeEqual(\n    Buffer.from(signature),\n    Buffer.from(expectedSignature)\n  );\n}\n","size_bytes":1991},"pages/api/auth/me.ts":{"content":"import { NextApiResponse } from 'next';\nimport prisma from '@/lib/prisma';\nimport { withAuth, AuthenticatedRequest } from '@/lib/middleware';\n\nasync function handler(req: AuthenticatedRequest, res: NextApiResponse) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  try {\n    const user = await prisma.user.findUnique({\n      where: { id: req.user!.userId },\n      select: {\n        id: true,\n        email: true,\n        phone: true,\n        role: true,\n        companyName: true,\n        gstin: true,\n        isVerified: true,\n        isActive: true,\n        createdAt: true,\n      },\n    });\n\n    if (!user) {\n      return res.status(404).json({ error: 'User not found' });\n    }\n\n    res.status(200).json({ user });\n  } catch (error) {\n    console.error('Get user error:', error);\n    res.status(500).json({ error: 'Internal server error' });\n  }\n}\n\nexport default withAuth(handler);\n","size_bytes":942},"lib/auth.ts":{"content":"import bcrypt from 'bcryptjs';\nimport { sign, verify } from 'jsonwebtoken';\nimport { UserRole } from '@prisma/client';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'bidchemz-secret-change-in-production';\nconst JWT_EXPIRES_IN = '7d';\n\nexport interface JWTPayload {\n  userId: string;\n  email: string;\n  role: UserRole;\n  companyName?: string;\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, 10);\n}\n\nexport async function verifyPassword(\n  password: string,\n  hashedPassword: string\n): Promise<boolean> {\n  return bcrypt.compare(password, hashedPassword);\n}\n\nexport function generateToken(payload: JWTPayload): string {\n  return sign(payload, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN });\n}\n\nexport function verifyToken(token: string): JWTPayload | null {\n  try {\n    return verify(token, JWT_SECRET) as JWTPayload;\n  } catch (error) {\n    return null;\n  }\n}\n\nexport function extractTokenFromHeader(authHeader?: string): string | null {\n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    return null;\n  }\n  return authHeader.substring(7);\n}\n","size_bytes":1106},"lib/prisma.ts":{"content":"import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n\nexport default prisma;\n","size_bytes":407},"pages/api/partner/capabilities.ts":{"content":"import { NextApiResponse } from 'next';\nimport prisma from '@/lib/prisma';\nimport { withAuth, AuthenticatedRequest } from '@/lib/middleware';\nimport { UserRole } from '@prisma/client';\n\nasync function handler(req: AuthenticatedRequest, res: NextApiResponse) {\n  if (req.user!.role !== UserRole.LOGISTICS_PARTNER) {\n    return res.status(403).json({\n      error: 'Only logistics partners can manage capabilities',\n    });\n  }\n\n  if (req.method === 'GET') {\n    try {\n      const capabilities = await prisma.partnerCapability.findUnique({\n        where: { userId: req.user!.userId },\n      });\n\n      res.status(200).json({ capabilities });\n    } catch (error) {\n      console.error('Error fetching capabilities:', error);\n      res.status(500).json({ error: 'Failed to fetch capabilities' });\n    }\n  } else if (req.method === 'PUT') {\n    try {\n      const {\n        dgClasses,\n        serviceStates,\n        fleetTypes,\n        packagingCapabilities,\n        temperatureControlled,\n        subscriptionTier,\n      } = req.body;\n\n      const capabilities = await prisma.partnerCapability.upsert({\n        where: { userId: req.user!.userId },\n        update: {\n          dgClasses: dgClasses || [],\n          serviceStates: serviceStates || [],\n          fleetTypes: fleetTypes || [],\n          packagingCapabilities: packagingCapabilities || [],\n          temperatureControlled: temperatureControlled || false,\n          subscriptionTier: subscriptionTier || 'FREE',\n        },\n        create: {\n          userId: req.user!.userId,\n          serviceTypes: [],\n          dgClasses: dgClasses || [],\n          productCategories: [],\n          serviceCities: [],\n          serviceStates: serviceStates || [],\n          serviceCountries: ['India'],\n          fleetTypes: fleetTypes || [],\n          packagingCapabilities: packagingCapabilities || [],\n          temperatureControlled: temperatureControlled || false,\n          certifications: [],\n          warehouseLocations: [],\n        },\n      });\n\n      await prisma.auditLog.create({\n        data: {\n          userId: req.user!.userId,\n          action: 'UPDATE_CAPABILITIES',\n          entity: 'PARTNER_CAPABILITY',\n          entityId: capabilities.id,\n          changes: req.body,\n        },\n      });\n\n      res.status(200).json({\n        capabilities,\n        message: 'Capabilities updated successfully',\n      });\n    } catch (error) {\n      console.error('Error updating capabilities:', error);\n      res.status(500).json({ error: 'Failed to update capabilities' });\n    }\n  } else {\n    res.status(405).json({ error: 'Method not allowed' });\n  }\n}\n\nexport default withAuth(handler);\n","size_bytes":2642},"pages/api/wallet/index.ts":{"content":"import { NextApiResponse } from 'next';\nimport prisma from '@/lib/prisma';\nimport { withAuth, AuthenticatedRequest } from '@/lib/middleware';\nimport { UserRole, TransactionType } from '@prisma/client';\n\nasync function handler(req: AuthenticatedRequest, res: NextApiResponse) {\n  if (req.method === 'GET') {\n    try {\n      if (req.user!.role !== UserRole.LOGISTICS_PARTNER) {\n        return res.status(403).json({\n          error: 'Only logistics partners can access wallet',\n        });\n      }\n\n      const wallet = await prisma.leadWallet.findUnique({\n        where: { userId: req.user!.userId },\n        include: {\n          transactions: {\n            orderBy: { createdAt: 'desc' },\n            take: 50,\n          },\n        },\n      });\n\n      if (!wallet) {\n        return res.status(404).json({ error: 'Wallet not found' });\n      }\n\n      res.status(200).json({ wallet });\n    } catch (error) {\n      console.error('Error fetching wallet:', error);\n      res.status(500).json({ error: 'Failed to fetch wallet' });\n    }\n  } else if (req.method === 'POST') {\n    try {\n      if (req.user!.role !== UserRole.LOGISTICS_PARTNER) {\n        return res.status(403).json({\n          error: 'Only logistics partners can recharge wallet',\n        });\n      }\n\n      const { amount, paymentMethod } = req.body;\n\n      if (!amount || typeof amount !== 'number' || amount <= 0 || amount > 1000000) {\n        return res.status(400).json({ error: 'Invalid amount (must be between 0 and 1,000,000)' });\n      }\n\n      let wallet = await prisma.leadWallet.findUnique({\n        where: { userId: req.user!.userId },\n      });\n\n      if (!wallet) {\n        wallet = await prisma.leadWallet.create({\n          data: {\n            userId: req.user!.userId,\n            balance: 0,\n          },\n        });\n      }\n\n      const updatedWallet = await prisma.leadWallet.update({\n        where: { id: wallet.id },\n        data: {\n          balance: {\n            increment: amount,\n          },\n        },\n      });\n\n      await prisma.leadTransaction.create({\n        data: {\n          walletId: wallet.id,\n          transactionType: TransactionType.RECHARGE,\n          amount,\n          description: `Wallet recharge via ${paymentMethod || 'manual'}`,\n        },\n      });\n\n      await prisma.auditLog.create({\n        data: {\n          userId: req.user!.userId,\n          action: 'RECHARGE_WALLET',\n          entity: 'WALLET',\n          entityId: wallet.id,\n          changes: { amount, newBalance: updatedWallet.balance },\n        },\n      });\n\n      res.status(200).json({\n        wallet: updatedWallet,\n        message: 'Wallet recharged successfully',\n      });\n    } catch (error) {\n      console.error('Error recharging wallet:', error);\n      res.status(500).json({ error: 'Failed to recharge wallet' });\n    }\n  } else {\n    res.status(405).json({ error: 'Method not allowed' });\n  }\n}\n\nexport default withAuth(handler);\n","size_bytes":2917},"pages/api/offers/index.ts":{"content":"import { NextApiResponse } from 'next';\nimport prisma from '@/lib/prisma';\nimport { withAuth, AuthenticatedRequest } from '@/lib/middleware';\nimport { UserRole, OfferStatus } from '@prisma/client';\n\nasync function handler(req: AuthenticatedRequest, res: NextApiResponse) {\n  if (req.method === 'GET') {\n    try {\n      const { quoteId, status } = req.query;\n\n      const where: any = {};\n\n      if (req.user!.role === UserRole.LOGISTICS_PARTNER) {\n        where.partnerId = req.user!.userId;\n      }\n\n      if (quoteId && typeof quoteId === 'string') {\n        where.quoteId = quoteId;\n      }\n\n      if (status && typeof status === 'string') {\n        where.status = status as OfferStatus;\n      }\n\n      const offers = await prisma.offer.findMany({\n        where,\n        include: {\n          quote: {\n            select: {\n              id: true,\n              quoteNumber: true,\n              cargoName: true,\n              quantity: true,\n              quantityUnit: true,\n              pickupCity: true,\n              deliveryCity: true,\n              cargoReadyDate: true,\n            },\n          },\n          partner: {\n            select: {\n              id: true,\n              email: true,\n              companyName: true,\n            },\n          },\n        },\n        orderBy: {\n          createdAt: 'desc',\n        },\n      });\n\n      res.status(200).json({ offers });\n    } catch (error) {\n      console.error('Error fetching offers:', error);\n      res.status(500).json({ error: 'Failed to fetch offers' });\n    }\n  } else if (req.method === 'POST') {\n    try {\n      if (req.user!.role !== UserRole.LOGISTICS_PARTNER) {\n        return res.status(403).json({\n          error: 'Only logistics partners can submit offers',\n        });\n      }\n\n      const {\n        quoteId,\n        price,\n        transitDays,\n        offerValidUntil,\n        pickupAvailableFrom,\n        insuranceIncluded,\n        trackingIncluded,\n        customsClearance,\n        valueAddedServices,\n        termsAndConditions,\n        remarks,\n      } = req.body;\n\n      if (!quoteId || !price || !transitDays || !offerValidUntil || !pickupAvailableFrom) {\n        return res.status(400).json({\n          error: 'Missing required fields',\n        });\n      }\n\n      const quote = await prisma.quote.findUnique({\n        where: { id: quoteId },\n      });\n\n      if (!quote) {\n        return res.status(404).json({ error: 'Quote not found' });\n      }\n\n      const existingOffer = await prisma.offer.findFirst({\n        where: {\n          quoteId,\n          partnerId: req.user!.userId,\n          status: { not: OfferStatus.WITHDRAWN },\n        },\n      });\n\n      if (existingOffer) {\n        return res.status(409).json({\n          error: 'You have already submitted an offer for this quote',\n        });\n      }\n\n      const wallet = await prisma.leadWallet.findUnique({\n        where: { userId: req.user!.userId },\n      });\n\n      if (!wallet || wallet.balance <= 0) {\n        return res.status(400).json({\n          error: 'Insufficient lead wallet balance',\n        });\n      }\n\n      const expiresAt = new Date(offerValidUntil);\n\n      const offer = await prisma.offer.create({\n        data: {\n          quoteId,\n          partnerId: req.user!.userId,\n          price,\n          transitDays,\n          offerValidUntil: new Date(offerValidUntil),\n          pickupAvailableFrom: new Date(pickupAvailableFrom),\n          insuranceIncluded: insuranceIncluded || false,\n          trackingIncluded: trackingIncluded !== false,\n          customsClearance: customsClearance || false,\n          valueAddedServices: valueAddedServices || [],\n          termsAndConditions,\n          remarks,\n          expiresAt,\n        },\n        include: {\n          quote: true,\n          partner: {\n            select: {\n              id: true,\n              email: true,\n              companyName: true,\n            },\n          },\n        },\n      });\n\n      await prisma.auditLog.create({\n        data: {\n          userId: req.user!.userId,\n          action: 'CREATE',\n          entity: 'OFFER',\n          entityId: offer.id,\n          changes: { quoteId, price },\n        },\n      });\n\n      res.status(201).json({\n        offer,\n        message: 'Offer submitted successfully',\n      });\n    } catch (error) {\n      console.error('Error creating offer:', error);\n      res.status(500).json({ error: 'Failed to create offer' });\n    }\n  } else {\n    res.status(405).json({ error: 'Method not allowed' });\n  }\n}\n\nexport default withAuth(handler);\n","size_bytes":4521},"postcss.config.js":{"content":"module.exports = {\n  plugins: {\n    \"@tailwindcss/postcss\": {},\n  },\n}\n","size_bytes":71},"pages/admin/dashboard.tsx":{"content":"import React, { useEffect, useState } from 'react';\nimport { Layout } from '@/components/layout/Layout';\nimport { useAuth } from '@/contexts/AuthContext';\nimport Card from '@/components/ui/Card';\nimport { useRouter } from 'next/router';\n\nexport default function AdminDashboard() {\n  const { user } = useAuth();\n  const router = useRouter();\n  const [stats, setStats] = useState({\n    totalQuotes: 0,\n    totalOffers: 0,\n    totalShipments: 0,\n    activePartners: 0,\n  });\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (!user || user.role !== 'ADMIN') {\n      router.push('/');\n      return;\n    }\n\n    fetchAdminStats();\n  }, [user]);\n\n  const fetchAdminStats = async () => {\n    setLoading(false);\n  };\n\n  if (loading) {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">Loading...</div>\n      </Layout>\n    );\n  }\n\n  return (\n    <Layout>\n      <div>\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-8\">Admin Dashboard</h1>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n          <Card>\n            <h3 className=\"text-sm font-medium text-gray-500 mb-2\">Total Quotes</h3>\n            <p className=\"text-3xl font-bold text-blue-600\">{stats.totalQuotes}</p>\n          </Card>\n\n          <Card>\n            <h3 className=\"text-sm font-medium text-gray-500 mb-2\">Total Offers</h3>\n            <p className=\"text-3xl font-bold text-blue-600\">{stats.totalOffers}</p>\n          </Card>\n\n          <Card>\n            <h3 className=\"text-sm font-medium text-gray-500 mb-2\">Active Shipments</h3>\n            <p className=\"text-3xl font-bold text-green-600\">{stats.totalShipments}</p>\n          </Card>\n\n          <Card>\n            <h3 className=\"text-sm font-medium text-gray-500 mb-2\">Active Partners</h3>\n            <p className=\"text-3xl font-bold text-purple-600\">{stats.activePartners}</p>\n          </Card>\n        </div>\n\n        <Card>\n          <h2 className=\"text-xl font-semibold mb-4\">System Management</h2>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"p-4 border border-gray-200 rounded hover:bg-gray-50 cursor-pointer\">\n              <h3 className=\"font-medium\">Manage Users</h3>\n              <p className=\"text-sm text-gray-600\">View and manage all users</p>\n            </div>\n            <div className=\"p-4 border border-gray-200 rounded hover:bg-gray-50 cursor-pointer\">\n              <h3 className=\"font-medium\">Pricing Configuration</h3>\n              <p className=\"text-sm text-gray-600\">Configure lead pricing tiers</p>\n            </div>\n            <div className=\"p-4 border border-gray-200 rounded hover:bg-gray-50 cursor-pointer\">\n              <h3 className=\"font-medium\">Partner Verification</h3>\n              <p className=\"text-sm text-gray-600\">Review and verify partners</p>\n            </div>\n            <div className=\"p-4 border border-gray-200 rounded hover:bg-gray-50 cursor-pointer\">\n              <h3 className=\"font-medium\">System Logs</h3>\n              <p className=\"text-sm text-gray-600\">View audit and webhook logs</p>\n            </div>\n          </div>\n        </Card>\n      </div>\n    </Layout>\n  );\n}\n","size_bytes":3167},"components/forms/CheckboxGroup.tsx":{"content":"import React from 'react';\n\ninterface CheckboxOption {\n  label: string;\n  value: string;\n  description?: string;\n}\n\ninterface CheckboxGroupProps {\n  label: string;\n  name: string;\n  options: CheckboxOption[];\n  value: string[];\n  onChange: (values: string[]) => void;\n  error?: string;\n  required?: boolean;\n}\n\nexport function CheckboxGroup({\n  label,\n  name,\n  options,\n  value,\n  onChange,\n  error,\n  required = false,\n}: CheckboxGroupProps) {\n  const handleChange = (optionValue: string, checked: boolean) => {\n    if (checked) {\n      onChange([...value, optionValue]);\n    } else {\n      onChange(value.filter((v) => v !== optionValue));\n    }\n  };\n\n  return (\n    <div className=\"mb-4\">\n      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n        {label}\n        {required && <span className=\"text-red-500 ml-1\">*</span>}\n      </label>\n      <div className=\"space-y-2\">\n        {options.map((option) => (\n          <div key={option.value} className=\"flex items-start\">\n            <input\n              type=\"checkbox\"\n              id={`${name}-${option.value}`}\n              name={name}\n              value={option.value}\n              checked={value.includes(option.value)}\n              onChange={(e) => handleChange(option.value, e.target.checked)}\n              className=\"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n            />\n            <label\n              htmlFor={`${name}-${option.value}`}\n              className=\"ml-3 cursor-pointer\"\n            >\n              <span className=\"block text-sm text-gray-900\">{option.label}</span>\n              {option.description && (\n                <span className=\"block text-xs text-gray-500\">{option.description}</span>\n              )}\n            </label>\n          </div>\n        ))}\n      </div>\n      {error && (\n        <p className=\"mt-1 text-sm text-red-600\">{error}</p>\n      )}\n    </div>\n  );\n}\n","size_bytes":1918},"pages/api/documents/[id]/download.ts":{"content":"import { NextApiRequest, NextApiResponse } from 'next';\nimport { withAuth, AuthenticatedRequest } from '@/lib/middleware';\nimport prisma from '@/lib/prisma';\nimport { decryptBuffer } from '@/lib/file-encryption';\nimport fs from 'fs';\nimport path from 'path';\n\nasync function handler(req: AuthenticatedRequest, res: NextApiResponse) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  try {\n    const { id } = req.query;\n\n    if (typeof id !== 'string') {\n      return res.status(400).json({ error: 'Invalid document ID' });\n    }\n\n    const document = await prisma.document.findUnique({\n      where: { id },\n      include: {\n        quote: {\n          select: {\n            traderId: true,\n          },\n        },\n        shipment: {\n          select: {\n            offer: {\n              select: {\n                partnerId: true,\n              },\n            },\n          },\n        },\n      },\n    });\n\n    if (!document) {\n      return res.status(404).json({ error: 'Document not found' });\n    }\n\n    const isTrader = document.quote?.traderId === req.user!.userId;\n    const isPartner = document.shipment?.offer.partnerId === req.user!.userId;\n    const isAdmin = req.user!.role === 'ADMIN';\n\n    if (!isTrader && !isPartner && !isAdmin) {\n      return res.status(403).json({ error: 'Access denied' });\n    }\n\n    if (!document.encryptionKey) {\n      return res.status(500).json({ error: 'Document encryption key not found' });\n    }\n\n    const fileUrl = document.fileUrl.startsWith('/') \n      ? document.fileUrl.substring(1) \n      : document.fileUrl;\n    const encryptedFilePath = path.join(process.cwd(), fileUrl);\n\n    if (!fs.existsSync(encryptedFilePath)) {\n      return res.status(404).json({ error: 'File not found on server' });\n    }\n\n    const encryptedBuffer = await fs.promises.readFile(encryptedFilePath);\n\n    const decryptedBuffer = await decryptBuffer(\n      encryptedBuffer,\n      document.encryptionKey\n    );\n\n    await prisma.auditLog.create({\n      data: {\n        userId: req.user!.userId,\n        quoteId: document.quoteId || undefined,\n        shipmentId: document.shipmentId || undefined,\n        action: 'DOWNLOAD_DOCUMENT',\n        entity: 'DOCUMENT',\n        entityId: document.id,\n      },\n    });\n\n    res.setHeader('Content-Type', document.fileType);\n    res.setHeader(\n      'Content-Disposition',\n      `attachment; filename=\"${document.fileName}\"`\n    );\n    res.setHeader('Content-Length', decryptedBuffer.length);\n\n    res.send(decryptedBuffer);\n  } catch (error) {\n    console.error('Error downloading document:', error);\n    res.status(500).json({ error: 'Failed to download document' });\n  }\n}\n\nexport default withAuth(handler);\n","size_bytes":2728},"pages/api/documents/upload.ts":{"content":"import { NextApiRequest, NextApiResponse } from 'next';\nimport { withAuth, AuthenticatedRequest } from '@/lib/middleware';\nimport prisma from '@/lib/prisma';\nimport { encryptBuffer, generateEncryptionKey } from '@/lib/file-encryption';\nimport formidable from 'formidable';\nimport fs from 'fs';\nimport path from 'path';\n\nexport const config = {\n  api: {\n    bodyParser: false,\n  },\n};\n\nasync function handler(req: AuthenticatedRequest, res: NextApiResponse) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  try {\n    const form = formidable({ multiples: false });\n\n    const [fields, files] = await new Promise<[formidable.Fields, formidable.Files]>(\n      (resolve, reject) => {\n        form.parse(req, (err, fields, files) => {\n          if (err) reject(err);\n          else resolve([fields, files]);\n        });\n      }\n    );\n\n    const file = Array.isArray(files.file) ? files.file[0] : files.file;\n    const quoteId = Array.isArray(fields.quoteId) ? fields.quoteId[0] : fields.quoteId;\n    const documentType = Array.isArray(fields.documentType) \n      ? fields.documentType[0] \n      : fields.documentType || 'MSDS';\n\n    if (!file) {\n      return res.status(400).json({ error: 'No file uploaded' });\n    }\n\n    if (!quoteId) {\n      return res.status(400).json({ error: 'Quote ID is required' });\n    }\n\n    const quote = await prisma.quote.findUnique({\n      where: { id: quoteId },\n    });\n\n    if (!quote) {\n      return res.status(404).json({ error: 'Quote not found' });\n    }\n\n    if (quote.traderId !== req.user!.userId) {\n      return res.status(403).json({ error: 'Access denied' });\n    }\n\n    const fileBuffer = await fs.promises.readFile(file.filepath);\n\n    const encryptionKey = generateEncryptionKey();\n    const { encrypted } = await encryptBuffer(fileBuffer, encryptionKey);\n\n    const uploadsDir = path.join(process.cwd(), 'uploads', 'encrypted');\n    await fs.promises.mkdir(uploadsDir, { recursive: true });\n\n    const encryptedFileName = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}.enc`;\n    const encryptedFilePath = path.join(uploadsDir, encryptedFileName);\n\n    await fs.promises.writeFile(encryptedFilePath, encrypted);\n\n    await fs.promises.unlink(file.filepath);\n\n    const document = await prisma.document.create({\n      data: {\n        quoteId,\n        fileName: file.originalFilename || 'unknown',\n        fileType: file.mimetype || 'application/octet-stream',\n        fileSize: file.size,\n        fileUrl: `/uploads/encrypted/${encryptedFileName}`,\n        encryptionKey,\n        documentType,\n        uploadedBy: req.user!.userId,\n      },\n    });\n\n    await prisma.auditLog.create({\n      data: {\n        userId: req.user!.userId,\n        quoteId,\n        action: 'UPLOAD_DOCUMENT',\n        entity: 'DOCUMENT',\n        entityId: document.id,\n        changes: {\n          fileName: document.fileName,\n          documentType,\n        },\n      },\n    });\n\n    res.status(201).json({\n      document: {\n        id: document.id,\n        fileName: document.fileName,\n        fileType: document.fileType,\n        fileSize: document.fileSize,\n        documentType: document.documentType,\n        createdAt: document.createdAt,\n      },\n      message: 'Document uploaded and encrypted successfully',\n    });\n  } catch (error) {\n    console.error('Error uploading document:', error);\n    res.status(500).json({ error: 'Failed to upload document' });\n  }\n}\n\nexport default withAuth(handler);\n","size_bytes":3492},"pages/partner/submit-offer.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport { Layout } from '@/components/layout/Layout';\nimport { Card, CardHeader, CardBody, CardTitle } from '@/components/ui/Card';\nimport { FormField } from '@/components/forms/FormField';\nimport Button from '@/components/ui/Button';\nimport { CountdownTimer } from '@/components/CountdownTimer';\nimport { useAuth } from '@/contexts/AuthContext';\n\nexport default function SubmitOffer() {\n  const { user, token } = useAuth();\n  const router = useRouter();\n  const { quoteId } = router.query;\n  const [quote, setQuote] = useState<any>(null);\n  const [wallet, setWallet] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [submitting, setSubmitting] = useState(false);\n  const [estimatedCost, setEstimatedCost] = useState(0);\n\n  const [formData, setFormData] = useState({\n    price: '',\n    transitDays: '',\n    offerValidUntil: '',\n    pickupAvailableFrom: '',\n    insuranceIncluded: false,\n    trackingIncluded: true,\n    customsClearance: false,\n    valueAddedServices: '',\n    termsAndConditions: '',\n    remarks: '',\n  });\n\n  useEffect(() => {\n    if (token && quoteId) {\n      fetchQuote();\n      fetchWallet();\n    }\n  }, [token, quoteId]);\n\n  const fetchQuote = async () => {\n    try {\n      const response = await fetch(`/api/quotes/${quoteId}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n\n      const data = await response.json();\n      if (response.ok) {\n        setQuote(data.quote);\n        calculateEstimatedCost(data.quote);\n      }\n    } catch (error) {\n      console.error('Error fetching quote:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchWallet = async () => {\n    try {\n      const response = await fetch('/api/wallet', {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n\n      const data = await response.json();\n      if (response.ok) {\n        setWallet(data.wallet);\n      }\n    } catch (error) {\n      console.error('Error fetching wallet:', error);\n    }\n  };\n\n  const calculateEstimatedCost = (quoteData: any) => {\n    let cost = 500;\n    if (quoteData.isHazardous) cost += 300;\n    if (quoteData.quantity > 50) cost += 200;\n    setEstimatedCost(cost);\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n    const { name, value, type } = e.target;\n    const checked = (e.target as HTMLInputElement).checked;\n\n    setFormData(prev => ({\n      ...prev,\n      [name]: type === 'checkbox' ? checked : value,\n    }));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!quoteId) return;\n\n    if (wallet && wallet.balance < estimatedCost) {\n      alert(`Insufficient balance. You need ${estimatedCost} to submit this offer. Current balance: ${wallet.balance}`);\n      return;\n    }\n\n    setSubmitting(true);\n\n    try {\n      const response = await fetch('/api/offers', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        body: JSON.stringify({\n          quoteId,\n          ...formData,\n          price: parseFloat(formData.price),\n          transitDays: parseInt(formData.transitDays),\n          valueAddedServices: formData.valueAddedServices.split(',').map(s => s.trim()).filter(Boolean),\n        }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Failed to submit offer');\n      }\n\n      router.push('/partner/dashboard');\n    } catch (error) {\n      alert(error instanceof Error ? error.message : 'Failed to submit offer');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  if (!user || user.role !== 'LOGISTICS_PARTNER') {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">\n          <p className=\"text-gray-600\">Access denied. Partners only.</p>\n        </div>\n      </Layout>\n    );\n  }\n\n  if (loading) {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">\n          <div className=\"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n        </div>\n      </Layout>\n    );\n  }\n\n  if (!quote) {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">\n          <p className=\"text-gray-600\">Quote not found</p>\n        </div>\n      </Layout>\n    );\n  }\n\n  return (\n    <Layout>\n      <div className=\"max-w-5xl mx-auto\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h1 className=\"text-3xl font-bold text-gray-900\">Submit Offer</h1>\n          {quote.expiresAt && <CountdownTimer expiresAt={quote.expiresAt} />}\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          <div className=\"lg:col-span-2\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Offer Details</CardTitle>\n              </CardHeader>\n              <CardBody>\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      label=\"Your Price (INR)\"\n                      name=\"price\"\n                      type=\"number\"\n                      value={formData.price}\n                      onChange={handleChange}\n                      required\n                      min=\"0\"\n                      step=\"0.01\"\n                      placeholder=\"Enter your competitive price\"\n                    />\n                    <FormField\n                      label=\"Transit Days\"\n                      name=\"transitDays\"\n                      type=\"number\"\n                      value={formData.transitDays}\n                      onChange={handleChange}\n                      required\n                      min=\"1\"\n                      placeholder=\"Number of days\"\n                    />\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      label=\"Offer Valid Until\"\n                      name=\"offerValidUntil\"\n                      type=\"datetime-local\"\n                      value={formData.offerValidUntil}\n                      onChange={handleChange}\n                      required\n                    />\n                    <FormField\n                      label=\"Pickup Available From\"\n                      name=\"pickupAvailableFrom\"\n                      type=\"datetime-local\"\n                      value={formData.pickupAvailableFrom}\n                      onChange={handleChange}\n                      required\n                    />\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <label className=\"block text-sm font-medium text-gray-700\">\n                      Value-Added Services\n                    </label>\n                    <div className=\"space-y-2\">\n                      <div className=\"flex items-center\">\n                        <input\n                          type=\"checkbox\"\n                          id=\"insuranceIncluded\"\n                          name=\"insuranceIncluded\"\n                          checked={formData.insuranceIncluded}\n                          onChange={handleChange}\n                          className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                        />\n                        <label htmlFor=\"insuranceIncluded\" className=\"ml-2 text-sm text-gray-700\">\n                          Insurance Included\n                        </label>\n                      </div>\n                      <div className=\"flex items-center\">\n                        <input\n                          type=\"checkbox\"\n                          id=\"trackingIncluded\"\n                          name=\"trackingIncluded\"\n                          checked={formData.trackingIncluded}\n                          onChange={handleChange}\n                          className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                        />\n                        <label htmlFor=\"trackingIncluded\" className=\"ml-2 text-sm text-gray-700\">\n                          Real-time Tracking Included\n                        </label>\n                      </div>\n                      <div className=\"flex items-center\">\n                        <input\n                          type=\"checkbox\"\n                          id=\"customsClearance\"\n                          name=\"customsClearance\"\n                          checked={formData.customsClearance}\n                          onChange={handleChange}\n                          className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                        />\n                        <label htmlFor=\"customsClearance\" className=\"ml-2 text-sm text-gray-700\">\n                          Customs Clearance Assistance\n                        </label>\n                      </div>\n                    </div>\n                  </div>\n\n                  <FormField\n                    label=\"Additional Services (comma-separated)\"\n                    name=\"valueAddedServices\"\n                    type=\"textarea\"\n                    value={formData.valueAddedServices}\n                    onChange={handleChange}\n                    placeholder=\"e.g., Warehousing, Packing, Loading assistance\"\n                  />\n\n                  <FormField\n                    label=\"Terms & Conditions\"\n                    name=\"termsAndConditions\"\n                    type=\"textarea\"\n                    value={formData.termsAndConditions}\n                    onChange={handleChange}\n                    placeholder=\"Your terms and conditions\"\n                  />\n\n                  <FormField\n                    label=\"Remarks\"\n                    name=\"remarks\"\n                    type=\"textarea\"\n                    value={formData.remarks}\n                    onChange={handleChange}\n                    placeholder=\"Any additional information\"\n                  />\n\n                  <div className=\"flex justify-end space-x-3 pt-4\">\n                    <Button\n                      type=\"button\"\n                      variant=\"secondary\"\n                      onClick={() => router.back()}\n                    >\n                      Cancel\n                    </Button>\n                    <Button\n                      type=\"submit\"\n                      variant=\"primary\"\n                      disabled={submitting}\n                    >\n                      {submitting ? 'Submitting...' : 'Submit Offer'}\n                    </Button>\n                  </div>\n                </form>\n              </CardBody>\n            </Card>\n          </div>\n\n          <div className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Quote Summary</CardTitle>\n              </CardHeader>\n              <CardBody>\n                <div className=\"space-y-3\">\n                  <div>\n                    <p className=\"text-sm text-gray-500\">Cargo</p>\n                    <p className=\"font-medium\">{quote.cargoName}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-gray-500\">Quantity</p>\n                    <p className=\"font-medium\">{quote.quantity} {quote.quantityUnit}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-gray-500\">From</p>\n                    <p className=\"font-medium\">{quote.pickupCity}, {quote.pickupState}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-gray-500\">To</p>\n                    <p className=\"font-medium\">{quote.deliveryCity}, {quote.deliveryState}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-gray-500\">Ready Date</p>\n                    <p className=\"font-medium\">{new Date(quote.cargoReadyDate).toLocaleDateString()}</p>\n                  </div>\n                  {quote.isHazardous && (\n                    <div className=\"pt-2 border-t\">\n                      <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\">\n                         Hazardous: {quote.hazardClass}\n                      </span>\n                    </div>\n                  )}\n                </div>\n              </CardBody>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Estimated Lead Cost</CardTitle>\n              </CardHeader>\n              <CardBody>\n                <div className=\"text-center\">\n                  <p className=\"text-3xl font-bold text-blue-600 mb-2\">\n                    {estimatedCost}\n                  </p>\n                  <p className=\"text-sm text-gray-600 mb-4\">\n                    Will be deducted if your offer is selected\n                  </p>\n                  {wallet && (\n                    <div className=\"pt-4 border-t\">\n                      <p className=\"text-sm text-gray-500\">Current Balance</p>\n                      <p className={`text-xl font-semibold ${wallet.balance >= estimatedCost ? 'text-green-600' : 'text-red-600'}`}>\n                        {wallet.balance.toLocaleString()}\n                      </p>\n                      {wallet.balance < estimatedCost && (\n                        <p className=\"text-xs text-red-600 mt-2\">\n                          Insufficient balance\n                        </p>\n                      )}\n                    </div>\n                  )}\n                </div>\n              </CardBody>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </Layout>\n  );\n}\n","size_bytes":13798},"components/NotificationCenter.tsx":{"content":"import React, { useState } from 'react';\nimport { Card, CardHeader, CardBody } from '@/components/ui/Card';\n\ninterface Notification {\n  id: string;\n  title: string;\n  message: string;\n  priority: 'LOW' | 'MEDIUM' | 'HIGH' | 'URGENT';\n  timestamp: string;\n  read: boolean;\n  type: string;\n}\n\nexport const NotificationCenter: React.FC = () => {\n  const [notifications] = useState<Notification[]>([\n    {\n      id: '1',\n      title: 'New Lead Available',\n      message: 'Sulfuric Acid transport from Mumbai to Delhi - 25 MT',\n      priority: 'HIGH',\n      timestamp: new Date(Date.now() - 300000).toISOString(),\n      read: false,\n      type: 'NEW_LEAD',\n    },\n    {\n      id: '2',\n      title: 'Quote Deadline Approaching',\n      message: 'Only 10 minutes remaining to submit your offer',\n      priority: 'URGENT',\n      timestamp: new Date(Date.now() - 600000).toISOString(),\n      read: false,\n      type: 'TIMER_WARNING',\n    },\n    {\n      id: '3',\n      title: 'Low Wallet Balance',\n      message: 'Your current balance is 450. Please recharge soon.',\n      priority: 'MEDIUM',\n      timestamp: new Date(Date.now() - 3600000).toISOString(),\n      read: true,\n      type: 'LOW_BALANCE',\n    },\n  ]);\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case 'URGENT':\n        return 'bg-red-100 text-red-800 border-red-300';\n      case 'HIGH':\n        return 'bg-orange-100 text-orange-800 border-orange-300';\n      case 'MEDIUM':\n        return 'bg-yellow-100 text-yellow-800 border-yellow-300';\n      default:\n        return 'bg-blue-100 text-blue-800 border-blue-300';\n    }\n  };\n\n  const getTimeAgo = (timestamp: string) => {\n    const now = new Date().getTime();\n    const then = new Date(timestamp).getTime();\n    const diff = now - then;\n    const minutes = Math.floor(diff / 60000);\n    \n    if (minutes < 1) return 'Just now';\n    if (minutes < 60) return `${minutes}m ago`;\n    const hours = Math.floor(minutes / 60);\n    if (hours < 24) return `${hours}h ago`;\n    const days = Math.floor(hours / 24);\n    return `${days}d ago`;\n  };\n\n  const unreadCount = notifications.filter(n => !n.read).length;\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"text-lg font-semibold text-gray-900\">\n            Notifications\n          </h3>\n          {unreadCount > 0 && (\n            <span className=\"inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white bg-red-600 rounded-full\">\n              {unreadCount}\n            </span>\n          )}\n        </div>\n      </CardHeader>\n      <CardBody className=\"p-0\">\n        <div className=\"divide-y divide-gray-200\">\n          {notifications.map((notification) => (\n            <div\n              key={notification.id}\n              className={`p-4 hover:bg-gray-50 transition-colors ${\n                !notification.read ? 'bg-blue-50' : ''\n              }`}\n            >\n              <div className=\"flex items-start space-x-3\">\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center space-x-2 mb-1\">\n                    <p className={`text-sm font-semibold ${!notification.read ? 'text-gray-900' : 'text-gray-700'}`}>\n                      {notification.title}\n                    </p>\n                    <span className={`px-2 py-0.5 text-xs font-semibold rounded border ${getPriorityColor(notification.priority)}`}>\n                      {notification.priority}\n                    </span>\n                  </div>\n                  <p className=\"text-sm text-gray-600\">\n                    {notification.message}\n                  </p>\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    {getTimeAgo(notification.timestamp)}\n                  </p>\n                </div>\n                {!notification.read && (\n                  <div className=\"flex-shrink-0\">\n                    <div className=\"w-2 h-2 bg-blue-600 rounded-full\"></div>\n                  </div>\n                )}\n              </div>\n            </div>\n          ))}\n        </div>\n      </CardBody>\n    </Card>\n  );\n};\n","size_bytes":4169},"lib/wallet-alerts.ts":{"content":"import prisma from './prisma';\nimport { notifyLowWalletBalance } from './notifications';\n\nexport async function checkWalletBalance(userId: string): Promise<{\n  balance: number;\n  alertTriggered: boolean;\n  threshold: number;\n}> {\n  const wallet = await prisma.leadWallet.findUnique({\n    where: { userId },\n  });\n\n  if (!wallet) {\n    throw new Error('Wallet not found');\n  }\n\n  const alertTriggered = wallet.lowBalanceAlert && wallet.balance <= wallet.alertThreshold;\n\n  if (alertTriggered) {\n    await notifyLowWalletBalance(userId, wallet.balance, wallet.alertThreshold);\n\n    await prisma.auditLog.create({\n      data: {\n        userId,\n        action: 'LOW_BALANCE_ALERT',\n        entity: 'WALLET',\n        entityId: wallet.id,\n        changes: {\n          balance: wallet.balance,\n          threshold: wallet.alertThreshold,\n        },\n      },\n    });\n  }\n\n  return {\n    balance: wallet.balance,\n    alertTriggered,\n    threshold: wallet.alertThreshold,\n  };\n}\n\nexport async function updateWalletAlertSettings(\n  userId: string,\n  settings: {\n    lowBalanceAlert?: boolean;\n    alertThreshold?: number;\n  }\n): Promise<void> {\n  await prisma.leadWallet.update({\n    where: { userId },\n    data: settings,\n  });\n\n  await prisma.auditLog.create({\n    data: {\n      userId,\n      action: 'UPDATE_WALLET_ALERT_SETTINGS',\n      entity: 'WALLET',\n      entityId: userId,\n      changes: settings,\n    },\n  });\n}\n\nexport async function checkAllWallets(): Promise<void> {\n  const lowBalanceWallets = await prisma.leadWallet.findMany({\n    where: {\n      lowBalanceAlert: true,\n      balance: {\n        lte: prisma.leadWallet.fields.alertThreshold,\n      },\n    },\n    include: {\n      user: {\n        select: {\n          id: true,\n          email: true,\n          companyName: true,\n        },\n      },\n    },\n  });\n\n  for (const wallet of lowBalanceWallets) {\n    await notifyLowWalletBalance(\n      wallet.userId,\n      wallet.balance,\n      wallet.alertThreshold\n    );\n  }\n}\n","size_bytes":1977},"pages/partner/leads.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport { Layout } from '@/components/layout/Layout';\nimport { Card, CardHeader, CardBody, CardTitle } from '@/components/ui/Card';\nimport { CountdownTimer } from '@/components/CountdownTimer';\nimport Button from '@/components/ui/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport { useAuth } from '@/contexts/AuthContext';\n\ninterface Lead {\n  id: string;\n  quoteNumber: string;\n  cargoName: string;\n  quantity: number;\n  quantityUnit: string;\n  pickupCity: string;\n  pickupState: string;\n  deliveryCity: string;\n  deliveryState: string;\n  cargoReadyDate: string;\n  isHazardous: boolean;\n  hazardClass: string | null;\n  expiresAt: string;\n  status: string;\n  packagingType: string;\n}\n\nexport default function PartnerLeads() {\n  const { user, token } = useAuth();\n  const router = useRouter();\n  const [leads, setLeads] = useState<Lead[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [filter, setFilter] = useState<string>('all');\n\n  useEffect(() => {\n    if (token) {\n      fetchLeads();\n    }\n  }, [token, filter]);\n\n  const fetchLeads = async () => {\n    try {\n      const response = await fetch(`/api/quotes?status=${filter === 'all' ? '' : filter}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n\n      const data = await response.json();\n      if (response.ok) {\n        setLeads(data.quotes || []);\n      }\n    } catch (error) {\n      console.error('Error fetching leads:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSubmitOffer = (leadId: string) => {\n    router.push(`/partner/submit-offer?quoteId=${leadId}`);\n  };\n\n  if (!user || user.role !== 'LOGISTICS_PARTNER') {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">\n          <p className=\"text-gray-600\">Access denied. Partners only.</p>\n        </div>\n      </Layout>\n    );\n  }\n\n  return (\n    <Layout>\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h1 className=\"text-3xl font-bold text-gray-900\">Available Leads</h1>\n          <div className=\"flex items-center space-x-3\">\n            <select\n              value={filter}\n              onChange={(e) => setFilter(e.target.value)}\n              className=\"px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500\"\n            >\n              <option value=\"all\">All Leads</option>\n              <option value=\"MATCHING\">Active</option>\n              <option value=\"OFFERS_AVAILABLE\">With Offers</option>\n              <option value=\"EXPIRED\">Expired</option>\n            </select>\n          </div>\n        </div>\n\n        {loading ? (\n          <div className=\"text-center py-12\">\n            <div className=\"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n          </div>\n        ) : leads.length === 0 ? (\n          <Card>\n            <CardBody className=\"text-center py-12\">\n              <svg className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4\" />\n              </svg>\n              <p className=\"text-gray-600 mb-2\">No leads available at the moment</p>\n              <p className=\"text-sm text-gray-500\">New freight requests matching your capabilities will appear here</p>\n            </CardBody>\n          </Card>\n        ) : (\n          <div className=\"grid gap-4\">\n            {leads.map((lead) => (\n              <Card key={lead.id} className=\"hover:shadow-md transition-shadow\">\n                <CardBody>\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center space-x-3 mb-3\">\n                        <h3 className=\"text-xl font-semibold text-gray-900\">\n                          {lead.cargoName}\n                        </h3>\n                        {lead.isHazardous && (\n                          <Badge variant=\"danger\">\n                             Hazardous {lead.hazardClass}\n                          </Badge>\n                        )}\n                        <Badge variant={lead.status === 'MATCHING' ? 'success' : 'secondary'}>\n                          {lead.status}\n                        </Badge>\n                      </div>\n\n                      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4\">\n                        <div>\n                          <p className=\"text-sm text-gray-500\">Quote ID</p>\n                          <p className=\"font-medium text-gray-900\">{lead.quoteNumber}</p>\n                        </div>\n                        <div>\n                          <p className=\"text-sm text-gray-500\">Quantity</p>\n                          <p className=\"font-medium text-gray-900\">\n                            {lead.quantity} {lead.quantityUnit}\n                          </p>\n                        </div>\n                        <div>\n                          <p className=\"text-sm text-gray-500\">Packaging</p>\n                          <p className=\"font-medium text-gray-900\">{lead.packagingType}</p>\n                        </div>\n                        <div>\n                          <p className=\"text-sm text-gray-500\">Ready Date</p>\n                          <p className=\"font-medium text-gray-900\">\n                            {new Date(lead.cargoReadyDate).toLocaleDateString()}\n                          </p>\n                        </div>\n                      </div>\n\n                      <div className=\"flex items-center space-x-4 text-sm text-gray-600\">\n                        <div className=\"flex items-center space-x-1\">\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\n                          </svg>\n                          <span>{lead.pickupCity}, {lead.pickupState}</span>\n                        </div>\n                        <span></span>\n                        <div className=\"flex items-center space-x-1\">\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\n                          </svg>\n                          <span>{lead.deliveryCity}, {lead.deliveryState}</span>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"flex flex-col items-end space-y-3\">\n                      {lead.expiresAt && (\n                        <CountdownTimer expiresAt={lead.expiresAt} />\n                      )}\n                      <Button\n                        variant=\"primary\"\n                        onClick={() => handleSubmitOffer(lead.id)}\n                        disabled={lead.status === 'EXPIRED'}\n                      >\n                        Submit Offer\n                      </Button>\n                    </div>\n                  </div>\n                </CardBody>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n    </Layout>\n  );\n}\n","size_bytes":8016},"pages/trader/dashboard.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { Layout } from '@/components/layout/Layout';\nimport { Card, CardHeader, CardBody, CardTitle } from '@/components/ui/Card';\nimport { NotificationCenter } from '@/components/NotificationCenter';\nimport Button from '@/components/ui/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport Link from 'next/link';\nimport { useRouter } from 'next/router';\nimport { useAuth } from '@/contexts/AuthContext';\n\nexport default function TraderDashboard() {\n  const { user, token } = useAuth();\n  const router = useRouter();\n  const [quotes, setQuotes] = useState<any[]>([]);\n  const [stats, setStats] = useState({\n    active: 0,\n    withOffers: 0,\n    selected: 0,\n    total: 0,\n  });\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (token) {\n      fetchQuotes();\n    }\n  }, [token]);\n\n  const fetchQuotes = async () => {\n    try {\n      const response = await fetch('/api/quotes', {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n\n      const data = await response.json();\n      if (response.ok) {\n        const quotesList = data.quotes || [];\n        setQuotes(quotesList);\n        \n        setStats({\n          active: quotesList.filter((q: any) => q.status === 'MATCHING').length,\n          withOffers: quotesList.filter((q: any) => q.status === 'OFFERS_AVAILABLE').length,\n          selected: quotesList.filter((q: any) => q.status === 'SELECTED').length,\n          total: quotesList.length,\n        });\n      }\n    } catch (error) {\n      console.error('Error fetching quotes:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!user || user.role !== 'TRADER') {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">\n          <p className=\"text-gray-600\">Access denied. Traders only.</p>\n        </div>\n      </Layout>\n    );\n  }\n\n  return (\n    <Layout>\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900\">Trader Dashboard</h1>\n            <p className=\"text-gray-600 mt-1\">Welcome back, {user.companyName || user.email}</p>\n          </div>\n          <Link href=\"/quotes/new\">\n            <Button variant=\"primary\" className=\"flex items-center space-x-2\">\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n              </svg>\n              <span>New Freight Request</span>\n            </Button>\n          </Link>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6\">\n          <Card>\n            <CardBody className=\"text-center\">\n              <p className=\"text-sm text-gray-600 mb-1\">Active Quotes</p>\n              <p className=\"text-4xl font-bold text-blue-600\">{stats.active}</p>\n            </CardBody>\n          </Card>\n          <Card>\n            <CardBody className=\"text-center\">\n              <p className=\"text-sm text-gray-600 mb-1\">With Offers</p>\n              <p className=\"text-4xl font-bold text-green-600\">{stats.withOffers}</p>\n            </CardBody>\n          </Card>\n          <Card>\n            <CardBody className=\"text-center\">\n              <p className=\"text-sm text-gray-600 mb-1\">Selected</p>\n              <p className=\"text-4xl font-bold text-purple-600\">{stats.selected}</p>\n            </CardBody>\n          </Card>\n          <Card>\n            <CardBody className=\"text-center\">\n              <p className=\"text-sm text-gray-600 mb-1\">Total Quotes</p>\n              <p className=\"text-4xl font-bold text-gray-900\">{stats.total}</p>\n            </CardBody>\n          </Card>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          <div className=\"lg:col-span-2\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Recent Freight Requests</CardTitle>\n              </CardHeader>\n              <CardBody className=\"p-0\">\n                {loading ? (\n                  <div className=\"text-center py-12\">\n                    <div className=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n                  </div>\n                ) : quotes.length === 0 ? (\n                  <div className=\"text-center py-12\">\n                    <svg className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                    </svg>\n                    <p className=\"text-gray-600 mb-4\">No freight requests yet</p>\n                    <Link href=\"/quotes/new\">\n                      <Button variant=\"primary\">Create Your First Request</Button>\n                    </Link>\n                  </div>\n                ) : (\n                  <div className=\"divide-y divide-gray-200\">\n                    {quotes.slice(0, 5).map((quote) => (\n                      <div\n                        key={quote.id}\n                        className=\"p-4 hover:bg-gray-50 cursor-pointer transition-colors\"\n                        onClick={() => router.push(`/quotes/${quote.id}`)}\n                      >\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center space-x-2 mb-2\">\n                              <h4 className=\"font-semibold text-gray-900\">{quote.cargoName}</h4>\n                              <Badge variant={\n                                quote.status === 'SELECTED' ? 'success' :\n                                quote.status === 'OFFERS_AVAILABLE' ? 'primary' :\n                                quote.status === 'MATCHING' ? 'warning' :\n                                'secondary'\n                              }>\n                                {quote.status}\n                              </Badge>\n                            </div>\n                            <p className=\"text-sm text-gray-600\">\n                              {quote.pickupCity}  {quote.deliveryCity} | {quote.quantity} {quote.quantityUnit}\n                            </p>\n                            <p className=\"text-xs text-gray-500 mt-1\">\n                              {quote.quoteNumber} | {quote.offers?.length || 0} offers\n                            </p>\n                          </div>\n                          <div>\n                            <svg className=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                            </svg>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n                {quotes.length > 5 && (\n                  <div className=\"p-4 border-t\">\n                    <Link href=\"/quotes\">\n                      <Button variant=\"secondary\" className=\"w-full\">\n                        View All Requests\n                      </Button>\n                    </Link>\n                  </div>\n                )}\n              </CardBody>\n            </Card>\n          </div>\n\n          <div>\n            <NotificationCenter />\n          </div>\n        </div>\n      </div>\n    </Layout>\n  );\n}\n","size_bytes":7651},"lib/quote-timer.ts":{"content":"import prisma from './prisma';\nimport { QuoteStatus, OfferStatus } from '@prisma/client';\nimport { notifyOfferExpiringSoon } from './notifications';\n\nconst DEFAULT_QUOTE_TIMER_MINUTES = 60;\nconst WARNING_THRESHOLD_MINUTES = 10;\n\nexport interface QuoteTimerConfig {\n  quoteId: string;\n  timerDurationMinutes?: number;\n  enableWarnings?: boolean;\n}\n\nexport async function startQuoteTimer(config: QuoteTimerConfig): Promise<Date> {\n  const {\n    quoteId,\n    timerDurationMinutes = DEFAULT_QUOTE_TIMER_MINUTES,\n    enableWarnings = true,\n  } = config;\n\n  const expiresAt = new Date();\n  expiresAt.setMinutes(expiresAt.getMinutes() + timerDurationMinutes);\n\n  await prisma.quote.update({\n    where: { id: quoteId },\n    data: {\n      expiresAt,\n      status: QuoteStatus.MATCHING,\n    },\n  });\n\n  if (enableWarnings) {\n    const warningTime = new Date();\n    warningTime.setMinutes(\n      warningTime.getMinutes() + timerDurationMinutes - WARNING_THRESHOLD_MINUTES\n    );\n\n    scheduleExpiryWarning(quoteId, warningTime);\n  }\n\n  scheduleQuoteExpiry(quoteId, expiresAt);\n\n  await prisma.auditLog.create({\n    data: {\n      quoteId,\n      action: 'QUOTE_TIMER_STARTED',\n      entity: 'QUOTE',\n      entityId: quoteId,\n      changes: {\n        timerDurationMinutes,\n        expiresAt,\n      },\n    },\n  });\n\n  return expiresAt;\n}\n\nexport async function extendQuoteTimer(\n  quoteId: string,\n  additionalMinutes: number\n): Promise<Date> {\n  const quote = await prisma.quote.findUnique({\n    where: { id: quoteId },\n  });\n\n  if (!quote) {\n    throw new Error('Quote not found');\n  }\n\n  if (!quote.expiresAt) {\n    throw new Error('Quote does not have an expiry time');\n  }\n\n  const newExpiresAt = new Date(quote.expiresAt);\n  newExpiresAt.setMinutes(newExpiresAt.getMinutes() + additionalMinutes);\n\n  await prisma.quote.update({\n    where: { id: quoteId },\n    data: {\n      expiresAt: newExpiresAt,\n    },\n  });\n\n  await prisma.auditLog.create({\n    data: {\n      quoteId,\n      action: 'QUOTE_TIMER_EXTENDED',\n      entity: 'QUOTE',\n      entityId: quoteId,\n      changes: {\n        additionalMinutes,\n        newExpiresAt,\n      },\n    },\n  });\n\n  return newExpiresAt;\n}\n\nexport async function getRemainingTime(quoteId: string): Promise<{\n  expiresAt: Date;\n  remainingMinutes: number;\n  hasExpired: boolean;\n}> {\n  const quote = await prisma.quote.findUnique({\n    where: { id: quoteId },\n    select: { expiresAt: true },\n  });\n\n  if (!quote?.expiresAt) {\n    throw new Error('Quote does not have an expiry time');\n  }\n\n  const now = new Date();\n  const remainingMs = quote.expiresAt.getTime() - now.getTime();\n  const remainingMinutes = Math.floor(remainingMs / (1000 * 60));\n\n  return {\n    expiresAt: quote.expiresAt,\n    remainingMinutes: Math.max(0, remainingMinutes),\n    hasExpired: remainingMs <= 0,\n  };\n}\n\nasync function scheduleExpiryWarning(\n  quoteId: string,\n  warningTime: Date\n): Promise<void> {\n  const delay = warningTime.getTime() - Date.now();\n\n  if (delay > 0) {\n    setTimeout(async () => {\n      try {\n        const quote = await prisma.quote.findUnique({\n          where: { id: quoteId },\n          select: {\n            id: true,\n            expiresAt: true,\n            status: true,\n          },\n        });\n\n        if (!quote || quote.status === QuoteStatus.EXPIRED) {\n          return;\n        }\n\n        const offers = await prisma.offer.findMany({\n          where: {\n            quoteId,\n            status: OfferStatus.PENDING,\n          },\n          select: {\n            partnerId: true,\n          },\n        });\n\n        const partners = await prisma.quote.findUnique({\n          where: { id: quoteId },\n          select: {\n            offers: {\n              select: {\n                partnerId: true,\n              },\n            },\n          },\n        });\n\n        if (partners?.offers) {\n          for (const offer of partners.offers) {\n            await notifyOfferExpiringSoon(\n              quoteId,\n              offer.partnerId,\n              quote.expiresAt!\n            );\n          }\n        }\n      } catch (error) {\n        console.error('Error sending expiry warning:', error);\n      }\n    }, delay);\n  }\n}\n\nasync function scheduleQuoteExpiry(\n  quoteId: string,\n  expiresAt: Date\n): Promise<void> {\n  const delay = expiresAt.getTime() - Date.now();\n\n  if (delay > 0) {\n    setTimeout(async () => {\n      try {\n        await expireQuote(quoteId);\n      } catch (error) {\n        console.error('Error expiring quote:', error);\n      }\n    }, delay);\n  }\n}\n\nexport async function expireQuote(quoteId: string): Promise<void> {\n  const quote = await prisma.quote.findUnique({\n    where: { id: quoteId },\n    select: {\n      id: true,\n      status: true,\n      expiresAt: true,\n    },\n  });\n\n  if (!quote) {\n    return;\n  }\n\n  if (quote.status === QuoteStatus.SELECTED || quote.status === QuoteStatus.CANCELLED) {\n    return;\n  }\n\n  await prisma.quote.update({\n    where: { id: quoteId },\n    data: {\n      status: QuoteStatus.EXPIRED,\n    },\n  });\n\n  await prisma.offer.updateMany({\n    where: {\n      quoteId,\n      status: OfferStatus.PENDING,\n    },\n    data: {\n      status: OfferStatus.EXPIRED,\n    },\n  });\n\n  await prisma.auditLog.create({\n    data: {\n      quoteId,\n      action: 'QUOTE_EXPIRED',\n      entity: 'QUOTE',\n      entityId: quoteId,\n      changes: {\n        expiresAt: quote.expiresAt,\n      },\n    },\n  });\n}\n\nexport async function checkExpiredQuotes(): Promise<void> {\n  const expiredQuotes = await prisma.quote.findMany({\n    where: {\n      expiresAt: {\n        lte: new Date(),\n      },\n      status: {\n        in: [QuoteStatus.MATCHING, QuoteStatus.OFFERS_AVAILABLE],\n      },\n    },\n  });\n\n  for (const quote of expiredQuotes) {\n    await expireQuote(quote.id);\n  }\n}\n","size_bytes":5736},"lib/notifications.ts":{"content":"import prisma from './prisma';\n\nexport interface NotificationOptions {\n  userId: string;\n  title: string;\n  message: string;\n  type: 'EMAIL' | 'SMS' | 'WHATSAPP' | 'PORTAL';\n  priority?: 'LOW' | 'MEDIUM' | 'HIGH' | 'URGENT';\n  data?: any;\n}\n\nexport interface MultiChannelNotificationOptions {\n  userId: string;\n  title: string;\n  message: string;\n  channels: ('EMAIL' | 'SMS' | 'WHATSAPP' | 'PORTAL')[];\n  priority?: 'LOW' | 'MEDIUM' | 'HIGH' | 'URGENT';\n  data?: any;\n}\n\nexport async function sendMultiChannelNotification(\n  options: MultiChannelNotificationOptions\n): Promise<void> {\n  const { userId, title, message, channels, priority = 'MEDIUM', data } = options;\n\n  const user = await prisma.user.findUnique({\n    where: { id: userId },\n    select: { email: true, phone: true, companyName: true },\n  });\n\n  if (!user) {\n    throw new Error('User not found');\n  }\n\n  const notificationPromises = channels.map((channel) =>\n    sendNotification({\n      userId,\n      title,\n      message,\n      type: channel,\n      priority,\n      data,\n    })\n  );\n\n  await Promise.allSettled(notificationPromises);\n}\n\nexport async function sendNotification(\n  options: NotificationOptions\n): Promise<void> {\n  const { userId, title, message, type, priority = 'MEDIUM', data } = options;\n\n  switch (type) {\n    case 'EMAIL':\n      await sendEmailNotification(userId, title, message, data);\n      break;\n    case 'SMS':\n      await sendSMSNotification(userId, message, data);\n      break;\n    case 'WHATSAPP':\n      await sendWhatsAppNotification(userId, message, data);\n      break;\n    case 'PORTAL':\n      await createPortalNotification(userId, title, message, priority, data);\n      break;\n  }\n\n  await prisma.auditLog.create({\n    data: {\n      userId,\n      action: 'NOTIFICATION_SENT',\n      entity: 'NOTIFICATION',\n      entityId: userId,\n      changes: {\n        type,\n        title,\n        priority,\n      },\n    },\n  });\n}\n\nasync function sendEmailNotification(\n  userId: string,\n  title: string,\n  message: string,\n  data?: any\n): Promise<void> {\n  const user = await prisma.user.findUnique({\n    where: { id: userId },\n    select: { email: true, companyName: true },\n  });\n\n  if (!user?.email) {\n    console.error('User email not found');\n    return;\n  }\n\n  console.log(`[EMAIL] To: ${user.email}`);\n  console.log(`[EMAIL] Subject: ${title}`);\n  console.log(`[EMAIL] Message: ${message}`);\n  console.log(`[EMAIL] Data:`, data);\n}\n\nasync function sendSMSNotification(\n  userId: string,\n  message: string,\n  data?: any\n): Promise<void> {\n  const user = await prisma.user.findUnique({\n    where: { id: userId },\n    select: { phone: true },\n  });\n\n  if (!user?.phone) {\n    console.error('User phone not found');\n    return;\n  }\n\n  console.log(`[SMS] To: ${user.phone}`);\n  console.log(`[SMS] Message: ${message}`);\n  console.log(`[SMS] Data:`, data);\n}\n\nasync function sendWhatsAppNotification(\n  userId: string,\n  message: string,\n  data?: any\n): Promise<void> {\n  const user = await prisma.user.findUnique({\n    where: { id: userId },\n    select: { phone: true },\n  });\n\n  if (!user?.phone) {\n    console.error('User phone not found');\n    return;\n  }\n\n  console.log(`[WHATSAPP] To: ${user.phone}`);\n  console.log(`[WHATSAPP] Message: ${message}`);\n  console.log(`[WHATSAPP] Data:`, data);\n}\n\nasync function createPortalNotification(\n  userId: string,\n  title: string,\n  message: string,\n  priority: string,\n  data?: any\n): Promise<void> {\n  console.log(`[PORTAL] User: ${userId}`);\n  console.log(`[PORTAL] Title: ${title}`);\n  console.log(`[PORTAL] Message: ${message}`);\n  console.log(`[PORTAL] Priority: ${priority}`);\n  console.log(`[PORTAL] Data:`, data);\n}\n\nexport async function notifyPartnerAboutNewLead(\n  partnerId: string,\n  quoteId: string,\n  quoteDetails: any\n): Promise<void> {\n  const quote = await prisma.quote.findUnique({\n    where: { id: quoteId },\n    include: {\n      trader: {\n        select: {\n          companyName: true,\n        },\n      },\n    },\n  });\n\n  if (!quote) {\n    throw new Error('Quote not found');\n  }\n\n  const message = `New freight lead available! ${quote.cargoName} from ${quote.pickupCity} to ${quote.deliveryCity}. Quantity: ${quote.quantity} ${quote.quantityUnit}. Ready: ${new Date(quote.cargoReadyDate).toLocaleDateString()}`;\n\n  await sendMultiChannelNotification({\n    userId: partnerId,\n    title: ' New Lead Available',\n    message,\n    channels: ['EMAIL', 'SMS', 'WHATSAPP', 'PORTAL'],\n    priority: 'HIGH',\n    data: {\n      quoteId: quote.id,\n      quoteNumber: quote.quoteNumber,\n      cargoName: quote.cargoName,\n      pickupCity: quote.pickupCity,\n      deliveryCity: quote.deliveryCity,\n      quantity: quote.quantity,\n      quantityUnit: quote.quantityUnit,\n      cargoReadyDate: quote.cargoReadyDate,\n      isHazardous: quote.isHazardous,\n    },\n  });\n}\n\nexport async function notifyLowWalletBalance(\n  partnerId: string,\n  currentBalance: number,\n  threshold: number\n): Promise<void> {\n  const message = ` Low wallet balance alert! Your current balance is ${currentBalance}. Please recharge to continue receiving leads.`;\n\n  await sendMultiChannelNotification({\n    userId: partnerId,\n    title: 'Low Wallet Balance Alert',\n    message,\n    channels: ['EMAIL', 'SMS', 'PORTAL'],\n    priority: 'URGENT',\n    data: {\n      currentBalance,\n      threshold,\n      recommendedRecharge: threshold * 2,\n    },\n  });\n}\n\nexport async function notifyOfferExpiringSoon(\n  quoteId: string,\n  partnerId: string,\n  expiresAt: Date\n): Promise<void> {\n  const minutesRemaining = Math.floor(\n    (expiresAt.getTime() - Date.now()) / (1000 * 60)\n  );\n\n  const message = ` Quote submission deadline approaching! Only ${minutesRemaining} minutes remaining to submit your offer.`;\n\n  await sendMultiChannelNotification({\n    userId: partnerId,\n    title: 'Quote Deadline Alert',\n    message,\n    channels: ['SMS', 'PORTAL'],\n    priority: 'HIGH',\n    data: {\n      quoteId,\n      expiresAt,\n      minutesRemaining,\n    },\n  });\n}\n","size_bytes":5986},"lib/file-encryption.ts":{"content":"import crypto from 'crypto';\nimport fs from 'fs';\nimport path from 'path';\n\nconst ALGORITHM = 'aes-256-gcm';\nconst KEY_LENGTH = 32;\nconst IV_LENGTH = 16;\nconst AUTH_TAG_LENGTH = 16;\n\nexport function generateEncryptionKey(): string {\n  return crypto.randomBytes(KEY_LENGTH).toString('base64');\n}\n\nexport async function encryptFile(\n  filePath: string,\n  encryptionKey?: string\n): Promise<{\n  encryptedPath: string;\n  encryptionKey: string;\n  originalFileName: string;\n}> {\n  const key = encryptionKey\n    ? Buffer.from(encryptionKey, 'base64')\n    : crypto.randomBytes(KEY_LENGTH);\n\n  const iv = crypto.randomBytes(IV_LENGTH);\n\n  const cipher = crypto.createCipheriv(ALGORITHM, key, iv);\n\n  const fileContent = await fs.promises.readFile(filePath);\n\n  const encrypted = Buffer.concat([\n    cipher.update(fileContent),\n    cipher.final(),\n  ]);\n\n  const authTag = cipher.getAuthTag();\n\n  const encryptedContent = Buffer.concat([\n    iv,\n    authTag,\n    encrypted,\n  ]);\n\n  const encryptedFileName = `${crypto.randomBytes(16).toString('hex')}.enc`;\n  const uploadsDir = path.join(process.cwd(), 'uploads', 'encrypted');\n\n  await fs.promises.mkdir(uploadsDir, { recursive: true });\n\n  const encryptedPath = path.join(uploadsDir, encryptedFileName);\n\n  await fs.promises.writeFile(encryptedPath, encryptedContent);\n\n  return {\n    encryptedPath,\n    encryptionKey: key.toString('base64'),\n    originalFileName: path.basename(filePath),\n  };\n}\n\nexport async function decryptFile(\n  encryptedPath: string,\n  encryptionKey: string,\n  outputPath?: string\n): Promise<Buffer> {\n  const key = Buffer.from(encryptionKey, 'base64');\n\n  const encryptedContent = await fs.promises.readFile(encryptedPath);\n\n  const iv = encryptedContent.subarray(0, IV_LENGTH);\n  const authTag = encryptedContent.subarray(IV_LENGTH, IV_LENGTH + AUTH_TAG_LENGTH);\n  const encrypted = encryptedContent.subarray(IV_LENGTH + AUTH_TAG_LENGTH);\n\n  const decipher = crypto.createDecipheriv(ALGORITHM, key, iv);\n  decipher.setAuthTag(authTag);\n\n  const decrypted = Buffer.concat([\n    decipher.update(encrypted),\n    decipher.final(),\n  ]);\n\n  if (outputPath) {\n    await fs.promises.writeFile(outputPath, decrypted);\n  }\n\n  return decrypted;\n}\n\nexport async function encryptBuffer(\n  buffer: Buffer,\n  encryptionKey?: string\n): Promise<{\n  encrypted: Buffer;\n  encryptionKey: string;\n}> {\n  const key = encryptionKey\n    ? Buffer.from(encryptionKey, 'base64')\n    : crypto.randomBytes(KEY_LENGTH);\n\n  const iv = crypto.randomBytes(IV_LENGTH);\n\n  const cipher = crypto.createCipheriv(ALGORITHM, key, iv);\n\n  const encrypted = Buffer.concat([\n    cipher.update(buffer),\n    cipher.final(),\n  ]);\n\n  const authTag = cipher.getAuthTag();\n\n  const encryptedContent = Buffer.concat([\n    iv,\n    authTag,\n    encrypted,\n  ]);\n\n  return {\n    encrypted: encryptedContent,\n    encryptionKey: key.toString('base64'),\n  };\n}\n\nexport async function decryptBuffer(\n  encryptedBuffer: Buffer,\n  encryptionKey: string\n): Promise<Buffer> {\n  const key = Buffer.from(encryptionKey, 'base64');\n\n  const iv = encryptedBuffer.subarray(0, IV_LENGTH);\n  const authTag = encryptedBuffer.subarray(IV_LENGTH, IV_LENGTH + AUTH_TAG_LENGTH);\n  const encrypted = encryptedBuffer.subarray(IV_LENGTH + AUTH_TAG_LENGTH);\n\n  const decipher = crypto.createDecipheriv(ALGORITHM, key, iv);\n  decipher.setAuthTag(authTag);\n\n  const decrypted = Buffer.concat([\n    decipher.update(encrypted),\n    decipher.final(),\n  ]);\n\n  return decrypted;\n}\n\nexport function validateEncryptionKey(key: string): boolean {\n  try {\n    const buffer = Buffer.from(key, 'base64');\n    return buffer.length === KEY_LENGTH;\n  } catch {\n    return false;\n  }\n}\n\nexport async function secureDeleteFile(filePath: string): Promise<void> {\n  const stats = await fs.promises.stat(filePath);\n  const fileSize = stats.size;\n\n  const randomData = crypto.randomBytes(fileSize);\n  await fs.promises.writeFile(filePath, randomData);\n\n  await fs.promises.unlink(filePath);\n}\n","size_bytes":3965},"components/DocumentUpload.tsx":{"content":"import React, { useState } from 'react';\nimport Button from '@/components/ui/Button';\nimport { Alert } from '@/components/ui/Alert';\n\ninterface DocumentUploadProps {\n  quoteId: string;\n  token: string;\n  onUploadComplete?: (documentId: string) => void;\n}\n\nexport const DocumentUpload: React.FC<DocumentUploadProps> = ({\n  quoteId,\n  token,\n  onUploadComplete,\n}) => {\n  const [file, setFile] = useState<File | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState(false);\n  const [documentType, setDocumentType] = useState('MSDS');\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files[0]) {\n      setFile(e.target.files[0]);\n      setError(null);\n      setSuccess(false);\n    }\n  };\n\n  const handleUpload = async () => {\n    if (!file) {\n      setError('Please select a file to upload');\n      return;\n    }\n\n    setUploading(true);\n    setError(null);\n\n    try {\n      const formData = new FormData();\n      formData.append('file', file);\n      formData.append('quoteId', quoteId);\n      formData.append('documentType', documentType);\n\n      const response = await fetch('/api/documents/upload', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n        body: formData,\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Upload failed');\n      }\n\n      setSuccess(true);\n      setFile(null);\n      if (onUploadComplete) {\n        onUploadComplete(data.document.id);\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Upload failed');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\n      <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n        Upload Safety Document\n      </h3>\n      \n      {error && (\n        <Alert variant=\"error\" className=\"mb-4\">\n          {error}\n        </Alert>\n      )}\n      \n      {success && (\n        <Alert variant=\"success\" className=\"mb-4\">\n          Document uploaded and encrypted successfully! \n        </Alert>\n      )}\n\n      <div className=\"space-y-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n            Document Type\n          </label>\n          <select\n            value={documentType}\n            onChange={(e) => setDocumentType(e.target.value)}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500\"\n          >\n            <option value=\"MSDS\">MSDS (Material Safety Data Sheet)</option>\n            <option value=\"SDS\">SDS (Safety Data Sheet)</option>\n            <option value=\"COA\">COA (Certificate of Analysis)</option>\n            <option value=\"OTHER\">Other Safety Document</option>\n          </select>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n            Select File\n          </label>\n          <input\n            type=\"file\"\n            onChange={handleFileChange}\n            accept=\".pdf,.doc,.docx\"\n            className=\"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\"\n          />\n          {file && (\n            <p className=\"mt-2 text-sm text-gray-600\">\n              Selected: {file.name} ({(file.size / 1024).toFixed(2)} KB)\n            </p>\n          )}\n        </div>\n\n        <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n          <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\n          </svg>\n          <span>Files are encrypted with AES-256-GCM before storage</span>\n        </div>\n\n        <Button\n          onClick={handleUpload}\n          disabled={!file || uploading}\n          variant=\"primary\"\n          className=\"w-full\"\n        >\n          {uploading ? 'Uploading & Encrypting...' : 'Upload Document'}\n        </Button>\n      </div>\n    </div>\n  );\n};\n","size_bytes":4423},"pages/partner/wallet.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { Layout } from '@/components/layout/Layout';\nimport { Card, CardHeader, CardBody, CardTitle } from '@/components/ui/Card';\nimport Button from '@/components/ui/Button';\nimport { Alert } from '@/components/ui/Alert';\nimport { useAuth } from '@/contexts/AuthContext';\n\ninterface WalletData {\n  balance: number;\n  currency: string;\n  lowBalanceAlert: boolean;\n  alertThreshold: number;\n  transactions: Transaction[];\n}\n\ninterface Transaction {\n  id: string;\n  transactionType: string;\n  amount: number;\n  description: string;\n  transactionDate: string;\n  leadId?: string;\n}\n\nexport default function PartnerWallet() {\n  const { user, token } = useAuth();\n  const [wallet, setWallet] = useState<WalletData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [rechargeAmount, setRechargeAmount] = useState('');\n  const [alertThreshold, setAlertThreshold] = useState('');\n  const [lowBalanceAlert, setLowBalanceAlert] = useState(true);\n  const [showRechargeModal, setShowRechargeModal] = useState(false);\n  const [processing, setProcessing] = useState(false);\n\n  useEffect(() => {\n    if (token) {\n      fetchWallet();\n    }\n  }, [token]);\n\n  const fetchWallet = async () => {\n    try {\n      const response = await fetch('/api/wallet', {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n\n      const data = await response.json();\n      if (response.ok) {\n        setWallet(data.wallet);\n        setAlertThreshold(data.wallet.alertThreshold.toString());\n        setLowBalanceAlert(data.wallet.lowBalanceAlert);\n      }\n    } catch (error) {\n      console.error('Error fetching wallet:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRecharge = async () => {\n    const amount = parseFloat(rechargeAmount);\n    if (isNaN(amount) || amount <= 0) {\n      alert('Please enter a valid amount');\n      return;\n    }\n\n    setProcessing(true);\n    try {\n      const response = await fetch('/api/wallet', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        body: JSON.stringify({ amount, paymentMethod: 'Online' }),\n      });\n\n      if (response.ok) {\n        setRechargeAmount('');\n        setShowRechargeModal(false);\n        fetchWallet();\n      } else {\n        const data = await response.json();\n        alert(data.error || 'Recharge failed');\n      }\n    } catch (error) {\n      alert('Recharge failed');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const handleUpdateSettings = async () => {\n    const threshold = parseFloat(alertThreshold);\n    if (isNaN(threshold) || threshold < 0) {\n      alert('Please enter a valid threshold');\n      return;\n    }\n\n    setProcessing(true);\n    try {\n      const response = await fetch('/api/wallet/settings', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        body: JSON.stringify({\n          lowBalanceAlert,\n          alertThreshold: threshold,\n        }),\n      });\n\n      if (response.ok) {\n        alert('Settings updated successfully');\n        fetchWallet();\n      } else {\n        const data = await response.json();\n        alert(data.error || 'Update failed');\n      }\n    } catch (error) {\n      alert('Update failed');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  if (!user || user.role !== 'LOGISTICS_PARTNER') {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">\n          <p className=\"text-gray-600\">Access denied. Partners only.</p>\n        </div>\n      </Layout>\n    );\n  }\n\n  if (loading) {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">\n          <div className=\"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n        </div>\n      </Layout>\n    );\n  }\n\n  const isLowBalance = wallet && wallet.lowBalanceAlert && wallet.balance <= wallet.alertThreshold;\n\n  return (\n    <Layout>\n      <div className=\"max-w-6xl mx-auto\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">Lead Wallet</h1>\n\n        {isLowBalance && (\n          <Alert variant=\"warning\" className=\"mb-6\">\n             Low balance alert! Your current balance ({wallet?.balance.toLocaleString()}) is below your threshold ({wallet?.alertThreshold.toLocaleString()}). Please recharge to continue receiving leads.\n          </Alert>\n        )}\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6\">\n          <Card className=\"lg:col-span-2\">\n            <CardHeader>\n              <CardTitle>Current Balance</CardTitle>\n            </CardHeader>\n            <CardBody>\n              <div className=\"text-center py-6\">\n                <p className=\"text-5xl font-bold text-blue-600 mb-2\">\n                  {wallet?.balance.toLocaleString() || '0'}\n                </p>\n                <p className=\"text-gray-600\">Available Credits</p>\n                <Button\n                  variant=\"primary\"\n                  className=\"mt-6\"\n                  onClick={() => setShowRechargeModal(true)}\n                >\n                  Recharge Wallet\n                </Button>\n              </div>\n            </CardBody>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Alert Settings</CardTitle>\n            </CardHeader>\n            <CardBody>\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center\">\n                  <input\n                    type=\"checkbox\"\n                    id=\"lowBalanceAlert\"\n                    checked={lowBalanceAlert}\n                    onChange={(e) => setLowBalanceAlert(e.target.checked)}\n                    className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                  />\n                  <label htmlFor=\"lowBalanceAlert\" className=\"ml-2 text-sm text-gray-700\">\n                    Low balance alerts\n                  </label>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Alert Threshold ()\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={alertThreshold}\n                    onChange={(e) => setAlertThreshold(e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500\"\n                    min=\"0\"\n                    step=\"100\"\n                  />\n                </div>\n\n                <Button\n                  variant=\"secondary\"\n                  onClick={handleUpdateSettings}\n                  disabled={processing}\n                  className=\"w-full\"\n                >\n                  Update Settings\n                </Button>\n              </div>\n            </CardBody>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Transaction History</CardTitle>\n          </CardHeader>\n          <CardBody className=\"p-0\">\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Date\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Type\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Description\n                    </th>\n                    <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Amount\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {wallet?.transactions?.map((transaction) => (\n                    <tr key={transaction.id}>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                        {new Date(transaction.transactionDate).toLocaleDateString()}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <span className={`px-2 py-1 text-xs font-semibold rounded ${\n                          transaction.transactionType === 'RECHARGE'\n                            ? 'bg-green-100 text-green-800'\n                            : transaction.transactionType === 'DEBIT'\n                            ? 'bg-red-100 text-red-800'\n                            : 'bg-blue-100 text-blue-800'\n                        }`}>\n                          {transaction.transactionType}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-4 text-sm text-gray-600\">\n                        {transaction.description}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-right\">\n                        <span className={transaction.transactionType === 'RECHARGE' ? 'text-green-600' : 'text-red-600'}>\n                          {transaction.transactionType === 'RECHARGE' ? '+' : '-'}{transaction.amount.toLocaleString()}\n                        </span>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </CardBody>\n        </Card>\n\n        {showRechargeModal && (\n          <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n            <Card className=\"w-full max-w-md mx-4\">\n              <CardHeader>\n                <CardTitle>Recharge Wallet</CardTitle>\n              </CardHeader>\n              <CardBody>\n                <div className=\"space-y-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Recharge Amount ()\n                    </label>\n                    <input\n                      type=\"number\"\n                      value={rechargeAmount}\n                      onChange={(e) => setRechargeAmount(e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500\"\n                      min=\"0\"\n                      step=\"100\"\n                      placeholder=\"Enter amount\"\n                    />\n                  </div>\n\n                  <div className=\"grid grid-cols-3 gap-2\">\n                    {[1000, 5000, 10000].map((amount) => (\n                      <button\n                        key={amount}\n                        onClick={() => setRechargeAmount(amount.toString())}\n                        className=\"px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50 text-sm font-medium\"\n                      >\n                        {amount.toLocaleString()}\n                      </button>\n                    ))}\n                  </div>\n\n                  <div className=\"flex space-x-3\">\n                    <Button\n                      variant=\"secondary\"\n                      onClick={() => setShowRechargeModal(false)}\n                      className=\"flex-1\"\n                    >\n                      Cancel\n                    </Button>\n                    <Button\n                      variant=\"primary\"\n                      onClick={handleRecharge}\n                      disabled={processing || !rechargeAmount}\n                      className=\"flex-1\"\n                    >\n                      {processing ? 'Processing...' : 'Recharge'}\n                    </Button>\n                  </div>\n                </div>\n              </CardBody>\n            </Card>\n          </div>\n        )}\n      </div>\n    </Layout>\n  );\n}\n","size_bytes":12147},"pages/trader/offers.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport { Layout } from '@/components/layout/Layout';\nimport { Card, CardHeader, CardBody, CardTitle } from '@/components/ui/Card';\nimport Button from '@/components/ui/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport { useAuth } from '@/contexts/AuthContext';\n\ninterface Offer {\n  id: string;\n  price: number;\n  transitDays: number;\n  offerValidUntil: string;\n  pickupAvailableFrom: string;\n  insuranceIncluded: boolean;\n  trackingIncluded: boolean;\n  customsClearance: boolean;\n  valueAddedServices: string[];\n  partner: {\n    companyName: string;\n    email: string;\n  };\n  quote: {\n    quoteNumber: string;\n    cargoName: string;\n    pickupCity: string;\n    deliveryCity: string;\n  };\n  status: string;\n  submittedAt: string;\n}\n\nexport default function TraderOffers() {\n  const { user, token } = useAuth();\n  const router = useRouter();\n  const { quoteId } = router.query;\n  const [offers, setOffers] = useState<Offer[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [sortBy, setSortBy] = useState<'price' | 'transitDays'>('price');\n\n  useEffect(() => {\n    if (token && quoteId) {\n      fetchOffers();\n    }\n  }, [token, quoteId]);\n\n  const fetchOffers = async () => {\n    try {\n      const response = await fetch(`/api/offers?quoteId=${quoteId}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n\n      const data = await response.json();\n      if (response.ok) {\n        setOffers(data.offers || []);\n      }\n    } catch (error) {\n      console.error('Error fetching offers:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSelectOffer = async (offerId: string) => {\n    if (!confirm('Are you sure you want to select this offer? This action cannot be undone.')) {\n      return;\n    }\n\n    try {\n      const response = await fetch(`/api/offers/${offerId}/select`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Failed to select offer');\n      }\n\n      alert('Offer selected successfully! The partner will be notified.');\n      router.push(`/quotes/${quoteId}`);\n    } catch (error) {\n      alert(error instanceof Error ? error.message : 'Failed to select offer');\n    }\n  };\n\n  const sortedOffers = [...offers].sort((a, b) => {\n    if (sortBy === 'price') {\n      return a.price - b.price;\n    }\n    return a.transitDays - b.transitDays;\n  });\n\n  if (!user || user.role !== 'TRADER') {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">\n          <p className=\"text-gray-600\">Access denied. Traders only.</p>\n        </div>\n      </Layout>\n    );\n  }\n\n  if (loading) {\n    return (\n      <Layout>\n        <div className=\"text-center py-12\">\n          <div className=\"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n        </div>\n      </Layout>\n    );\n  }\n\n  const selectedOffer = offers.find(o => o.status === 'ACCEPTED');\n\n  return (\n    <Layout>\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900\">Compare Offers</h1>\n            {offers.length > 0 && offers[0].quote && (\n              <p className=\"text-gray-600 mt-1\">\n                For: {offers[0].quote.cargoName} ({offers[0].quote.quoteNumber})\n              </p>\n            )}\n          </div>\n          \n          <div className=\"flex items-center space-x-3\">\n            <label className=\"text-sm font-medium text-gray-700\">Sort by:</label>\n            <select\n              value={sortBy}\n              onChange={(e) => setSortBy(e.target.value as 'price' | 'transitDays')}\n              className=\"px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500\"\n            >\n              <option value=\"price\">Lowest Price</option>\n              <option value=\"transitDays\">Fastest Delivery</option>\n            </select>\n          </div>\n        </div>\n\n        {selectedOffer && (\n          <Card className=\"mb-6 border-2 border-green-500\">\n            <CardBody>\n              <div className=\"flex items-center space-x-2 mb-2\">\n                <svg className=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n                <span className=\"text-lg font-semibold text-green-700\">Selected Offer</span>\n              </div>\n              <p className=\"text-gray-600\">\n                Partner: <strong>{selectedOffer.partner.companyName}</strong> | \n                Price: <strong>{selectedOffer.price.toLocaleString()}</strong> | \n                Transit: <strong>{selectedOffer.transitDays} days</strong>\n              </p>\n            </CardBody>\n          </Card>\n        )}\n\n        {offers.length === 0 ? (\n          <Card>\n            <CardBody className=\"text-center py-12\">\n              <svg className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n              </svg>\n              <p className=\"text-gray-600 mb-2\">No offers received yet</p>\n              <p className=\"text-sm text-gray-500\">Partners are reviewing your freight request</p>\n            </CardBody>\n          </Card>\n        ) : (\n          <div className=\"grid gap-4\">\n            {sortedOffers.map((offer, index) => (\n              <Card key={offer.id} className={`${index === 0 && !selectedOffer ? 'border-blue-500 border-2' : ''}`}>\n                <CardBody>\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center space-x-3 mb-3\">\n                        <h3 className=\"text-xl font-semibold text-gray-900\">\n                          {offer.partner.companyName}\n                        </h3>\n                        {index === 0 && !selectedOffer && (\n                          <Badge variant=\"success\">Best Value</Badge>\n                        )}\n                        {offer.status === 'ACCEPTED' && (\n                          <Badge variant=\"success\">Selected</Badge>\n                        )}\n                      </div>\n\n                      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4\">\n                        <div>\n                          <p className=\"text-sm text-gray-500\">Price</p>\n                          <p className=\"text-2xl font-bold text-blue-600\">\n                            {offer.price.toLocaleString()}\n                          </p>\n                        </div>\n                        <div>\n                          <p className=\"text-sm text-gray-500\">Transit Time</p>\n                          <p className=\"text-lg font-semibold text-gray-900\">\n                            {offer.transitDays} days\n                          </p>\n                        </div>\n                        <div>\n                          <p className=\"text-sm text-gray-500\">Pickup From</p>\n                          <p className=\"font-medium text-gray-900\">\n                            {new Date(offer.pickupAvailableFrom).toLocaleDateString()}\n                          </p>\n                        </div>\n                        <div>\n                          <p className=\"text-sm text-gray-500\">Valid Until</p>\n                          <p className=\"font-medium text-gray-900\">\n                            {new Date(offer.offerValidUntil).toLocaleDateString()}\n                          </p>\n                        </div>\n                      </div>\n\n                      <div className=\"flex flex-wrap gap-2 mb-3\">\n                        {offer.insuranceIncluded && (\n                          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n                             Insurance\n                          </span>\n                        )}\n                        {offer.trackingIncluded && (\n                          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\n                             Tracking\n                          </span>\n                        )}\n                        {offer.customsClearance && (\n                          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800\">\n                             Customs\n                          </span>\n                        )}\n                        {offer.valueAddedServices?.map((service, idx) => (\n                          <span\n                            key={idx}\n                            className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800\"\n                          >\n                            {service}\n                          </span>\n                        ))}\n                      </div>\n\n                      <p className=\"text-xs text-gray-500\">\n                        Submitted: {new Date(offer.submittedAt).toLocaleString()}\n                      </p>\n                    </div>\n\n                    <div className=\"ml-4\">\n                      {!selectedOffer && offer.status === 'PENDING' && (\n                        <Button\n                          variant=\"primary\"\n                          onClick={() => handleSelectOffer(offer.id)}\n                        >\n                          Select Offer\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                </CardBody>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n    </Layout>\n  );\n}\n","size_bytes":10265},"pages/api/quotes/[id]/timer.ts":{"content":"import { NextApiRequest, NextApiResponse } from 'next';\nimport { withAuth, AuthenticatedRequest } from '@/lib/middleware';\nimport prisma from '@/lib/prisma';\nimport { UserRole } from '@prisma/client';\nimport { getRemainingTime, extendQuoteTimer } from '@/lib/quote-timer';\n\nasync function handler(req: AuthenticatedRequest, res: NextApiResponse) {\n  const { id } = req.query;\n\n  if (typeof id !== 'string') {\n    return res.status(400).json({ error: 'Invalid quote ID' });\n  }\n\n  if (req.method === 'GET') {\n    try {\n      const quote = await prisma.quote.findUnique({\n        where: { id },\n        select: {\n          id: true,\n          traderId: true,\n          expiresAt: true,\n          status: true,\n        },\n      });\n\n      if (!quote) {\n        return res.status(404).json({ error: 'Quote not found' });\n      }\n\n      const isTrader = quote.traderId === req.user!.userId;\n      const isAdmin = req.user!.role === UserRole.ADMIN;\n\n      if (!isTrader && !isAdmin) {\n        return res.status(403).json({ error: 'Access denied' });\n      }\n\n      if (!quote.expiresAt) {\n        return res.status(400).json({ error: 'Quote does not have a timer' });\n      }\n\n      const timerInfo = await getRemainingTime(id);\n\n      res.status(200).json({\n        timer: {\n          expiresAt: timerInfo.expiresAt,\n          remainingMinutes: timerInfo.remainingMinutes,\n          hasExpired: timerInfo.hasExpired,\n        },\n      });\n    } catch (error) {\n      console.error('Error fetching quote timer:', error);\n      res.status(500).json({ error: 'Failed to fetch quote timer' });\n    }\n  } else if (req.method === 'POST') {\n    try {\n      if (req.user!.role !== UserRole.ADMIN) {\n        return res.status(403).json({\n          error: 'Only admins can extend quote timers',\n        });\n      }\n\n      const { additionalMinutes } = req.body;\n\n      if (\n        !additionalMinutes ||\n        typeof additionalMinutes !== 'number' ||\n        additionalMinutes <= 0\n      ) {\n        return res.status(400).json({\n          error: 'Invalid additional minutes',\n        });\n      }\n\n      const newExpiresAt = await extendQuoteTimer(id, additionalMinutes);\n\n      res.status(200).json({\n        message: 'Quote timer extended successfully',\n        newExpiresAt,\n      });\n    } catch (error) {\n      console.error('Error extending quote timer:', error);\n      res.status(500).json({ error: 'Failed to extend quote timer' });\n    }\n  } else {\n    res.status(405).json({ error: 'Method not allowed' });\n  }\n}\n\nexport default withAuth(handler);\n","size_bytes":2544},"pages/api/wallet/settings.ts":{"content":"import { NextApiResponse } from 'next';\nimport prisma from '@/lib/prisma';\nimport { withAuth, AuthenticatedRequest } from '@/lib/middleware';\nimport { UserRole } from '@prisma/client';\nimport { updateWalletAlertSettings } from '@/lib/wallet-alerts';\n\nasync function handler(req: AuthenticatedRequest, res: NextApiResponse) {\n  if (req.user!.role !== UserRole.LOGISTICS_PARTNER) {\n    return res.status(403).json({\n      error: 'Only logistics partners can manage wallet settings',\n    });\n  }\n\n  if (req.method === 'GET') {\n    try {\n      const wallet = await prisma.leadWallet.findUnique({\n        where: { userId: req.user!.userId },\n        select: {\n          lowBalanceAlert: true,\n          alertThreshold: true,\n          balance: true,\n        },\n      });\n\n      if (!wallet) {\n        return res.status(404).json({ error: 'Wallet not found' });\n      }\n\n      res.status(200).json({ settings: wallet });\n    } catch (error) {\n      console.error('Error fetching wallet settings:', error);\n      res.status(500).json({ error: 'Failed to fetch wallet settings' });\n    }\n  } else if (req.method === 'PUT') {\n    try {\n      const { lowBalanceAlert, alertThreshold } = req.body;\n\n      if (alertThreshold !== undefined) {\n        if (\n          typeof alertThreshold !== 'number' ||\n          alertThreshold < 0 ||\n          alertThreshold > 1000000\n        ) {\n          return res.status(400).json({\n            error: 'Invalid alert threshold (must be between 0 and 1,000,000)',\n          });\n        }\n      }\n\n      const settings: any = {};\n\n      if (lowBalanceAlert !== undefined) {\n        settings.lowBalanceAlert = Boolean(lowBalanceAlert);\n      }\n\n      if (alertThreshold !== undefined) {\n        settings.alertThreshold = alertThreshold;\n      }\n\n      await updateWalletAlertSettings(req.user!.userId, settings);\n\n      const updatedWallet = await prisma.leadWallet.findUnique({\n        where: { userId: req.user!.userId },\n        select: {\n          lowBalanceAlert: true,\n          alertThreshold: true,\n          balance: true,\n        },\n      });\n\n      res.status(200).json({\n        settings: updatedWallet,\n        message: 'Wallet settings updated successfully',\n      });\n    } catch (error) {\n      console.error('Error updating wallet settings:', error);\n      res.status(500).json({ error: 'Failed to update wallet settings' });\n    }\n  } else {\n    res.status(405).json({ error: 'Method not allowed' });\n  }\n}\n\nexport default withAuth(handler);\n","size_bytes":2484},"components/CountdownTimer.tsx":{"content":"import React, { useState, useEffect } from 'react';\n\ninterface CountdownTimerProps {\n  expiresAt: string;\n  onExpire?: () => void;\n  showSeconds?: boolean;\n}\n\nexport const CountdownTimer: React.FC<CountdownTimerProps> = ({ \n  expiresAt, \n  onExpire,\n  showSeconds = true \n}) => {\n  const [timeRemaining, setTimeRemaining] = useState<number>(0);\n  const [hasExpired, setHasExpired] = useState(false);\n\n  useEffect(() => {\n    const calculateTimeRemaining = () => {\n      const now = new Date().getTime();\n      const expiry = new Date(expiresAt).getTime();\n      const remaining = Math.max(0, expiry - now);\n      \n      setTimeRemaining(remaining);\n      \n      if (remaining === 0 && !hasExpired) {\n        setHasExpired(true);\n        if (onExpire) {\n          onExpire();\n        }\n      }\n    };\n\n    calculateTimeRemaining();\n    const interval = setInterval(calculateTimeRemaining, 1000);\n\n    return () => clearInterval(interval);\n  }, [expiresAt, hasExpired, onExpire]);\n\n  const formatTime = (ms: number) => {\n    const totalSeconds = Math.floor(ms / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n\n    if (showSeconds) {\n      return `${hours.toString().padStart(2, '0')}:${minutes\n        .toString()\n        .padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n    }\n    \n    return `${hours}h ${minutes}m`;\n  };\n\n  const getColorClass = () => {\n    const minutes = Math.floor(timeRemaining / 1000 / 60);\n    if (minutes <= 0) return 'text-red-600 bg-red-50';\n    if (minutes <= 10) return 'text-orange-600 bg-orange-50';\n    if (minutes <= 30) return 'text-yellow-600 bg-yellow-50';\n    return 'text-green-600 bg-green-50';\n  };\n\n  if (hasExpired || timeRemaining === 0) {\n    return (\n      <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-red-100 text-red-800\">\n        Expired\n      </span>\n    );\n  }\n\n  return (\n    <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold ${getColorClass()}`}>\n       {formatTime(timeRemaining)}\n    </span>\n  );\n};\n","size_bytes":2163}},"version":2}